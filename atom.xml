<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>青衫不改</title>
  
  <subtitle>小白の博客</subtitle>
  <link href="https://valtenhyl.github.io/atom.xml" rel="self"/>
  
  <link href="https://valtenhyl.github.io/"/>
  <updated>2021-10-29T07:02:31.255Z</updated>
  <id>https://valtenhyl.github.io/</id>
  
  <author>
    <name>valten</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>docsify搭建个人博客</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/docsify/docsify%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/docsify/docsify%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</id>
    <published>2021-10-29T05:39:40.000Z</published>
    <updated>2021-10-29T07:02:31.255Z</updated>
    
    <content type="html"><![CDATA[<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>推荐全局安装 <code>docsify-cli</code> 工具，可以方便地创建及在本地预览生成的文档。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i docsify-cli -g</span><br></pre></td></tr></table></figure><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>如果想在项目的 <code>./docs</code> 目录里写文档，直接通过 <code>init</code> 初始化项目。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docsify init ./docs</span><br></pre></td></tr></table></figure><h3 id="开始写文档"><a href="#开始写文档" class="headerlink" title="开始写文档"></a>开始写文档</h3><p>初始化成功后，可以看到 <code>./docs</code> 目录下创建的几个文件</p><ul><li><code>index.html</code> 入口文件</li><li><code>README.md</code> 会做为主页内容渲染</li><li><code>.nojekyll</code> 用于阻止 GitHub Pages 忽略掉下划线开头的文件</li></ul><p>直接编辑 <code>docs/README.md</code> 就能更新文档内容，当然也可以<a class="link"   href="https://docsify.js.org/#/zh-cn/more-pages" >添加更多页面<i class="fas fa-external-link-alt"></i></a>。</p><h3 id="本地预览"><a href="#本地预览" class="headerlink" title="本地预览"></a>本地预览</h3><p>通过运行 <code>docsify serve</code> 启动一个本地服务器，可以实时预览效果。默认访问地址 <a class="link"   href="http://localhost:3000/" >http://localhost:3000<i class="fas fa-external-link-alt"></i></a> 。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docsify serve docs</span><br></pre></td></tr></table></figure><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>和 GitBook 生成的文档一样，我们可以直接把文档网站部署到 GitHub Pages 或者 VPS 上。</p><h3 id="GitHub-Pages"><a href="#GitHub-Pages" class="headerlink" title="GitHub Pages"></a>GitHub Pages</h3><p>GitHub Pages 支持从三个地方读取文件</p><ul><li><code>docs/</code> 目录</li><li>master 分支</li><li>gh-pages 分支</li></ul><p>我们推荐直接将文档放在 <code>docs/</code> 目录下，在设置页面开启 <strong>GitHub Pages</strong> 功能并选择 <code>master branch /docs folder</code> 选项。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://docsify.js.org/_images/deploy-github-pages.png"                      alt="github pages"                ></p><p>可以将文档放在根目录下，然后选择 <strong>master 分支</strong> 作为文档目录。你需要在部署位置下放一个 <code>.nojekyll</code> 文件（比如 <code>/docs</code> 目录或者 gh-pages 分支）</p><h3 id="Gitee-Pages"><a href="#Gitee-Pages" class="headerlink" title="Gitee Pages"></a>Gitee Pages</h3><p>在对应的 Gitee 仓库服务中选择 <code>Gitee Pages</code>，选择您要部署的分支，填写您要部署的分支上的目录，例如<code>docs</code>，填写完成之后点击启动即可。</p><h2 id="定制化"><a href="#定制化" class="headerlink" title="定制化"></a>定制化</h2><h3 id="Loading-提示"><a href="#Loading-提示" class="headerlink" title="Loading 提示"></a>Loading 提示</h3><p>初始化时会显示 <code>Loading...</code> 内容，你可以自定义提示信息。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>加载中<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h3><p>通过设置 <code>coverpage</code> 参数，可以开启渲染封面的功能。具体用法见<a class="link"   href="https://docsify.js.org/#/configuration?id=coverpage" >配置项#coverpage<i class="fas fa-external-link-alt"></i></a>。</p><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p>封面的生成同样是从 markdown 文件渲染来的。开启渲染封面功能后在文档根目录创建 <code>_coverpage.md</code> 文件。渲染效果如本文档。</p><p><em>index.html</em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.$docsify = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">coverpage</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- _coverpage.md --&gt;</span></span><br><span class="line"></span><br><span class="line">![logo](_media/icon.svg)</span><br><span class="line"></span><br><span class="line"># docsify <span class="tag">&lt;<span class="name">small</span>&gt;</span>3.5<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&gt; 一个神奇的文档网站生成器。</span><br><span class="line"></span><br><span class="line">- 简单、轻便 (压缩后 ~21kB)</span><br><span class="line">- 无需生成 html 文件</span><br><span class="line">- 众多主题</span><br><span class="line"></span><br><span class="line">[GitHub](https://github.com/docsifyjs/docsify/)</span><br><span class="line">[Get Started](#docsify)</span><br></pre></td></tr></table></figure><h4 id="自定义背景"><a href="#自定义背景" class="headerlink" title="自定义背景"></a>自定义背景</h4><p>目前的背景是随机生成的渐变色，我们自定义背景色或者背景图。在文档末尾用添加图片的 Markdown 语法设置背景。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_coverpage.md</span><br><span class="line">&lt;!-- _coverpage.md --&gt;</span><br><span class="line"></span><br><span class="line"># docsify &lt;small&gt;3.5&lt;/small&gt;</span><br><span class="line"></span><br><span class="line">[GitHub](https://github.com/docsifyjs/docsify/)</span><br><span class="line">[Get Started](#quick-start)</span><br><span class="line"></span><br><span class="line">&lt;!-- 背景图片 --&gt;</span><br><span class="line"></span><br><span class="line">![](_media/bg.png)</span><br><span class="line"></span><br><span class="line">&lt;!-- 背景色 --&gt;</span><br><span class="line"></span><br><span class="line">![color](#f0f0f0)</span><br></pre></td></tr></table></figure><h3 id="定制侧边栏"><a href="#定制侧边栏" class="headerlink" title="定制侧边栏"></a>定制侧边栏</h3><p>为了获得侧边栏，您需要创建自己的_sidebar.md，你也可以自定义加载的文件名。默认情况下侧边栏会通过 Markdown 文件自动生成，效果如当前的文档的侧边栏。</p><p>首先配置 <code>loadSidebar</code> 选项，具体配置规则见<a class="link"   href="https://docsify.js.org/#/zh-cn/configuration?id=loadsidebar" >配置项#loadSidebar<i class="fas fa-external-link-alt"></i></a>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.$docsify = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">loadSidebar</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接着创建 <code>_sidebar.md</code> 文件，内容如下</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- docs/<span class="emphasis">_sidebar.md --&gt;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">* [<span class="string">首页</span>](<span class="link">zh-cn/</span>)</span></span><br><span class="line"><span class="emphasis">* [<span class="string">指南</span>](<span class="link">zh-cn/guide</span>)</span></span><br></pre></td></tr></table></figure><p>需要在 <code>./docs</code> 目录创建 <code>.nojekyll</code> 命名的空文件，阻止 GitHub Pages 忽略命名是下划线开头的文件。</p><h3 id="侧边栏标题"><a href="#侧边栏标题" class="headerlink" title="侧边栏标题"></a>侧边栏标题</h3><p>一个页面的 <code>title</code> 标签是由侧边栏中选中条目的名称所生成的。为了更好的 SEO ，你可以在文件名后面指定页面标题。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- docs/<span class="emphasis">_sidebar.md --&gt;</span></span><br><span class="line"><span class="emphasis">* [<span class="string">Home</span>](<span class="link">/</span>)</span></span><br><span class="line"><span class="emphasis">* [<span class="string">Guide</span>](<span class="link">guide.md &quot;The greatest guide in the world&quot;</span>)</span></span><br></pre></td></tr></table></figure><h3 id="显示目录"><a href="#显示目录" class="headerlink" title="显示目录"></a>显示目录</h3><p>自定义侧边栏同时也可以开启目录功能。设置 <code>subMaxLevel</code> 配置项，具体介绍见 <a class="link"   href="https://docsify.js.org/#/zh-cn/configuration?id=submaxlevel" >配置项#subMaxLevel<i class="fas fa-external-link-alt"></i></a>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.$docsify = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">loadSidebar</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">    <span class="attr">subMaxLevel</span>: <span class="number">2</span></span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="全文搜索"><a href="#全文搜索" class="headerlink" title="全文搜索"></a>全文搜索</h3><p>全文搜索插件会根据当前页面上的超链接获取文档内容，在 <code>localStorage</code> 内建立文档索引。默认过期时间为一天，当然我们可以自己指定需要缓存的文件列表或者配置过期时间。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.$docsify = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="attr">search</span>: <span class="string">&#x27;auto&#x27;</span>, <span class="comment">// 默认值</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="attr">search</span> : [</span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;/&#x27;</span>,            <span class="comment">// =&gt; /README.md</span></span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;/guide&#x27;</span>,       <span class="comment">// =&gt; /guide.md</span></span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;/get-started&#x27;</span>, <span class="comment">// =&gt; /get-started.md</span></span></span><br><span class="line"><span class="javascript">      <span class="string">&#x27;/zh-cn/&#x27;</span>,      <span class="comment">// =&gt; /zh-cn/README.md</span></span></span><br><span class="line"><span class="javascript">    ],</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 完整配置参数</span></span></span><br><span class="line"><span class="javascript">    <span class="attr">search</span>: &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">maxAge</span>: <span class="number">86400000</span>, <span class="comment">// 过期时间，单位毫秒，默认一天</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">paths</span>: [], <span class="comment">// or &#x27;auto&#x27;</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">placeholder</span>: <span class="string">&#x27;Type to search&#x27;</span>,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 支持本地化</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">placeholder</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;/zh-cn/&#x27;</span>: <span class="string">&#x27;搜索&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;Type to search&#x27;</span></span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="attr">noData</span>: <span class="string">&#x27;No Results!&#x27;</span>,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 支持本地化</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">noData</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;/zh-cn/&#x27;</span>: <span class="string">&#x27;找不到结果&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;No Results&#x27;</span></span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 搜索标题的最大层级, 1 - 6</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">depth</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="attr">hideOtherSidebarContent</span>: <span class="literal">false</span>, <span class="comment">// 是否隐藏其他侧边栏内容</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 避免搜索索引冲突</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 同一域下的多个网站之间</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">namespace</span>: <span class="string">&#x27;website-1&#x27;</span>,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 使用不同的索引作为路径前缀（namespaces）</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 注意：仅适用于 paths: &#x27;auto&#x27; 模式</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化索引时，我们从侧边栏查找第一个路径</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 如果它与列表中的前缀匹配，我们将切换到相应的索引</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">pathNamespaces</span>: [<span class="string">&#x27;/zh-cn&#x27;</span>, <span class="string">&#x27;/ru-ru&#x27;</span>, <span class="string">&#x27;/ru-ru/v1&#x27;</span>],</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 您可以提供一个正则表达式来匹配前缀。在这种情况下，</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 匹配到的字符串将被用来识别索引</span></span></span><br><span class="line"><span class="javascript">      <span class="attr">pathNamespaces</span>: <span class="regexp">/^(\/(zh-cn|ru-ru))?(\/(v1|v2))?/</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当执行全文搜索时，该插件会忽略双音符（例如，”cafe” 也会匹配 “café”）。像 IE11 这样的旧版浏览器需要使用以下 <a class="link"   href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize" >String.normalize()<i class="fas fa-external-link-alt"></i></a> polyfill 来忽略双音符：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//polyfill.io/v3/polyfill.min.js?features=String.prototype.normalize&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;快速开始&quot;&gt;&lt;a href=&quot;#快速开始&quot; class=&quot;headerlink&quot; title=&quot;快速开始&quot;&gt;&lt;/a&gt;快速开始&lt;/h2&gt;&lt;p&gt;推荐全局安装 &lt;code&gt;docsify-cli&lt;/code&gt; 工具，可以方便地创建及在本地预览生成的文档。&lt;/p&gt;
&lt;fi</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="docsify" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/docsify/"/>
    
    
    <category term="docsify" scheme="https://valtenhyl.github.io/tags/docsify/"/>
    
  </entry>
  
  <entry>
    <title>常用Git命令清单</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Git/%E5%B8%B8%E7%94%A8Git%E5%91%BD%E4%BB%A4%E6%B8%85%E5%8D%95/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Git/%E5%B8%B8%E7%94%A8Git%E5%91%BD%E4%BB%A4%E6%B8%85%E5%8D%95/</id>
    <published>2021-10-26T08:10:25.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<p>我每天使用 Git ，但是很多命令记不住。</p><p>一般来说，日常使用只要记住下图 6 个命令，就可以了。但是熟练使用，恐怕要记住 60 ～ 100 个命令。</p><span id="more"></span><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/gitstructure.png"                      alt="image"                ></p><p>下面是我整理的常用 Git 命令清单。几个专用名词的译名如下。</p><ul><li>Workspace：工作区</li><li>Index / Stage：暂存区</li><li>Repository：仓库区（或本地仓库）</li><li>Remote：远程仓库</li></ul><h2 id="新建代码库"><a href="#新建代码库" class="headerlink" title="新建代码库"></a>新建代码库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Git 的设置文件为 <code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure><h2 id="增加-删除文件"><a href="#增加-删除文件" class="headerlink" title="增加/删除文件"></a>增加/删除文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure><h2 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure><h2 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a>查看信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure><h2 id="远程同步"><a href="#远程同步" class="headerlink" title="远程同步"></a>远程同步</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载远程仓库的所有变动</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure><h2 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure><p>转载：<a class="link"   href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" >https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;我每天使用 Git ，但是很多命令记不住。&lt;/p&gt;
&lt;p&gt;一般来说，日常使用只要记住下图 6 个命令，就可以了。但是熟练使用，恐怕要记住 60 ～ 100 个命令。&lt;/p&gt;</summary>
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Git" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Git/"/>
    
    
    <category term="Git" scheme="https://valtenhyl.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>批处理bat脚本案例</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/bat/%E6%89%B9%E5%A4%84%E7%90%86bat%E6%A1%88%E4%BE%8B/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/bat/%E6%89%B9%E5%A4%84%E7%90%86bat%E6%A1%88%E4%BE%8B/</id>
    <published>2021-10-25T01:34:39.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<h3 id="sublime-text右键菜单"><a href="#sublime-text右键菜单" class="headerlink" title="sublime_text右键菜单"></a>sublime_text右键菜单</h3><blockquote><p>sublime_text安装目录根路径执行</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@ECHO OFF &amp; PUSHD %~DP0 &amp; TITLE</span><br><span class="line">&gt;NUL 2&gt;&amp;1 REG.exe query <span class="string">&quot;HKU\S-1-5-19&quot;</span> || (</span><br><span class="line">    ECHO SET UAC = CreateObject^(<span class="string">&quot;Shell.Application&quot;</span>^) &gt; <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    ECHO UAC.ShellExecute <span class="string">&quot;%~f0&quot;</span>, <span class="string">&quot;%1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;runas&quot;</span>, 1 &gt;&gt; <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    DEL /f /q <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span> 2&gt;NUL</span><br><span class="line">    Exit /b</span><br><span class="line">)</span><br><span class="line">SET /P ST=输入a添加右键菜单，输入d删除右键菜单：</span><br><span class="line"><span class="keyword">if</span> /I <span class="string">&quot;%ST%&quot;</span>==<span class="string">&quot;a&quot;</span> goto Add</span><br><span class="line"><span class="keyword">if</span> /I <span class="string">&quot;%ST%&quot;</span>==<span class="string">&quot;d&quot;</span> goto Remove</span><br><span class="line">:Add</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /t REG_SZ /v <span class="string">&quot;&quot;</span> /d <span class="string">&quot;用 &amp;Sublime Text 打开&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /t REG_EXPAND_SZ /v <span class="string">&quot;Icon&quot;</span> /d <span class="string">&quot;%~dp0sublime_text.exe&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text\command&quot;</span> /t REG_SZ /v <span class="string">&quot;&quot;</span> /d <span class="string">&quot;%~dp0sublime_text.exe \&quot;%%1\&quot;&quot;</span> /f</span><br><span class="line"> </span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">:Remove</span><br><span class="line">reg delete <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /f</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h3 id="java环境变量配置"><a href="#java环境变量配置" class="headerlink" title="java环境变量配置"></a>java环境变量配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">::添加环境变量JAVA_HOME</span><br><span class="line">::<span class="built_in">echo</span> off 表示在批处理文件执行过程中，只显示结果，而不显示执行的命令</span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line"><span class="built_in">echo</span> 添加Java环境变量</span><br><span class="line">setx /M JAVA_HOME <span class="string">&quot;C:\Program Files\Java\jdk1.8.0_171&quot;</span></span><br><span class="line">setx /M Path <span class="string">&quot;%Path%;%%JAVA_HOME%%\bin;%%JAVA_HOME%%\jre\bin;&quot;</span></span><br><span class="line">setx /M CLASSPATH <span class="string">&quot;.;%%JAVA_HOME%%\lib\dt.jar;%%JAVA_HOME%%\lib\tools.jar;&quot;</span></span><br><span class="line">::pause命令运行后会中断执行的语句。这个中断不是立即停止，只是暂停</span><br><span class="line">::按下任意键之后就会继续执行下面的语句。</span><br><span class="line">pause</span><br><span class="line">::添加环境变量之后不会在本cmd窗口生效，所以%JAVA_HOME%没有值</span><br><span class="line">::需要输入  %%JAVA_HOME%% 显示 %JAVA_HOME%</span><br></pre></td></tr></table></figure><h3 id="nginx启动"><a href="#nginx启动" class="headerlink" title="nginx启动"></a>nginx启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;help&quot;</span> (goto <span class="built_in">help</span>) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;-h&quot;</span> goto <span class="built_in">help</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;version&quot;</span> (goto version) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;-v&quot;</span> goto version)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;start&quot;</span> goto start</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;stop&quot;</span> goto stop</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;reload&quot;</span> goto reload</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;reopen&quot;</span> goto reopen</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;find&quot;</span> goto find</span><br><span class="line">goto error</span><br><span class="line"></span><br><span class="line">:<span class="built_in">help</span></span><br><span class="line">nginx -v</span><br><span class="line"><span class="built_in">echo</span> Usage: nginxd [-h,<span class="built_in">help</span>] [-v,version] [start] [stop] [stop -a] [reload] [reopen] [find]</span><br><span class="line"><span class="built_in">echo</span>=</span><br><span class="line"><span class="built_in">echo</span> Options:</span><br><span class="line"><span class="built_in">echo</span>   <span class="built_in">help</span>,-h         : this <span class="built_in">help</span></span><br><span class="line"><span class="built_in">echo</span>   version,-v      : show current nginx version</span><br><span class="line"><span class="built_in">echo</span>   start           : start nginx master process</span><br><span class="line"><span class="built_in">echo</span>   stop            : stop the newest nginx master process</span><br><span class="line"><span class="built_in">echo</span>   stop -a         : stop all nginx master processes</span><br><span class="line"><span class="built_in">echo</span>   reload          : reload configuration</span><br><span class="line"><span class="built_in">echo</span>   reopen          : reopen nginx</span><br><span class="line"><span class="built_in">echo</span>   find            : show the nginx master process list</span><br><span class="line"><span class="built_in">echo</span>=</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:version</span><br><span class="line">nginx -v</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:start</span><br><span class="line">start nginx -p D:\Programs\Nginx</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:stop</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%2&quot;</span>==<span class="string">&quot;-a&quot;</span> (taskkill /F /IM nginx.exe) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%2&quot;</span>==<span class="string">&quot;&quot;</span> (nginx -s stop -p D:\Programs\Nginx) <span class="keyword">else</span> goto error)</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:reload</span><br><span class="line">nginx -s reload -p D:\Programs\Nginx</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:find</span><br><span class="line">tasklist /<span class="keyword">fi</span> <span class="string">&quot;imagename eq nginx.exe&quot;</span></span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:error</span><br><span class="line"><span class="built_in">echo</span> nginxd: invalid option: <span class="string">&quot;%1 %2&quot;</span></span><br><span class="line"><span class="built_in">echo</span>=   </span><br><span class="line"><span class="built_in">exit</span> /B</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;sublime-text右键菜单&quot;&gt;&lt;a href=&quot;#sublime-text右键菜单&quot; class=&quot;headerlink&quot; title=&quot;sublime_text右键菜单&quot;&gt;&lt;/a&gt;sublime_text右键菜单&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;s</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="bat" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/bat/"/>
    
    
    <category term="批处理" scheme="https://valtenhyl.github.io/tags/%E6%89%B9%E5%A4%84%E7%90%86/"/>
    
    <category term="脚本" scheme="https://valtenhyl.github.io/tags/%E8%84%9A%E6%9C%AC/"/>
    
    <category term="bat" scheme="https://valtenhyl.github.io/tags/bat/"/>
    
  </entry>
  
  <entry>
    <title>Openresty+Lua搭建文件服务器</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Lua/Openresty+Lua%E6%90%AD%E5%BB%BA%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Lua/Openresty+Lua%E6%90%AD%E5%BB%BA%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2021-05-18T10:47:25.000Z</published>
    <updated>2021-10-29T06:58:14.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>搭建静态文件服务器，用户访问浏览器地址下载相应的文件</p><p>如访问：<a class="link"   href="http://127.0.0.1/doc/test.docx" >http://127.0.0.1/doc/test.docx<i class="fas fa-external-link-alt"></i></a> 即是下载test.docx文件</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="安装openresty"><a href="#安装openresty" class="headerlink" title="安装openresty"></a>安装openresty</h3><h3 id="配置nginx-conf"><a href="#配置nginx-conf" class="headerlink" title="配置nginx.conf"></a>配置nginx.conf</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">4096</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET,POST,OPTIONS&#x27;</span>;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">lua_package_path</span> <span class="string">&quot;lualib/?.lua;&quot;</span>;</span><br><span class="line">    <span class="attribute">lua_package_cpath</span> <span class="string">&quot;lualib/?.so;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">114.114.114.114</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 文件存储路径</span></span><br><span class="line">        <span class="attribute">root</span> C:/data/sharefile;</span><br><span class="line">        <span class="attribute">set</span> $store_dir C:/data/sharefile/; <span class="comment"># 文件存储路径</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">autoindex</span> <span class="literal">on</span>; <span class="comment"># 索引</span></span><br><span class="line">            <span class="attribute">autoindex_exact_size</span> <span class="literal">on</span>; <span class="comment"># 显示文件大小</span></span><br><span class="line">            <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>; <span class="comment"># 显示文件时间</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /download &#123;</span><br><span class="line">            <span class="attribute">alias</span> C:/data/sharefile;</span><br><span class="line">            <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">location</span> /upload &#123;</span><br><span class="line">            <span class="attribute">client_max_body_size</span>    <span class="number">4000m</span>;  </span><br><span class="line">            <span class="attribute">default_type</span>  application/json;</span><br><span class="line">            <span class="attribute">lua_code_cache</span> <span class="literal">on</span>;  </span><br><span class="line">            <span class="attribute">content_by_lua_file</span> lua_scripts/upload.lua;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">location</span> /delete &#123;</span><br><span class="line">            <span class="attribute">default_type</span>  application/json;</span><br><span class="line">            <span class="attribute">content_by_lua_file</span> lua_scripts/deletefile.lua;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">location</span> /move&#123;</span><br><span class="line">            <span class="attribute">default_type</span>  application/json;</span><br><span class="line">            <span class="attribute">content_by_lua_file</span> lua_scripts/move.lua;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">location</span> /isexit&#123;</span><br><span class="line">            <span class="attribute">default_type</span>  application/json;</span><br><span class="line">            <span class="attribute">content_by_lua_file</span> lua_scripts/isexit.lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重新启动-openresty"><a href="#重新启动-openresty" class="headerlink" title="重新启动 openresty"></a>重新启动 openresty</h3><h3 id="访问-http-127-0-0-1，效果如下"><a href="#访问-http-127-0-0-1，效果如下" class="headerlink" title="访问 http://127.0.0.1，效果如下"></a>访问 <a class="link"   href="http://127.0.0.1,效果如下/" >http://127.0.0.1，效果如下<i class="fas fa-external-link-alt"></i></a></h3><p><img src="https://gitee.com/valten/filebed/raw/master/openresty_index.png" alt="https://gitee.com/valten/filebed/raw/master/openresty_index.png"></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- upload.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"><span class="comment">-- 文件上传</span></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> upload = <span class="built_in">require</span> <span class="string">&quot;resty.upload&quot;</span></span><br><span class="line"><span class="comment">-- 文件保存的根路径</span></span><br><span class="line"><span class="comment">-- local saveRootPath = &quot;/data/sharefile/&quot;</span></span><br><span class="line"><span class="keyword">local</span> saveRootPath = ngx.var.store_dir</span><br><span class="line"><span class="keyword">local</span> baseurl = <span class="string">&quot;download/&quot;</span></span><br><span class="line"><span class="keyword">local</span> urllist = <span class="string">&quot;&#123;&quot;</span></span><br><span class="line"><span class="keyword">local</span> dir = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">local</span> newfilename</span><br><span class="line"><span class="keyword">local</span> acdd = <span class="string">&quot;y&quot;</span> <span class="comment">--[[自动创建目录]]</span></span><br><span class="line"><span class="keyword">local</span> arf = <span class="string">&quot;y&quot;</span> <span class="comment">--[[自动重命名文件]]</span></span><br><span class="line"></span><br><span class="line">dir = ngx.req.get_uri_args()[<span class="string">&quot;dir&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> dir == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">    dir = <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> date_ym = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&quot;%Y%m&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> date_d = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&quot;%d&quot;</span>);</span><br><span class="line"></span><br><span class="line">acdd = ngx.req.get_uri_args()[<span class="string">&quot;acdd&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> acdd == <span class="string">&quot;n&quot;</span> <span class="keyword">then</span></span><br><span class="line">    saveRootPath = saveRootPath .. dir .. <span class="string">&quot;/&quot;</span></span><br><span class="line">    baseurl = baseurl .. dir .. <span class="string">&quot;/&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    saveRootPath = saveRootPath .. date_ym .. <span class="string">&quot;/&quot;</span> .. date_d .. <span class="string">&quot;/&quot;</span> .. dir .. <span class="string">&quot;/&quot;</span></span><br><span class="line">    baseurl = baseurl .. date_ym .. <span class="string">&quot;/&quot;</span> .. date_d .. <span class="string">&quot;/&quot;</span> .. dir .. <span class="string">&quot;/&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">arf = ngx.req.get_uri_args()[<span class="string">&quot;arf&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> chunk_size = <span class="number">40960</span></span><br><span class="line"><span class="keyword">local</span> form = upload:new(chunk_size)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> form <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;no data post\&quot;&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 保存的文件对象</span></span><br><span class="line"><span class="keyword">local</span> file</span><br><span class="line"></span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFileName</span><span class="params">(res)</span></span></span><br><span class="line">    <span class="keyword">local</span> filename = ngx.re.<span class="built_in">match</span>(res, <span class="string">&#x27;(.+)filename=&quot;(.+)&quot;(.*)&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> filename[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getExtension</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="keyword">return</span> str:<span class="built_in">match</span>(<span class="string">&quot;.+%.(%w+)$&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get16Md5</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">string</span>.<span class="built_in">sub</span>(str, <span class="number">9</span>, <span class="number">24</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNewFileName</span><span class="params">(file_name)</span></span></span><br><span class="line">    <span class="keyword">if</span> arf == <span class="string">&quot;n&quot;</span> <span class="keyword">then</span></span><br><span class="line">        newfilename = file_name</span><br><span class="line">        <span class="keyword">return</span> newfilename</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">local</span> extension = getExtension(file_name)</span><br><span class="line">        <span class="keyword">local</span> filedate = <span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">&quot;%y%m%d%H%M%S&quot;</span>);</span><br><span class="line">        <span class="keyword">local</span> md5 = get16Md5(ngx.md5(file_name));</span><br><span class="line">        <span class="keyword">if</span> extension <span class="keyword">then</span></span><br><span class="line">            newfilename = filedate .. md5 .. <span class="string">&quot;.&quot;</span> .. extension</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> extension <span class="keyword">then</span></span><br><span class="line">                newfilename = filedate .. md5</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> newfilename</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dir_exists</span><span class="params">(path)</span></span></span><br><span class="line">    <span class="keyword">local</span> file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="built_in">path</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">then</span></span><br><span class="line">        <span class="comment">--ngx.log(ngx.ERR, &quot;path dir_exists************&quot;)</span></span><br><span class="line">        file:<span class="built_in">close</span>()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file <span class="keyword">then</span></span><br><span class="line">        ngx.<span class="built_in">log</span>(ngx.ERR, <span class="string">&quot;path not dir_exists************&quot;</span>)</span><br><span class="line">        <span class="comment">-- linux系统</span></span><br><span class="line">        <span class="comment">-- os.execute(&#x27;mkdir -p &#x27; .. path)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- windows系统</span></span><br><span class="line">        <span class="keyword">local</span> path1 = <span class="built_in">string</span>.<span class="built_in">gsub</span>(<span class="built_in">path</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">        <span class="built_in">os</span>.<span class="built_in">execute</span>(<span class="string">&#x27;md &#x27;</span>.. path1)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">local uritoken = ngx.req.get_uri_args()[&quot;token&quot;] </span></span><br><span class="line"><span class="comment">local cookietoken = ngx.var.cookie_token --$cookie_token</span></span><br><span class="line"><span class="comment">local token = uritoken or cookietoken</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">if token == nil then</span></span><br><span class="line"><span class="comment">    ngx.say(&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;token is empty\&quot;,url:\&quot;\&quot;&#125;&quot;)</span></span><br><span class="line"><span class="comment">    return</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    <span class="comment">--ngx.log(ngx.ERR, &quot;1111************&quot;)</span></span><br><span class="line">    <span class="keyword">local</span> typ, res, err = form:<span class="built_in">read</span>()</span><br><span class="line">    <span class="comment">--ngx.log(ngx.ERR, &quot;2222-typ************&quot;..typ)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> typ <span class="keyword">then</span></span><br><span class="line">        ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;&quot;</span> .. <span class="built_in">tostring</span>(err) .. <span class="string">&quot;\&quot;&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> typ == <span class="string">&quot;header&quot;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="comment">--[[</span></span><br><span class="line"><span class="comment">                ngx.log(ngx.ERR, &quot;3333-typ=header************&quot;..type(res))</span></span><br><span class="line"><span class="comment">                ngx.log(ngx.ERR, &quot;RRRR-typ=header-res[1]************&quot;..#(res))</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                for key, value in pairs(res) do</span></span><br><span class="line"><span class="comment">                    ngx.log(ngx.ERR, &quot;KKK-typ=header-res[1] key************&quot;..key)</span></span><br><span class="line"><span class="comment">                    ngx.log(ngx.ERR, &quot;VVV-typ=header-res[1] value************&quot;..value)</span></span><br><span class="line"><span class="comment">                end</span></span><br><span class="line"><span class="comment">        ]]</span></span><br><span class="line">        <span class="comment">--ngx.log(ngx.ERR, &quot;4444-typ=header-res[1]************&quot;..res[1])</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> res[<span class="number">1</span>] ~= <span class="string">&quot;Content-Type&quot;</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">--ngx.log(ngx.ERR, &quot;5555-res[2]************&quot; .. res[2])</span></span><br><span class="line">            <span class="keyword">local</span> file_name = getFileName(res[<span class="number">2</span>])</span><br><span class="line">            <span class="keyword">if</span> file_name <span class="keyword">then</span></span><br><span class="line">                getNewFileName(file_name)</span><br><span class="line">                dir_exists(saveRootPath)</span><br><span class="line">                <span class="keyword">local</span> file_name_1 = saveRootPath .. newfilename</span><br><span class="line"></span><br><span class="line">                <span class="keyword">local</span> fileexists = <span class="built_in">io</span>.<span class="built_in">open</span>(file_name_1, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> fileexists <span class="keyword">then</span></span><br><span class="line">                    fileexists:<span class="built_in">close</span>()</span><br><span class="line">                    ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;[&quot;</span> .. newfilename .. <span class="string">&quot;] file already exists\&quot;&#125;&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">-- linux系统</span></span><br><span class="line">                <span class="comment">-- file = io.open(file_name_1, &quot;w+&quot;)</span></span><br><span class="line">                <span class="comment">-- windows系统需要加b</span></span><br><span class="line">                file = <span class="built_in">io</span>.<span class="built_in">open</span>(file_name_1, <span class="string">&quot;w+b&quot;</span>)</span><br><span class="line">                urllist = urllist .. <span class="string">&quot;\&quot;&quot;</span> .. file_name .. <span class="string">&quot;\&quot;:\&quot;&quot;</span> .. baseurl .. newfilename .. <span class="string">&quot;\&quot;,&quot;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> file <span class="keyword">then</span></span><br><span class="line">                    ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;failed to open file &quot;</span> .. file_name_1 .. <span class="string">&quot;\&quot;&#125;&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">elseif</span> typ == <span class="string">&quot;body&quot;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">then</span></span><br><span class="line">            <span class="comment">--ngx.log(ngx.ERR, &quot;9999-1111-write************&quot;..res)</span></span><br><span class="line">            file:<span class="built_in">write</span>(res)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">elseif</span> typ == <span class="string">&quot;part_end&quot;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">then</span></span><br><span class="line">            file:<span class="built_in">close</span>()</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        file = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">elseif</span> typ == <span class="string">&quot;eof&quot;</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">-- do nothing</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ul = <span class="built_in">string</span>.<span class="built_in">sub</span>(urllist, <span class="number">1</span>, <span class="number">-2</span>)</span><br><span class="line"><span class="keyword">local</span> ull = ul .. <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="comment">--ngx.log(ngx.ERR, &quot;ull************&quot;..ull)</span></span><br><span class="line"></span><br><span class="line">ngx.header[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json; charset=utf-8&quot;</span></span><br><span class="line"><span class="comment">--ngx.header[&quot;Control-Allow-Headers&quot;] = &quot;Origin, X-Requested-With, Content-Type, Accept,filedir&quot;</span></span><br><span class="line"><span class="comment">--ngx.header[&quot;filedir&quot;] = &quot;&quot;</span></span><br><span class="line">ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;success\&quot;, \&quot;msg\&quot;:\&quot;success\&quot;,\&quot;urllist\&quot;:&quot;</span> .. ull .. <span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p><a class="link"   href="http://127.0.0.1/upload?dir=test&amp;acdd=n&amp;arf=n" >http://127.0.0.1/upload?dir=test&amp;acdd=n&amp;arf=n<i class="fas fa-external-link-alt"></i></a></p><p>参数 <code>acdd</code> 和 <code>arf</code> 可选</p><h3 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h3><p>download.lua</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- download.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"><span class="comment">-- 下载上传</span></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> http = <span class="built_in">require</span> <span class="string">&quot;resty.http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> upload = <span class="built_in">require</span> <span class="string">&quot;resty.upload&quot;</span></span><br><span class="line"><span class="keyword">local</span> oss = <span class="built_in">require</span> <span class="string">&quot;resty.oss&quot;</span></span><br><span class="line">ngx.say(<span class="string">&quot;1231=================&quot;</span>)</span><br><span class="line"><span class="comment">-- 获取上传的文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> chunk_size = <span class="number">4096</span></span><br><span class="line">    <span class="keyword">local</span> form, err = upload:new(chunk_size)</span><br><span class="line">    form:set_timeout(<span class="number">20000</span>)</span><br><span class="line">    <span class="keyword">local</span> file = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> err <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">local</span> typ, res, err2 = form:<span class="built_in">read</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> typ <span class="keyword">then</span></span><br><span class="line">                err = err2</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;failed to read: &quot;</span>, err2)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> typ == <span class="string">&#x27;header&#x27;</span> <span class="keyword">and</span> res[<span class="number">1</span>] == <span class="string">&#x27;Content-Disposition&#x27;</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">local</span> filename = <span class="built_in">string</span>.<span class="built_in">match</span>(res[<span class="number">2</span>], <span class="string">&#x27;filename=&quot;(.*)&quot;&#x27;</span>)</span><br><span class="line">                file.name = filename</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> typ == <span class="string">&#x27;header&#x27;</span> <span class="keyword">and</span> res[<span class="number">1</span>] == <span class="string">&#x27;Content-Type&#x27;</span> <span class="keyword">then</span></span><br><span class="line">                file[<span class="string">&#x27;type&#x27;</span>] = res[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> typ == <span class="string">&#x27;body&#x27;</span> <span class="keyword">and</span> file <span class="keyword">then</span></span><br><span class="line">                file[typ] = (file[typ] <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span>) .. res</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> typ == <span class="string">&quot;eof&quot;</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> file, err</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> file, err = readFile()</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> oss_config = &#123;</span><br><span class="line">    accessKey  = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    secretKey  = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    bucket      = <span class="string">&quot;xxxx&quot;</span>,</span><br><span class="line">    endpoint   = <span class="string">&quot;oss-cn-beijing.aliyuncs.com&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> client = oss.new(oss_config)</span><br><span class="line"><span class="keyword">local</span> url = client:put_object(file.body, file.<span class="built_in">type</span>, file.name)</span><br><span class="line">ngx.say(url)</span><br><span class="line"></span><br><span class="line">ngx.say(<span class="string">&quot;asdfasdfasdf2134123&quot;</span>)</span><br></pre></td></tr></table></figure><p><a class="link"   href="http://127.0.0.1/download/seal.jpg" >http://127.0.0.1/download/seal.jpg<i class="fas fa-external-link-alt"></i></a></p><h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- move.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"><span class="comment">-- 移动上传</span></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> storepath = <span class="string">&quot;/data/sharefile/&quot;</span></span><br><span class="line"><span class="keyword">local</span> request_method = ngx.var.request_method</span><br><span class="line"><span class="keyword">local</span> sourcedir = ngx.req.get_uri_args()[<span class="string">&quot;sourceDir&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> filename = ngx.req.get_uri_args()[<span class="string">&quot;fileName&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> targetdir = ngx.req.get_uri_args()[<span class="string">&quot;targetDir&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> romoveCmd = <span class="string">&quot;mv&quot;</span>..<span class="string">&quot; &quot;</span>..storepath..sourcedir..filename..<span class="string">&quot; &quot;</span>..storepath..targetdir..filename</span><br><span class="line"><span class="keyword">local</span> mv_file = <span class="built_in">os</span>.<span class="built_in">execute</span>(romoveCmd)</span><br><span class="line">ngx.header[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json; charset=utf-8&quot;</span></span><br><span class="line"><span class="keyword">if</span>(mv_file ~= <span class="number">0</span>) <span class="keyword">then</span> </span><br><span class="line">ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;move fail\&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;success\&quot;, \&quot;msg\&quot;:\&quot;&quot;</span>..targetdir..filename..<span class="string">&quot;\&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- delete.lua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"><span class="comment">-- 删除上传</span></span><br><span class="line"><span class="comment">--==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> storepath = <span class="string">&quot;/data/sharefile/&quot;</span></span><br><span class="line"><span class="keyword">local</span> request_method = ngx.var.request_method</span><br><span class="line"><span class="keyword">local</span> filename = ngx.req.get_uri_args()[<span class="string">&quot;f&quot;</span>]</span><br><span class="line"><span class="keyword">local</span> rm_file = <span class="built_in">os</span>.<span class="built_in">remove</span>(storepath..filename)</span><br><span class="line">ngx.header[<span class="string">&quot;Content-Type&quot;</span>]    = <span class="string">&quot;application/json; charset=utf-8&quot;</span></span><br><span class="line"><span class="keyword">if</span>(rm_file == <span class="literal">nil</span>) <span class="keyword">then</span> </span><br><span class="line">ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;error\&quot;, \&quot;msg\&quot;:\&quot;file not exist or other reasons\&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ngx.say(<span class="string">&quot;&#123;\&quot;error\&quot;:\&quot;success\&quot;, \&quot;msg\&quot;:\&quot;success\&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;目的&quot;&gt;&lt;a href=&quot;#目的&quot; class=&quot;headerlink&quot; title=&quot;目的&quot;&gt;&lt;/a&gt;目的&lt;/h2&gt;&lt;p&gt;搭建静态文件服务器，用户访问浏览器地址下载相应的文件&lt;/p&gt;
&lt;p&gt;如访问：&lt;a class=&quot;link&quot;   href=&quot;http://1</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Lua" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Lua/"/>
    
    
    <category term="Openresty" scheme="https://valtenhyl.github.io/tags/Openresty/"/>
    
    <category term="Lua" scheme="https://valtenhyl.github.io/tags/Lua/"/>
    
    <category term="文件服务器" scheme="https://valtenhyl.github.io/tags/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>Oracle查询连续日期</title>
    <link href="https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E6%9F%A5%E8%AF%A2%E8%BF%9E%E7%BB%AD%E6%97%A5%E6%9C%9F/"/>
    <id>https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E6%9F%A5%E8%AF%A2%E8%BF%9E%E7%BB%AD%E6%97%A5%E6%9C%9F/</id>
    <published>2021-03-31T04:35:43.000Z</published>
    <updated>2021-10-29T06:58:14.284Z</updated>
    
    <content type="html"><![CDATA[<h5 id="在线数据"><a href="#在线数据" class="headerlink" title="在线数据"></a>在线数据</h5><p><a class="link"   href="http://sqlfiddle.com/" >http://sqlfiddle.com/<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test</span><br><span class="line">(</span><br><span class="line">  id    VARCHAR2(<span class="number">32</span>),</span><br><span class="line">  vcode VARCHAR2(<span class="number">50</span>),</span><br><span class="line">  qdate <span class="type">date</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;1&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-01&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;2&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-02&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;3&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-03&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;4&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-05&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;5&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-07&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;6&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-09&#x27;</span> <span class="keyword">as</span> tqdateime <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;7&#x27;</span> id, <span class="string">&#x27;A001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-10&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;8&#x27;</span> id, <span class="string">&#x27;B001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-06&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;9&#x27;</span> id, <span class="string">&#x27;B001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-07&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual <span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;10&#x27;</span> id, <span class="string">&#x27;B001&#x27;</span> <span class="keyword">as</span> vcode, <span class="type">date</span> <span class="string">&#x27;2019-05-08&#x27;</span> <span class="keyword">as</span> qdate <span class="keyword">from</span> dual) </span><br></pre></td></tr></table></figure><p>生成表如下：</p><table><thead><tr><th align="left">D</th><th align="left">VCODE</th><th align="left">QDATE</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">A001</td><td align="left">2019-05-01T00:00:00Z</td></tr><tr><td align="left">10</td><td align="left">B001</td><td align="left">2019-05-08T00:00:00Z</td></tr><tr><td align="left">2</td><td align="left">A001</td><td align="left">2019-05-02T00:00:00Z</td></tr><tr><td align="left">3</td><td align="left">A001</td><td align="left">2019-05-03T00:00:00Z</td></tr><tr><td align="left">4</td><td align="left">A001</td><td align="left">2019-05-05T00:00:00Z</td></tr><tr><td align="left">5</td><td align="left">A001</td><td align="left">2019-05-07T00:00:00Z</td></tr><tr><td align="left">6</td><td align="left">A001</td><td align="left">2019-05-09T00:00:00Z</td></tr><tr><td align="left">7</td><td align="left">A001</td><td align="left">2019-05-10T00:00:00Z</td></tr><tr><td align="left">8</td><td align="left">B001</td><td align="left">2019-05-06T00:00:00Z</td></tr><tr><td align="left">9</td><td align="left">B001</td><td align="left">2019-05-07T00:00:00Z</td></tr></tbody></table><p>按照名字vcode分组，按照日期qdate排序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">t.<span class="operator">*</span>,</span><br><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> vcode <span class="keyword">order</span> <span class="keyword">by</span> qdate) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> test t;</span><br></pre></td></tr></table></figure><p>结果如下：</p><table><thead><tr><th align="left">ID</th><th align="left">VCODE</th><th align="left">QDATE</th><th align="left">RN</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">A001</td><td align="left">2019-05-01T00:00:00Z</td><td align="left">1</td></tr><tr><td align="left">2</td><td align="left">A001</td><td align="left">2019-05-02T00:00:00Z</td><td align="left">2</td></tr><tr><td align="left">3</td><td align="left">A001</td><td align="left">2019-05-03T00:00:00Z</td><td align="left">3</td></tr><tr><td align="left">4</td><td align="left">A001</td><td align="left">2019-05-05T00:00:00Z</td><td align="left">4</td></tr><tr><td align="left">5</td><td align="left">A001</td><td align="left">2019-05-07T00:00:00Z</td><td align="left">5</td></tr><tr><td align="left">6</td><td align="left">A001</td><td align="left">2019-05-09T00:00:00Z</td><td align="left">6</td></tr><tr><td align="left">7</td><td align="left">A001</td><td align="left">2019-05-10T00:00:00Z</td><td align="left">7</td></tr><tr><td align="left">8</td><td align="left">B001</td><td align="left">2019-05-06T00:00:00Z</td><td align="left">1</td></tr><tr><td align="left">9</td><td align="left">B001</td><td align="left">2019-05-07T00:00:00Z</td><td align="left">2</td></tr><tr><td align="left">10</td><td align="left">B001</td><td align="left">2019-05-08T00:00:00Z</td><td align="left">3</td></tr></tbody></table><p>提取日期减去行号，得到的结果rn连续相同时即为日期连续组</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">t.<span class="operator">*</span>,</span><br><span class="line">trunc(qdate) <span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> vcode <span class="keyword">order</span> <span class="keyword">by</span> qdate) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> test t;</span><br></pre></td></tr></table></figure><p>结果如下：</p><table><thead><tr><th align="left">ID</th><th align="left">VCODE</th><th align="left">QDATE</th><th align="left">RN</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">A001</td><td align="left">2019-05-01T00:00:00Z</td><td align="left">2019-04-30T00:00:00Z</td></tr><tr><td align="left">2</td><td align="left">A001</td><td align="left">2019-05-02T00:00:00Z</td><td align="left">2019-04-30T00:00:00Z</td></tr><tr><td align="left">3</td><td align="left">A001</td><td align="left">2019-05-03T00:00:00Z</td><td align="left">2019-04-30T00:00:00Z</td></tr><tr><td align="left">4</td><td align="left">A001</td><td align="left">2019-05-05T00:00:00Z</td><td align="left">2019-05-01T00:00:00Z</td></tr><tr><td align="left">5</td><td align="left">A001</td><td align="left">2019-05-07T00:00:00Z</td><td align="left">2019-05-02T00:00:00Z</td></tr><tr><td align="left">6</td><td align="left">A001</td><td align="left">2019-05-09T00:00:00Z</td><td align="left">2019-05-03T00:00:00Z</td></tr><tr><td align="left">7</td><td align="left">A001</td><td align="left">2019-05-10T00:00:00Z</td><td align="left">2019-05-03T00:00:00Z</td></tr><tr><td align="left">8</td><td align="left">B001</td><td align="left">2019-05-06T00:00:00Z</td><td align="left">2019-05-05T00:00:00Z</td></tr><tr><td align="left">9</td><td align="left">B001</td><td align="left">2019-05-07T00:00:00Z</td><td align="left">2019-05-05T00:00:00Z</td></tr><tr><td align="left">10</td><td align="left">B001</td><td align="left">2019-05-08T00:00:00Z</td><td align="left">2019-05-05T00:00:00Z</td></tr></tbody></table><p>根据vcode和rn分组，得到的count即为连续的天数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vcode, rn, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">t.<span class="operator">*</span>,</span><br><span class="line">trunc(qdate) <span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> vcode <span class="keyword">order</span> <span class="keyword">by</span> qdate) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> test t</span><br><span class="line">) <span class="keyword">group</span> <span class="keyword">by</span> vcode, rn;</span><br></pre></td></tr></table></figure><p>结果如下：</p><table><thead><tr><th align="left">VCODE</th><th align="left">RN</th><th align="left">COUNT(*)</th></tr></thead><tbody><tr><td align="left">B001</td><td align="left">2019-05-05T00:00:00Z</td><td align="left">3</td></tr><tr><td align="left">A001</td><td align="left">2019-05-01T00:00:00Z</td><td align="left">1</td></tr><tr><td align="left">A001</td><td align="left">2019-05-02T00:00:00Z</td><td align="left">1</td></tr><tr><td align="left">A001</td><td align="left">2019-05-03T00:00:00Z</td><td align="left">2</td></tr><tr><td align="left">A001</td><td align="left">2019-04-30T00:00:00Z</td><td align="left">3</td></tr></tbody></table><p>通过having即可筛选出连续天数&gt;=2的vcode</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vcode, rn, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">t.<span class="operator">*</span>,</span><br><span class="line">trunc(qdate) <span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> vcode <span class="keyword">order</span> <span class="keyword">by</span> qdate) <span class="keyword">as</span> rn</span><br><span class="line"><span class="keyword">from</span> test t</span><br><span class="line">) <span class="keyword">group</span> <span class="keyword">by</span> vcode, rn <span class="keyword">having</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>结果如下：</p><table><thead><tr><th align="left">VCODE</th><th align="left">RN</th><th align="left">COUNT(*)</th></tr></thead><tbody><tr><td align="left">B001</td><td align="left">2019-05-05T00:00:00Z</td><td align="left">3</td></tr><tr><td align="left">A001</td><td align="left">2019-05-03T00:00:00Z</td><td align="left">2</td></tr><tr><td align="left">A001</td><td align="left">2019-04-30T00:00:00Z</td><td align="left">3</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;在线数据&quot;&gt;&lt;a href=&quot;#在线数据&quot; class=&quot;headerlink&quot; title=&quot;在线数据&quot;&gt;&lt;/a&gt;在线数据&lt;/h5&gt;&lt;p&gt;&lt;a class=&quot;link&quot;   href=&quot;http://sqlfiddle.com/&quot; &gt;http://sqlfidd</summary>
      
    
    
    
    <category term="数据库" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/"/>
    
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/tags/Oracle/"/>
    
  </entry>
  
  <entry>
    <title>杂记</title>
    <link href="https://valtenhyl.github.io/%E5%85%B6%E4%BB%96/%E6%9D%82%E8%AE%B0/"/>
    <id>https://valtenhyl.github.io/%E5%85%B6%E4%BB%96/%E6%9D%82%E8%AE%B0/</id>
    <published>2021-03-01T06:15:21.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<h4 id="数据闪回"><a href="#数据闪回" class="headerlink" title="数据闪回"></a>数据闪回</h4><p>1、启动表的row movement特性</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> FX_MXZXRW ENABLE <span class="type">ROW</span> MOVEMENT;</span><br></pre></td></tr></table></figure><p>2、闪回指定时间的快照</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLASHBACK <span class="keyword">TABLE</span> FX_MXZXRW <span class="keyword">TO</span> <span class="type">TIMESTAMP</span> TO_TIMESTAMP(<span class="string">&#x27;2021-02-05 13:45:00&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>);</span><br></pre></td></tr></table></figure><p>3、关闭表的row movement功能</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> FX_MXZXRW DISABLE <span class="type">ROW</span> MOVEMENT;</span><br></pre></td></tr></table></figure><h4 id="jmap使用"><a href="#jmap使用" class="headerlink" title="jmap使用"></a>jmap使用</h4><p>线程对应系统占用情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -heap [pid]</span><br></pre></td></tr></table></figure><p>生成dump文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:format=b,file=20210225.dump.hprof [pid]</span><br></pre></td></tr></table></figure><h4 id="Linux安装wps"><a href="#Linux安装wps" class="headerlink" title="Linux安装wps"></a>Linux安装wps</h4><p>rpm包下载地址</p><p><a class="link"   href="https://linux.wps.cn/" >https://linux.wps.cn/<i class="fas fa-external-link-alt"></i></a></p><p>安装rpm包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum localinstall wps-office-11.1.0.10161-1.x86_64.rpm</span><br></pre></td></tr></table></figure><h4 id="Centos-7安装可视化桌面"><a href="#Centos-7安装可视化桌面" class="headerlink" title="Centos 7安装可视化桌面"></a>Centos 7安装可视化桌面</h4><p>首先安装X(X Window System)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&quot;X Window System&quot;</span></span><br></pre></td></tr></table></figure><p>安装可视化桌面</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">&quot;GNOME Desktop&quot;</span></span><br></pre></td></tr></table></figure><p>启动(如果启动失败，重启<code>reboot</code>)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startx</span><br></pre></td></tr></table></figure><h4 id="sublime-text右键菜单"><a href="#sublime-text右键菜单" class="headerlink" title="sublime_text右键菜单"></a>sublime_text右键菜单</h4><blockquote><p>sublime_text安装目录根路径执行</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@ECHO OFF &amp; PUSHD %~DP0 &amp; TITLE</span><br><span class="line">&gt;NUL 2&gt;&amp;1 REG.exe query <span class="string">&quot;HKU\S-1-5-19&quot;</span> || (</span><br><span class="line">    ECHO SET UAC = CreateObject^(<span class="string">&quot;Shell.Application&quot;</span>^) &gt; <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    ECHO UAC.ShellExecute <span class="string">&quot;%~f0&quot;</span>, <span class="string">&quot;%1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;runas&quot;</span>, 1 &gt;&gt; <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span></span><br><span class="line">    DEL /f /q <span class="string">&quot;%TEMP%\Getadmin.vbs&quot;</span> 2&gt;NUL</span><br><span class="line">    Exit /b</span><br><span class="line">)</span><br><span class="line">SET /P ST=输入a添加右键菜单，输入d删除右键菜单：</span><br><span class="line"><span class="keyword">if</span> /I <span class="string">&quot;%ST%&quot;</span>==<span class="string">&quot;a&quot;</span> goto Add</span><br><span class="line"><span class="keyword">if</span> /I <span class="string">&quot;%ST%&quot;</span>==<span class="string">&quot;d&quot;</span> goto Remove</span><br><span class="line">:Add</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /t REG_SZ /v <span class="string">&quot;&quot;</span> /d <span class="string">&quot;用 &amp;Sublime Text 打开&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /t REG_EXPAND_SZ /v <span class="string">&quot;Icon&quot;</span> /d <span class="string">&quot;%~dp0sublime_text.exe&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text\command&quot;</span> /t REG_SZ /v <span class="string">&quot;&quot;</span> /d <span class="string">&quot;%~dp0sublime_text.exe \&quot;%%1\&quot;&quot;</span> /f</span><br><span class="line"> </span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">:Remove</span><br><span class="line">reg delete <span class="string">&quot;HKEY_CLASSES_ROOT\*\shell\Sublime Text&quot;</span> /f</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h4 id="java环境变量配置"><a href="#java环境变量配置" class="headerlink" title="java环境变量配置"></a>java环境变量配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">::添加环境变量JAVA_HOME</span><br><span class="line">::<span class="built_in">echo</span> off 表示在批处理文件执行过程中，只显示结果，而不显示执行的命令</span><br><span class="line">@<span class="built_in">echo</span> on</span><br><span class="line"><span class="built_in">echo</span> 添加Java环境变量</span><br><span class="line">setx /M JAVA_HOME <span class="string">&quot;C:\Program Files\Java\jdk1.8.0_171&quot;</span></span><br><span class="line">setx /M Path <span class="string">&quot;%Path%;%%JAVA_HOME%%\bin;%%JAVA_HOME%%\jre\bin;&quot;</span></span><br><span class="line">setx /M CLASSPATH <span class="string">&quot;.;%%JAVA_HOME%%\lib\dt.jar;%%JAVA_HOME%%\lib\tools.jar;&quot;</span></span><br><span class="line">::pause命令运行后会中断执行的语句。这个中断不是立即停止，只是暂停</span><br><span class="line">::按下任意键之后就会继续执行下面的语句。</span><br><span class="line">pause</span><br><span class="line">::添加环境变量之后不会在本cmd窗口生效，所以%JAVA_HOME%没有值</span><br><span class="line">::需要输入  %%JAVA_HOME%% 显示 %JAVA_HOME%</span><br></pre></td></tr></table></figure><h4 id="nginx启动"><a href="#nginx启动" class="headerlink" title="nginx启动"></a>nginx启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;help&quot;</span> (goto <span class="built_in">help</span>) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;-h&quot;</span> goto <span class="built_in">help</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;version&quot;</span> (goto version) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;-v&quot;</span> goto version)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;start&quot;</span> goto start</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;stop&quot;</span> goto stop</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;reload&quot;</span> goto reload</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;reopen&quot;</span> goto reopen</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span>==<span class="string">&quot;find&quot;</span> goto find</span><br><span class="line">goto error</span><br><span class="line"></span><br><span class="line">:<span class="built_in">help</span></span><br><span class="line">nginx -v</span><br><span class="line"><span class="built_in">echo</span> Usage: nginxd [-h,<span class="built_in">help</span>] [-v,version] [start] [stop] [stop -a] [reload] [reopen] [find]</span><br><span class="line"><span class="built_in">echo</span>=</span><br><span class="line"><span class="built_in">echo</span> Options:</span><br><span class="line"><span class="built_in">echo</span>   <span class="built_in">help</span>,-h         : this <span class="built_in">help</span></span><br><span class="line"><span class="built_in">echo</span>   version,-v      : show current nginx version</span><br><span class="line"><span class="built_in">echo</span>   start           : start nginx master process</span><br><span class="line"><span class="built_in">echo</span>   stop            : stop the newest nginx master process</span><br><span class="line"><span class="built_in">echo</span>   stop -a         : stop all nginx master processes</span><br><span class="line"><span class="built_in">echo</span>   reload          : reload configuration</span><br><span class="line"><span class="built_in">echo</span>   reopen          : reopen nginx</span><br><span class="line"><span class="built_in">echo</span>   find            : show the nginx master process list</span><br><span class="line"><span class="built_in">echo</span>=</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:version</span><br><span class="line">nginx -v</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:start</span><br><span class="line">start nginx -p D:\Programs\Nginx</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:stop</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%2&quot;</span>==<span class="string">&quot;-a&quot;</span> (taskkill /F /IM nginx.exe) <span class="keyword">else</span> (<span class="keyword">if</span> <span class="string">&quot;%2&quot;</span>==<span class="string">&quot;&quot;</span> (nginx -s stop -p D:\Programs\Nginx) <span class="keyword">else</span> goto error)</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:reload</span><br><span class="line">nginx -s reload -p D:\Programs\Nginx</span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:find</span><br><span class="line">tasklist /<span class="keyword">fi</span> <span class="string">&quot;imagename eq nginx.exe&quot;</span></span><br><span class="line"><span class="built_in">exit</span> /B</span><br><span class="line"></span><br><span class="line">:error</span><br><span class="line"><span class="built_in">echo</span> nginxd: invalid option: <span class="string">&quot;%1 %2&quot;</span></span><br><span class="line"><span class="built_in">echo</span>=   </span><br><span class="line"><span class="built_in">exit</span> /B</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;数据闪回&quot;&gt;&lt;a href=&quot;#数据闪回&quot; class=&quot;headerlink&quot; title=&quot;数据闪回&quot;&gt;&lt;/a&gt;数据闪回&lt;/h4&gt;&lt;p&gt;1、启动表的row movement特性&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;</summary>
      
    
    
    
    <category term="其他" scheme="https://valtenhyl.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
    <category term="杂记" scheme="https://valtenhyl.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Live Template</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/IDEA/LiveTemplate/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/IDEA/LiveTemplate/</id>
    <published>2020-12-30T04:30:25.000Z</published>
    <updated>2021-10-29T06:58:14.282Z</updated>
    
    <content type="html"><![CDATA[<h2 id="方法带参数返回值"><a href="#方法带参数返回值" class="headerlink" title="方法带参数返回值"></a>方法带参数返回值</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>之前设置idea liveTemplate 方法注释的时候，按照网上的教程params,return参数无法获取，现在终于解决这个问题了，我将详细介绍配置的每一步。</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><h4 id="打开设置Settings"><a href="#打开设置Settings" class="headerlink" title="打开设置Settings"></a>打开设置Settings</h4><h4 id="找到Live-Templates"><a href="#找到Live-Templates" class="headerlink" title="找到Live Templates"></a>找到Live Templates</h4><h4 id="新建Template-Group"><a href="#新建Template-Group" class="headerlink" title="新建Template Group"></a>新建Template Group</h4><h4 id="新建Live-Template"><a href="#新建Live-Template" class="headerlink" title="新建Live Template"></a>新建Live Template</h4><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/livetemplate_mc_01.png"                      alt="livetemplate_mc_01.png"                ></p><h5 id="模板名字："><a href="#模板名字：" class="headerlink" title="模板名字："></a>模板名字：</h5><p><code>*</code></p><h5 id="模板代码："><a href="#模板代码：" class="headerlink" title="模板代码："></a>模板代码：</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line"> * $des$</span><br><span class="line"> * </span><br><span class="line"> * @author huangyuanli</span><br><span class="line"> * @date $date$ $time$ </span><br><span class="line">$param$</span><br><span class="line">$return$</span><br><span class="line"> **/</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/livetemplate_mc_02.png"                      alt="livetemplate_mc_02.png"                ></p><h5 id="param参数内容："><a href="#param参数内容：" class="headerlink" title="param参数内容："></a>param参数内容：</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(<span class="string">&quot;def result=&#x27;&#x27;; def params=\&quot;$&#123;_1&#125;\&quot;.replaceAll(&#x27;[\\\\[|\\\\]|\\\\s]&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;).toList(); for(i = 0; i &lt; params.size(); i++) &#123;result+=&#x27; * @param\\t&#x27; + params[i] + &#x27;\\t&#x27; + ((i &lt; params.size() - 1) ? &#x27;\\n&#x27; : &#x27;&#x27;)&#125;; return result&quot;</span>, methodParameters())</span><br></pre></td></tr></table></figure><h5 id="return参数内容："><a href="#return参数内容：" class="headerlink" title="return参数内容："></a>return参数内容：</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(<span class="string">&quot;def returnType = \&quot;$&#123;_1&#125;\&quot;; def result = &#x27; * @return &#x27; + returnType; return result;&quot;</span>, methodReturnType());</span><br></pre></td></tr></table></figure><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p>输入 <code>/**</code> ，然后按 <code>Tab</code> 键，效果如下：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/livetemplate_mc_03.png"                      alt="livetemplate_mc_03.png"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;方法带参数返回值&quot;&gt;&lt;a href=&quot;#方法带参数返回值&quot; class=&quot;headerlink&quot; title=&quot;方法带参数返回值&quot;&gt;&lt;/a&gt;方法带参数返回值&lt;/h2&gt;&lt;h3 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="IDEA" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/IDEA/"/>
    
    
    <category term="IDEA" scheme="https://valtenhyl.github.io/tags/IDEA/"/>
    
    <category term="Live Template" scheme="https://valtenhyl.github.io/tags/Live-Template/"/>
    
  </entry>
  
  <entry>
    <title>代码片段</title>
    <link href="https://valtenhyl.github.io/%E5%85%B6%E4%BB%96/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/"/>
    <id>https://valtenhyl.github.io/%E5%85%B6%E4%BB%96/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</id>
    <published>2020-12-25T03:18:25.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AES-加密"><a href="#AES-加密" class="headerlink" title="AES 加密"></a>AES 加密</h2><h3 id="后端代码"><a href="#后端代码" class="headerlink" title="后端代码"></a>后端代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.AlgorithmParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: AESUtil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 对称加密AES算法，前端cryptojs实现，后端Java实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: huangyuanli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2019/2/21 10:22</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AESUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = Logger.getLogger(AESUtil.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSFORMATION = <span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHM = <span class="string">&quot;AES&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CHARSET = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建议为16位或32位</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY = <span class="string">&quot;1234123412ABCDEF&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须16位</span></span><br><span class="line"><span class="comment">     * 初始化向量IV不可以为32位，否则异常java.security.InvalidAlgorithmParameterException: Wrong IV length: must be 16 bytes long</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IV = <span class="string">&quot;ABCDEF1234123412&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] decode = context.getBytes(CHARSET);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = createKeyAndIv(decode, Cipher.ENCRYPT_MODE);</span><br><span class="line">            <span class="keyword">return</span> Base64.getEncoder().encodeToString(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Base64.Decoder decoder = Base64.getDecoder();</span><br><span class="line">            <span class="keyword">byte</span>[] decode = decoder.decode(context);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = createKeyAndIv(decode, Cipher.DECRYPT_MODE);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, CHARSET);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.debug(<span class="string">&quot;context：&quot;</span> + context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取key &amp; iv</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] createKeyAndIv(<span class="keyword">byte</span>[] context, <span class="keyword">int</span> opmode) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] key = KEY.getBytes(CHARSET);</span><br><span class="line">        <span class="keyword">byte</span>[] iv = IV.getBytes(CHARSET);</span><br><span class="line">        <span class="keyword">return</span> cipherFilter(context, opmode, key, iv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] cipherFilter(<span class="keyword">byte</span>[] context, <span class="keyword">int</span> opmode, <span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[] iv) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Key secretKeySpec = <span class="keyword">new</span> SecretKeySpec(key, ALGORITHM);</span><br><span class="line">        AlgorithmParameterSpec ivParameterSpec = <span class="keyword">new</span> IvParameterSpec(iv);</span><br><span class="line">        Cipher cipher = Cipher.getInstance(TRANSFORMATION);</span><br><span class="line">        cipher.init(opmode, secretKeySpec, ivParameterSpec);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端代码"><a href="#前端代码" class="headerlink" title="前端代码"></a>前端代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加密</span></span><br><span class="line"><span class="attr">getAesString</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key = CryptoJS.enc.Utf8.parse(<span class="string">&quot;1234123412ABCDEF&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> iv  = CryptoJS.enc.Utf8.parse(<span class="string">&quot;ABCDEF1234123412&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> encrypted = CryptoJS.AES.encrypt(data, key,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">iv</span>:iv,</span><br><span class="line">        <span class="attr">mode</span>:CryptoJS.mode.CBC,</span><br><span class="line">        <span class="attr">padding</span>:CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//返回的是base64格式的密文</span></span><br><span class="line">    <span class="keyword">return</span> encrypted.toString();</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//解密</span></span><br><span class="line"><span class="attr">getDAesString</span>: <span class="function"><span class="keyword">function</span>(<span class="params">encrypted</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key = CryptoJS.enc.Utf8.parse(<span class="string">&quot;1234123412ABCDEF&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> iv  = CryptoJS.enc.Utf8.parse(<span class="string">&quot;ABCDEF1234123412&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> decrypted = CryptoJS.AES.decrypt(encrypted, key,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">iv</span>:iv,</span><br><span class="line">        <span class="attr">mode</span>:CryptoJS.mode.CBC,</span><br><span class="line">        <span class="attr">padding</span>:CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> decrypted.toString(CryptoJS.enc.Utf8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Base64与图片互转"><a href="#Base64与图片互转" class="headerlink" title="Base64与图片互转"></a>Base64与图片互转</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Decoder;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图片转为Base64字符串</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConvertImgToBase64</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//base64ToImg(base64, &quot;D:/hczz.png&quot;);</span></span><br><span class="line"><span class="comment">//String base64Str = imgToBase64(&quot;D:/longmao.png&quot;);</span></span><br><span class="line"><span class="comment">//System.out.println(isImage(base64));</span></span><br><span class="line"><span class="comment">//writeToFile(base64Str, null, null);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">imgToBase64</span><span class="params">(String imgPath)</span> </span>&#123;</span><br><span class="line">InputStream in = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</span><br><span class="line">String encode = <span class="keyword">null</span>;</span><br><span class="line">BASE64Encoder encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">in = <span class="keyword">new</span> FileInputStream(imgPath);</span><br><span class="line">data = <span class="keyword">new</span> <span class="keyword">byte</span>[in.available()];</span><br><span class="line">in.read(data);</span><br><span class="line">encode = encoder.encode(data);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">in.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 去掉换行</span></span><br><span class="line"><span class="keyword">if</span> (StringUtils.isNotBlank(encode)) &#123;</span><br><span class="line">encode = encode.replaceAll(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> encode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">base64ToImg</span><span class="params">(String base64Str, String imgPath)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isNotBlank(base64Str)) &#123;</span><br><span class="line">BASE64Decoder decoder = <span class="keyword">new</span> BASE64Decoder();</span><br><span class="line">OutputStream out = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">out = <span class="keyword">new</span> FileOutputStream(imgPath);</span><br><span class="line"><span class="keyword">byte</span>[] b = decoder.decodeBuffer(base64Str);</span><br><span class="line">out.write(b);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToFile</span><span class="params">(String str, String path, String fileName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isNotBlank(str)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">String newFileName = StringUtils.isBlank(fileName) ? <span class="string">&quot;file&quot;</span> : fileName;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isNotBlank(path)) &#123;</span><br><span class="line">File dir = <span class="keyword">new</span> File(path);</span><br><span class="line"><span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">dir.createNewFile();</span><br><span class="line">&#125;</span><br><span class="line">newFileName = path + File.separator + newFileName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(newFileName);</span><br><span class="line"><span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">file.createNewFile();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FileWriter fileWriter = <span class="keyword">new</span> FileWriter(file.getName(), <span class="keyword">true</span>);</span><br><span class="line">fileWriter.write(str);</span><br><span class="line">fileWriter.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isImage</span><span class="params">(String imgBase64Str)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtils.isBlank(imgBase64Str)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ByteArrayInputStream byteArrayInputStream = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">BASE64Decoder decoder = <span class="keyword">new</span> BASE64Decoder();</span><br><span class="line"><span class="keyword">byte</span>[] byteArray = decoder.decodeBuffer(imgBase64Str);</span><br><span class="line">byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(byteArray);</span><br><span class="line">BufferedImage bufImg = ImageIO.read(byteArrayInputStream);</span><br><span class="line"><span class="keyword">if</span> (bufImg == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (byteArrayInputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">byteArrayInputStream.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ConcurrentHashmap"><a href="#ConcurrentHashmap" class="headerlink" title="ConcurrentHashmap"></a>ConcurrentHashmap</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentHashmapTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//循环次数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOOP_COUNT = <span class="number">10000000</span>;</span><br><span class="line">    <span class="comment">//线程数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THREAD_COUNT = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//元素数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_COUNT = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Long&gt; <span class="title">normaluse</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        ConcurrentHashMap&lt;String, Long&gt; freqs = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(ITEM_COUNT);</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool(THREAD_COUNT);</span><br><span class="line">        forkJoinPool.execute(() -&gt; IntStream.rangeClosed(<span class="number">1</span>, LOOP_COUNT).parallel().forEach(i -&gt; &#123;</span><br><span class="line">                    <span class="comment">//获得一个随机的Key</span></span><br><span class="line">                    String key = <span class="string">&quot;item&quot;</span> + ThreadLocalRandom.current().nextInt(ITEM_COUNT);</span><br><span class="line">                    <span class="keyword">synchronized</span> (freqs) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (freqs.containsKey(key)) &#123;</span><br><span class="line">                            <span class="comment">//Key存在则+1</span></span><br><span class="line">                            freqs.put(key, freqs.get(key) + <span class="number">1</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">//Key不存在则初始化为1</span></span><br><span class="line">                            freqs.put(key, <span class="number">1L</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        ));</span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">        forkJoinPool.awaitTermination(<span class="number">1</span>, TimeUnit.HOURS);</span><br><span class="line">        <span class="keyword">return</span> freqs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Long&gt; <span class="title">gooduse</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        ConcurrentHashMap&lt;String, LongAdder&gt; freqs = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(ITEM_COUNT);</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool(THREAD_COUNT);</span><br><span class="line">        forkJoinPool.execute(() -&gt; IntStream.rangeClosed(<span class="number">1</span>, LOOP_COUNT).parallel().forEach(i -&gt; &#123;</span><br><span class="line">                    String key = <span class="string">&quot;item&quot;</span> + ThreadLocalRandom.current().nextInt(ITEM_COUNT);</span><br><span class="line">                    <span class="comment">//利用computeIfAbsent()方法来实例化LongAdder，然后利用LongAdder来进行线程安全计数</span></span><br><span class="line">                    freqs.computeIfAbsent(key, k -&gt; <span class="keyword">new</span> LongAdder()).increment();</span><br><span class="line">                &#125;</span><br><span class="line">        ));</span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">        forkJoinPool.awaitTermination(<span class="number">1</span>, TimeUnit.HOURS);</span><br><span class="line">        <span class="comment">//因为我们的Value是LongAdder而不是Long，所以需要做一次转换才能返回</span></span><br><span class="line">        <span class="keyword">return</span> freqs.entrySet().stream()</span><br><span class="line">                .collect(Collectors.toMap(Map.Entry::getKey, e -&gt; e.getValue().longValue())</span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">        stopWatch.start(<span class="string">&quot;normaluse&quot;</span>);</span><br><span class="line">        Map&lt;String, Long&gt; normaluse = normaluse();</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="comment">//校验元素数量</span></span><br><span class="line">        Assert.isTrue(normaluse.size() == ITEM_COUNT, <span class="string">&quot;normaluse size error&quot;</span>);</span><br><span class="line">        <span class="comment">//校验累计总数</span></span><br><span class="line">        Assert.isTrue(normaluse.values().stream()</span><br><span class="line">                        .mapToLong(l -&gt; l).reduce(<span class="number">0</span>, Long::sum) == LOOP_COUNT</span><br><span class="line">                , <span class="string">&quot;normaluse count error&quot;</span>);</span><br><span class="line">        stopWatch.start(<span class="string">&quot;gooduse&quot;</span>);</span><br><span class="line">        Map&lt;String, Long&gt; gooduse = gooduse();</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        Assert.isTrue(gooduse.size() == ITEM_COUNT, <span class="string">&quot;gooduse size error&quot;</span>);</span><br><span class="line">        Assert.isTrue(gooduse.values().stream()</span><br><span class="line">                        .mapToLong(l -&gt; l)</span><br><span class="line">                        .reduce(<span class="number">0</span>, Long::sum) == LOOP_COUNT</span><br><span class="line">                , <span class="string">&quot;gooduse count error&quot;</span>);</span><br><span class="line">        System.out.println(stopWatch.prettyPrint());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通过反射给对象赋值"><a href="#通过反射给对象赋值" class="headerlink" title="通过反射给对象赋值"></a>通过反射给对象赋值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析反馈数据，并转换成对应的反馈对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xis</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-01-14 17:39</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResolveFeedbackData</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">FbBaseInfo</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">resolveFbData</span><span class="params">(Class&lt;T&gt; tClass, String sjxsm, List&lt;String&gt; sjxnr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(sjxnr)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] sjxsms = sjxsm.split(<span class="string">&quot;\\|\\|&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据项说明字段个数</span></span><br><span class="line">        <span class="keyword">int</span> sjxsmLen = sjxsms.length;</span><br><span class="line">        <span class="comment">// 数据项说明字段</span></span><br><span class="line">        String[] sFields = <span class="keyword">new</span> String[sjxsmLen];</span><br><span class="line">        <span class="comment">// 下划线连接改成驼峰命名</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sjxsms.length; i++) &#123;</span><br><span class="line">            String tmp = underlineToCamel(sjxsms[i].trim());</span><br><span class="line">            sFields[i] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 解析后的结果</span></span><br><span class="line">        <span class="keyword">return</span> sjxnr.stream().collect(ArrayList::<span class="keyword">new</span>, (list, sjx) -&gt; &#123;</span><br><span class="line">            String[] sjxs = sjx.split(<span class="string">&quot;\\|\\|&quot;</span>);</span><br><span class="line">            <span class="comment">// 数据内容长度</span></span><br><span class="line">            <span class="keyword">int</span> sjxLen = sjxs.length;</span><br><span class="line">            <span class="keyword">if</span> (sjxsmLen == sjxLen) &#123;</span><br><span class="line">                <span class="comment">// 获取源对象的所有属性</span></span><br><span class="line">                Field[] tFields = tClass.getDeclaredFields();</span><br><span class="line">                <span class="comment">// 通过类的详情信息，创建目标对象 这一步等同于UserTwo target = new UserTwo()；</span></span><br><span class="line">                T target = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    target = tClass.newInstance();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sjxs.length; i++) &#123;</span><br><span class="line">                    String sjxStr = sjxs[i].trim();</span><br><span class="line">                    <span class="comment">// 数据项说明</span></span><br><span class="line">                    String sField = sFields[i];</span><br><span class="line">                    <span class="comment">// 循环对象的每一个属性</span></span><br><span class="line">                    <span class="keyword">for</span> (Field tField : tFields) &#123;</span><br><span class="line">                        <span class="comment">// 判断源对象的属性名是否和目标对象的属性名一致</span></span><br><span class="line">                        <span class="keyword">if</span> (StringUtils.uncapitalize(sField).equals(tField.getName())) &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="comment">// 属性的set方法名</span></span><br><span class="line">                                String tMethodName = <span class="string">&quot;set&quot;</span> + sField;</span><br><span class="line">                                <span class="comment">// 获得属性的set方法</span></span><br><span class="line">                                Method tMethod = tClass.getMethod(tMethodName, tField.getType());</span><br><span class="line">                                <span class="comment">// 获取字段类型</span></span><br><span class="line">                                String genericType = tField.getGenericType().toString();</span><br><span class="line">                                <span class="comment">// 字段值</span></span><br><span class="line">                                Object sjxVal = <span class="keyword">null</span>;</span><br><span class="line">                                <span class="keyword">switch</span> (genericType) &#123;</span><br><span class="line">                                    <span class="keyword">case</span> <span class="string">&quot;class java.lang.String&quot;</span>:</span><br><span class="line">                                        sjxVal = sjxStr.trim();</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">case</span> <span class="string">&quot;class java.lang.Integer&quot;</span>:</span><br><span class="line">                                        sjxVal = Integer.parseInt(sjxStr.trim());</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">case</span> <span class="string">&quot;class java.lang.Double&quot;</span>:</span><br><span class="line">                                        sjxVal = Double.parseDouble(sjxStr.trim());</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">case</span> <span class="string">&quot;class java.util.Date&quot;</span>:</span><br><span class="line">                                        <span class="comment">// 获取注解的日期格式值</span></span><br><span class="line">                                        JSONField jsonField = tField.getAnnotation(JSONField.class);</span><br><span class="line">                                        String datePattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">                                        <span class="keyword">if</span> (jsonField != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                            datePattern = jsonField.format();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="comment">// 日期格式化</span></span><br><span class="line">                                        sjxVal = DateUtil.convertStringToDate(datePattern, sjxStr.trim());</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    <span class="keyword">default</span>:</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// 调用set方法，并将值作为参数传入</span></span><br><span class="line">                                tMethod.invoke(target, sjxVal);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                                e.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, List::addAll);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@describe</span>: 下划线转驼峰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>: str</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>: String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>: huangyuanli</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span>: 2020/1/16 12:29</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">underlineToCamel</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(str.trim())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Arrays.asList(str.split(<span class="string">&quot;_&quot;</span>)).forEach(temp -&gt; builder.append(StringUtils.capitalize(temp)));</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;pass_code || start_place || end_place || order_create_time || order_begin_time || order_end_time || traveltype || city || driver_code&quot;</span>;</span><br><span class="line"><span class="comment">//        String[] split = str.split(&quot;\\|\\|&quot;);</span></span><br><span class="line"><span class="comment">//        for (String s : split) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(s.trim());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        for (String s : split) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(underlineToCamel(s.trim()));</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; tClass = DiDiOrder.class;</span><br><span class="line"><span class="comment">//Field[] declaredFields = tClass.getDeclaredFields();</span></span><br><span class="line"><span class="comment">//for (Field declaredField : declaredFields) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(declaredField.getName());</span></span><br><span class="line"><span class="comment">//JSONField annotation = declaredField.getAnnotation(JSONField.class);</span></span><br><span class="line"><span class="comment">//            if (annotation != null) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(annotation.format());</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">        List&lt;String&gt; objects = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        objects.add(<span class="string">&quot;13888848688 || 出发地1 || 目的地2 || 2019-12-21 09:10:32 || 2019-12-21 09:15:36 || 2019-12-21 09:55:39 || 出租车 || 上海市 || 13616678887&quot;</span>);</span><br><span class="line">        objects.add(<span class="string">&quot;13888848688 || 出发地1 || 目的地2 || 2019-12-22 13:10:32 || 2019-12-22 13:15:36 || 2019-12-22 13:55:39 || 出租车 || 上海市 || 13936823456&quot;</span>);</span><br><span class="line">        ResolveFeedbackData resolveFeedbackData = <span class="keyword">new</span> ResolveFeedbackData();</span><br><span class="line">        List list = resolveFeedbackData.resolveFbData(tClass, str, objects);</span><br><span class="line">        <span class="keyword">for</span> (Object o : list) &#123;</span><br><span class="line">            System.out.println(o.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DiDiOrder</span> <span class="keyword">extends</span> <span class="title">FbBaseInfo</span> </span>&#123;</span><br><span class="line">        String passCode;</span><br><span class="line">        String startPlace;</span><br><span class="line">        String endPlace;</span><br><span class="line"><span class="meta">@JSONField(format = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">        Date orderCreateTime;</span><br><span class="line"><span class="meta">@JSONField(format = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">        Date orderBeginTime;</span><br><span class="line"><span class="meta">@JSONField(format = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">        Date orderEndTime;</span><br><span class="line">        String traveltype;</span><br><span class="line">        String city;</span><br><span class="line">        String driverCode;</span><br><span class="line">        String test;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPassCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> passCode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassCode</span><span class="params">(String passCode)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.passCode = passCode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getStartPlace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> startPlace;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartPlace</span><span class="params">(String startPlace)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.startPlace = startPlace;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getEndPlace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> endPlace;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndPlace</span><span class="params">(String endPlace)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.endPlace = endPlace;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getOrderCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> orderCreateTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderCreateTime</span><span class="params">(Date orderCreateTime)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.orderCreateTime = orderCreateTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getOrderBeginTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> orderBeginTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderBeginTime</span><span class="params">(Date orderBeginTime)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.orderBeginTime = orderBeginTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getOrderEndTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> orderEndTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderEndTime</span><span class="params">(Date orderEndTime)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.orderEndTime = orderEndTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getTraveltype</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> traveltype;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTraveltype</span><span class="params">(String traveltype)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.traveltype = traveltype;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> city;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.city = city;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getDriverCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> driverCode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriverCode</span><span class="params">(String driverCode)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.driverCode = driverCode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> test;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTest</span><span class="params">(String test)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.test = test;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;DiDiOrder&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;passCode=&#x27;&quot;</span> + passCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, startPlace=&#x27;&quot;</span> + startPlace + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, endPlace=&#x27;&quot;</span> + endPlace + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, orderCreateTime=&quot;</span> + orderCreateTime +</span><br><span class="line">                    <span class="string">&quot;, orderBeginTime=&quot;</span> + orderBeginTime +</span><br><span class="line">                    <span class="string">&quot;, orderEndTime=&quot;</span> + orderEndTime +</span><br><span class="line">                    <span class="string">&quot;, traveltype=&#x27;&quot;</span> + traveltype + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, city=&#x27;&quot;</span> + city + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, driverCode=&#x27;&quot;</span> + driverCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&quot;, test=&#x27;&quot;</span> + test + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="日期工具类"><a href="#日期工具类" class="headerlink" title="日期工具类"></a>日期工具类</h2><h3 id="SimpleDateFormat"><a href="#SimpleDateFormat" class="headerlink" title="SimpleDateFormat"></a>SimpleDateFormat</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hisign.xzxt2.common.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.time.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日期处理共通方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@classname</span> CommonUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016年7月13日 下午4:23:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtil</span> <span class="keyword">extends</span> <span class="title">DateUtils</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Log log = LogFactory.getLog(DateUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] parsePatterns = &#123; <span class="string">&quot;yyyy-MM-dd&quot;</span>, <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, <span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>,</span><br><span class="line">            <span class="string">&quot;yyyy/MM/dd&quot;</span>, <span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>, <span class="string">&quot;yyyy/MM/dd HH:mm&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datePattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 时间格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String timePattern = <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期时间格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期时间格式2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern2 = <span class="string">&quot;yyyyMMddHHmmss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中文日期格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datePattern_CN = <span class="string">&quot;yyyy年M月d日&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中文日期时间格式 精确到分</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern_CN = <span class="string">&quot;yyyy年M月d日H时m分&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 从message.properties中获取date.default_format对应的日期格式</span></span><br><span class="line"><span class="comment">    * 默认日期格式:yyyy-MM-dd</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 13:57</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 日期格式，默认:yyyy-MM-dd</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDatePattern</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> datePattern;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Date类型的日期转化成String类型的日期</span></span><br><span class="line"><span class="comment">    * 默认日期格式:yyyy-MM-dd</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 14:00</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> aDate 日期</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> string类型的日期</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">getDate</span><span class="params">(Date aDate)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">null</span>;</span><br><span class="line">        String returnValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (aDate != <span class="keyword">null</span>) &#123;</span><br><span class="line">            df = <span class="keyword">new</span> SimpleDateFormat(datePattern);</span><br><span class="line">            returnValue = df.format(aDate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (returnValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * string类型的日期转化成指定格式Date类型</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 14:15</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> aMask 指定的格式类型</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> strDate string类型的日期</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Date类型的日期</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Date <span class="title">convertStringToDate</span><span class="params">(String aMask, String strDate)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">null</span>;</span><br><span class="line">        Date date = <span class="keyword">null</span>;</span><br><span class="line">        df = <span class="keyword">new</span> SimpleDateFormat(aMask);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="comment">// debug状态时打印的日志</span></span><br><span class="line">            log.debug(<span class="string">&quot;converting &#x27;&quot;</span> + strDate + <span class="string">&quot;&#x27; to date with mask &#x27;&quot;</span> + aMask + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 日期转化</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = df.parse(strDate);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException pe) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParseException(pe.getMessage(), pe.getErrorOffset());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * string类型的日期转化成默认Date类型的日期时间</span></span><br><span class="line"><span class="comment">    * 默认格式：yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 14:21</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> strDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 默认格式的Date</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Date <span class="title">convertStringToDateTime</span><span class="params">(String strDate)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">null</span>;</span><br><span class="line">        Date date = <span class="keyword">null</span>;</span><br><span class="line">        df = <span class="keyword">new</span> SimpleDateFormat(datetimePattern);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="comment">// debug状态时打印的日志</span></span><br><span class="line">            log.debug(<span class="string">&quot;converting &#x27;&quot;</span> + strDate + <span class="string">&quot;&#x27; to date with mask &#x27;&quot;</span> + datetimePattern + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 日期时间转化</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = df.parse(strDate);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException pe) &#123;</span><br><span class="line">            <span class="comment">// log.error(&quot;ParseException: &quot; + pe);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParseException(pe.getMessage(), pe.getErrorOffset());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取日期时间参数中的时间，返回格式为：HH:mm:ss</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 14:27</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> theTime 日期时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> string类型的时间</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTimeNow</span><span class="params">(Date theTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDateTime(timePattern, theTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取当前时间日历</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:17</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 当前时间日历</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Calendar <span class="title">getToday</span><span class="params">()</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        Date today = <span class="keyword">new</span> Date();</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(datePattern);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This seems like quite a hack (date -&gt; string -&gt; date),</span></span><br><span class="line">        <span class="comment">// but it works ;-)</span></span><br><span class="line">        String todayAsString = df.format(today);</span><br><span class="line">        Calendar cal = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">        cal.setTime(convertStringToDate(todayAsString));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Date类型日期时间转化成指定格式的string字符串日期时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> aMask 日期格式</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> aDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> string字符串日期时间</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">getDateTime</span><span class="params">(String aMask, Date aDate)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">null</span>;</span><br><span class="line">        String returnValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (aDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;aDate is null!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            df = <span class="keyword">new</span> SimpleDateFormat(aMask);</span><br><span class="line">            returnValue = df.format(aDate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Date类型日期时间转化成默认格式的string字符串日期时间</span></span><br><span class="line"><span class="comment">     * 默认格式：yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string字符串日期时间</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">getDateTime</span><span class="params">(Date aDate)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat df = <span class="keyword">null</span>;</span><br><span class="line">        String returnValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (aDate == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;aDate is null!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            df = <span class="keyword">new</span> SimpleDateFormat(datetimePattern);</span><br><span class="line">            returnValue = df.format(aDate);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (returnValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Date类型日期时间转化成默认格式的string字符串日期时间</span></span><br><span class="line"><span class="comment">     * 默认格式：yyyy-MM-dd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string字符串日期时间</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">convertDateToString</span><span class="params">(Date aDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDateTime(datePattern, aDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Date类型日期转化成指定格式的string字符串日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern 日期格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string字符串日期时间</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">convertDateToString</span><span class="params">(String pattern, Date aDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDateTime(pattern, aDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * string字符串日期转化成默认格式的Date类型日期</span></span><br><span class="line"><span class="comment">     * 默认格式：yyyy-MM-dd</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strDate 需要转化的日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Date类型日期</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">convertStringToDate</span><span class="params">(String strDate)</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">        Date aDate = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;converting date with pattern: &quot;</span> + datePattern);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            aDate = convertStringToDate(datePattern, strDate);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException pe) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Could not convert &#x27;&quot;</span> + strDate + <span class="string">&quot;&#x27; to a date, throwing exception&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParseException(pe.getMessage(), pe.getErrorOffset());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> aDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 日期类型时间比较，如果date1&gt;date2 则返回1，相等放回0，小于返回-1</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:29</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date1 日期1</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date2 日期2</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> date1&gt;date2 则返回1，相等放回0，小于返回-1</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compareDate</span><span class="params">(Date date1, Date date2)</span> </span>&#123;</span><br><span class="line">        String d1 = getDateTime(datePattern, date1);</span><br><span class="line">        String d2 = getDateTime(datePattern, date2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (d1 == <span class="keyword">null</span> &amp;&amp; d2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d1 != <span class="keyword">null</span> &amp;&amp; d2 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (d1 == <span class="keyword">null</span> &amp;&amp; d2 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> d1.compareTo(d2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 日期时间转化成中文的日期时间字符串，默认格式：yyy年M月d日H时m分</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:32</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date Date类型时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 中文的日期时间字符串</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertDatetimeToChineseString</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        DateFormat df = <span class="keyword">new</span> SimpleDateFormat(datetimePattern_CN);</span><br><span class="line">        String strDate = df.format(date);</span><br><span class="line">        <span class="keyword">return</span> strDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期转化成中文的日期字符串，默认格式：yyy年M月d日</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:32</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date Date类型时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 中文的日期时间字符串</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertDateToChineseString</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        DateFormat df = <span class="keyword">new</span> SimpleDateFormat(datePattern_CN);</span><br><span class="line">        String strDate = df.format(date);</span><br><span class="line">        <span class="keyword">return</span> strDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算2个时间的差</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> endDate 结束时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beginDate 开始时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Integer类型的天数</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">getUnm</span><span class="params">(Date endDate, Date beginDate)</span> </span>&#123;</span><br><span class="line">        Integer a = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long days = (endDate.getTime() - beginDate.getTime()) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>) + <span class="number">1</span>;</span><br><span class="line">            a = days.intValue();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(e.getMessage());</span><br><span class="line">            a = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * string类型日期时间转化成默认格式的Date类型日期</span></span><br><span class="line"><span class="comment">    * 默认格式：yyyy-MM-dd</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:40</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> time 转 date yyyy-dd-mm</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Date类型日期</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">strToDate</span><span class="params">(String time)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(datePattern);</span><br><span class="line">        Date dt = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dt = sdf.parse(time);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Date类型日期转化成指定格式的string字符串日期</span></span><br><span class="line"><span class="comment">     * 默认格式：yyyyMMddHHmmss</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2019/3/12 15:18</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aDate 需要转化的日期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string字符串日期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">convertDateToString2</span><span class="params">(Date aDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDateTime(datetimePattern2, aDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 按照yyyy-MM-dd HH:mm:ss的格式，日期转字符串</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:54</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date Date类型日期时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> String类型的日期时间</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">date2Str</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date2Str(date, datetimePattern);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 按照参数format的格式，日期转字符串</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:57</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> date Date类型日期</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> format 日期格式</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> String类型的时间</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">date2Str</span><span class="params">(Date date, String format)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (date != <span class="keyword">null</span>) &#123;</span><br><span class="line">            SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(format);</span><br><span class="line">            <span class="keyword">return</span> sdf.format(date);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Object类型日期型转化为Date类型日期，自动适配字符串格式</span></span><br><span class="line"><span class="comment">    * 格式：&#123; &quot;yyyy-MM-dd&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;, &quot;yyyy-MM-dd HH:mm&quot;, &quot;yyyy/MM/dd&quot;, &quot;yyyy/MM/dd HH:mm:ss&quot;, &quot;yyyy/MM/dd HH:mm&quot; &#125;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 15:58</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> str Object类型的时间</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Date类型日期</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">parseDate</span><span class="params">(Object str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> parseDate(str.toString(), parsePatterns);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 日期加1天</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@date</span> 2019/3/12 16:06</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> day Date类型日期</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> Date类型日期</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">toNextDay</span><span class="params">(Date day)</span> </span>&#123;</span><br><span class="line">        Calendar calendar = <span class="keyword">new</span> GregorianCalendar();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date = convertStringToDate(convertDateToString(day));</span><br><span class="line">            calendar.setTime(date);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 日期加1天</span></span><br><span class="line">        calendar.add(calendar.DATE, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> calendar.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取相对当前的日期几天的日期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> xzxt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2018/11/22 15:13</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date 时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> day int类型，可为负数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 相对当前的日期几天的日期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">getRelativeDate</span><span class="params">(Date date, <span class="keyword">int</span> day)</span> </span>&#123;</span><br><span class="line">        Calendar cal = Calendar.getInstance();</span><br><span class="line">        cal.setTime(date);</span><br><span class="line">        cal.set(Calendar.DAY_OF_YEAR, cal.get(Calendar.DAY_OF_YEAR) + day);</span><br><span class="line">        <span class="keyword">return</span> cal.getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DateTimeFormatter"><a href="#DateTimeFormatter" class="headerlink" title="DateTimeFormatter"></a>DateTimeFormatter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日期格式化工具类扩展</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> huangyuanli</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span> DateUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> com.hisign.xzxt2.hxgc.clhx.utils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/31 11:40</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datePattern = <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datePattern2 = <span class="string">&quot;yyyyMMdd&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 时间格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String timePattern = <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期时间格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日期时间格式2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern2 = <span class="string">&quot;yyyyMMddHHmmss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中文日期格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datePattern_CN = <span class="string">&quot;yyyy年M月d日&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中文日期时间格式 精确到分</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String datetimePattern_CN = <span class="string">&quot;yyyy年M月d日H时m分&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将日期字符串转成指定格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datetime 日期字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> srcPattern 源格式，就是传入日期字符串的格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetPattern 目标格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertDate</span><span class="params">(String datetime, String srcPattern, String targetPattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(datetime)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(srcPattern);</span><br><span class="line">        LocalDate ld = LocalDate.parse(datetime, dtf);</span><br><span class="line"></span><br><span class="line">        DateTimeFormatter fa = DateTimeFormatter.ofPattern(targetPattern);</span><br><span class="line">        <span class="keyword">return</span> ld.format(fa);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将时间字符串转成指定格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datetime 时间字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> srcPattern 源格式，就是传入时间字符串的格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetPattern 目标格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertDateTime</span><span class="params">(String datetime, String srcPattern, String targetPattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(datetime)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(srcPattern);</span><br><span class="line">        LocalDateTime ld = LocalDateTime.parse(datetime, dtf);</span><br><span class="line"></span><br><span class="line">        DateTimeFormatter fa = DateTimeFormatter.ofPattern(targetPattern);</span><br><span class="line">        <span class="keyword">return</span> ld.format(fa);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String d = convertDate(<span class="string">&quot;19370707&quot;</span>, datePattern2, datePattern);</span><br><span class="line">        System.out.println(d);</span><br><span class="line"></span><br><span class="line">        String dt = convertDateTime(<span class="string">&quot;19370707080925&quot;</span>, datetimePattern2, datetimePattern);</span><br><span class="line">        System.out.println(dt);</span><br><span class="line"></span><br><span class="line">        String dt2 = convertDateTime(<span class="string">&quot;1937-07-07 08:09:25&quot;</span>, datetimePattern, datetimePattern_CN);</span><br><span class="line">        System.out.println(dt2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AES-加密&quot;&gt;&lt;a href=&quot;#AES-加密&quot; class=&quot;headerlink&quot; title=&quot;AES 加密&quot;&gt;&lt;/a&gt;AES 加密&lt;/h2&gt;&lt;h3 id=&quot;后端代码&quot;&gt;&lt;a href=&quot;#后端代码&quot; class=&quot;headerlink&quot; title=&quot;后</summary>
      
    
    
    
    <category term="其他" scheme="https://valtenhyl.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
    <category term="代码片段" scheme="https://valtenhyl.github.io/tags/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/"/>
    
  </entry>
  
  <entry>
    <title>hadoop入门笔记</title>
    <link href="https://valtenhyl.github.io/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/Hadoop%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/"/>
    <id>https://valtenhyl.github.io/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/Hadoop%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/</id>
    <published>2020-11-06T07:00:21.000Z</published>
    <updated>2021-10-29T06:58:14.281Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="配置静态ip"><a href="#配置静态ip" class="headerlink" title="配置静态ip"></a>配置静态ip</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens32</span><br></pre></td></tr></table></figure><p>ifcfg-ens32</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 网络类型为以太网</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line"><span class="comment"># 设置固定ip，dhcp 改为 static</span></span><br><span class="line"><span class="comment"># BOOTPROTU=dhcp</span></span><br><span class="line">BOOTPROTU=static</span><br><span class="line"><span class="comment"># 网卡设备名，一定要跟文件名一致</span></span><br><span class="line">DEVICE=ens32</span><br><span class="line"><span class="comment"># 网卡设备名，一定要跟文件名一致</span></span><br><span class="line">NAME=ens32</span><br><span class="line"><span class="comment"># 设定网卡随网络服务启动</span></span><br><span class="line"><span class="comment"># ONBOOT=no</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># 固定ip</span></span><br><span class="line">IPADDR=192.168.40.91</span><br><span class="line"><span class="comment"># 网关</span></span><br><span class="line">GATEWAY=192.168.40.254</span><br><span class="line"><span class="comment"># 子网掩码</span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="comment"># DNS地址</span></span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line">DNS2=114.114.114.114</span><br></pre></td></tr></table></figure><p>重启网络服务，使生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启网络服务</span></span><br><span class="line">service network restart</span><br></pre></td></tr></table></figure><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hostname</span><br></pre></td></tr></table></figure><p>hostname</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop91  # reboot重启生效</span><br></pre></td></tr></table></figure><h3 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br></pre></td></tr></table></figure><p>hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ip要和网卡配置中的静态ip一致，域名要和hosts文件中的主机名一致</span></span><br><span class="line">192.168.40.91 hadoop91</span><br><span class="line">192.168.40.92 hadoop92</span><br><span class="line">192.168.40.93 hadoop93</span><br></pre></td></tr></table></figure><p>重启网络服务，使生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启网络服务</span></span><br><span class="line">service network restart</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙</span></span><br><span class="line">service iptables stop</span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用防火墙，开机自启关闭</span></span><br><span class="line">chkconfig iptables off</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙状态</span></span><br><span class="line">service iptables status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看开机自启列表</span></span><br><span class="line">chkconfig --list iptables</span><br></pre></td></tr></table></figure><p>在关闭防火墙到时候，出现：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Redirecting to /bin/systemctl stop  iptables.service</span><br><span class="line">Failed to stop iptables.service: Unit iptables.service not loaded.</span><br></pre></td></tr></table></figure><p>解决方法：</p><p><code>centos7</code>开始默认用的是<code>firewalld</code>，这个是基于<code>iptables</code>的，虽然有<code>iptables</code>的核心，但是<code>iptables</code>的服务是没安装的。所以你只要停止<code>firewalld</code>服务即可：  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装防火墙</span></span><br><span class="line">yum install firewalld firewall-config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止防火墙</span></span><br><span class="line">sudo systemctl stop firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用防火墙，开机自启关闭</span></span><br><span class="line">sudo systemctl disable firewalld</span><br></pre></td></tr></table></figure><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加用户</span></span><br><span class="line">useradd hisign</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置密码</span></span><br><span class="line">passwd hisign</span><br></pre></td></tr></table></figure><h3 id="配置用户root权限"><a href="#配置用户root权限" class="headerlink" title="配置用户root权限"></a>配置用户root权限</h3><p>修改<code>/etc/sudoers</code> </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用户 haung 可以不用密码使用sudo</span></span><br><span class="line">hisign    ALL=(ALL)    NOPASSWD: ALL</span><br></pre></td></tr></table></figure><p>该文件为root用户的只读文件，可以在<strong>root</strong>用户修改完后强制保存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ESC后，:wq! 强制保存</span></span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure><h3 id="创建文件夹"><a href="#创建文件夹" class="headerlink" title="创建文件夹"></a>创建文件夹</h3><p>创建文件夹/opt/software、/opt/module用于存放安装包和安装软件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /opt/software /opt/module</span><br></pre></td></tr></table></figure><p>修改文件夹所有者</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown hisign:hisign /opt/software /opt/module</span><br></pre></td></tr></table></figure><h3 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h3><p>首先到官网上下载你想要的jdk</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt/software</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压到指定目录</span></span><br><span class="line">tar <span class="literal">-zxvf</span> jdk<span class="literal">-8u144</span><span class="literal">-linux</span><span class="literal">-x64</span>.tar.gz <span class="literal">-C</span> /opt/module</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br></pre></td></tr></table></figure><p>输入大写的  <code>G</code>  跳转到文件末尾，在最后面添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> JAVA_HOME</span></span><br><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure><p>执行profile文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>这样可以使配置不用重启即可立即生效。</p><p>检查新安装的jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>显示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_144&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_144-b01)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</span><br></pre></td></tr></table></figure><h3 id="安装hadoop"><a href="#安装hadoop" class="headerlink" title="安装hadoop"></a>安装hadoop</h3><p>hadoop历史版本下载地址</p><p><a class="link"   href="https://archive.apache.org/dist/hadoop/common/" >https://archive.apache.org/dist/hadoop/common/<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt/software</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压到指定目录</span></span><br><span class="line">tar <span class="literal">-zxvf</span> hadoop<span class="literal">-2</span>.<span class="number">7.2</span>.tar.gz <span class="literal">-C</span> /opt/module</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br></pre></td></tr></table></figure><p>输入大写的  <code>G</code>  跳转到文件末尾，在最后面添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-2.7.2</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br></pre></td></tr></table></figure><p>执行profile文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>这样可以使配置不用重启即可立即生效。</p><p>检查新安装的jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop version</span><br></pre></td></tr></table></figure><p>到此安装结束</p><p><strong>hadoop目录结构</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x. 2 hisign hisign   194 5月  22 2017 bin</span><br><span class="line">drwxr-xr-x. 3 hisign hisign    20 5月  22 2017 etc</span><br><span class="line">drwxr-xr-x. 2 hisign hisign   106 5月  22 2017 include</span><br><span class="line">drwxr-xr-x. 3 hisign hisign    20 5月  22 2017 lib</span><br><span class="line">drwxr-xr-x. 2 hisign hisign   239 5月  22 2017 libexec</span><br><span class="line">-rw-r--r--. 1 hisign hisign 15429 5月  22 2017 LICENSE.txt</span><br><span class="line">-rw-r--r--. 1 hisign hisign   91 5月  22 2017 NOTICE.txt</span><br><span class="line">-rw-r--r--. 1 hisign hisign  1366 5月  22 2017 README.txt</span><br><span class="line">drwxr-xr-x. 2 hisign hisign  4096 5月  22 2017 sbin</span><br><span class="line">drwxr-xr-x. 4 hisign hisign    31 5月  22 2017 share</span><br></pre></td></tr></table></figure><p>重要目录</p><blockquote><p>bin目录：存放对Hadoop相关服务（HDFS,YARN）进行操作的脚本<br>etc目录：Hadoop的配置文件目录，存放Hadoop的配置文件<br>lib目录：存放Hadoop的本地库（对数据进行压缩解压缩功能）<br>sbin目录：存放启动或停止Hadoop相关服务的脚本<br>share目录：存放Hadoop的依赖jar包、文档、和官方案例</p></blockquote><h2 id="hadoop运行模式"><a href="#hadoop运行模式" class="headerlink" title="hadoop运行模式"></a>hadoop运行模式</h2><h3 id="本地运行模式"><a href="#本地运行模式" class="headerlink" title="本地运行模式"></a>本地运行模式</h3><h4 id="官方Grep案例"><a href="#官方Grep案例" class="headerlink" title="官方Grep案例"></a>官方Grep案例</h4><ul><li>在hadoop-2.7.2文件下面<strong>创建</strong>一个input文件夹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir input</span><br></pre></td></tr></table></figure><ul><li>将Hadoop的xml配置文件<strong>复制</strong>到input</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp etc/hadoop/*.xml input</span><br></pre></td></tr></table></figure><ul><li><strong>执行</strong>share目录下的MapReduce程序</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar \</span><br><span class="line">share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar \</span><br><span class="line">grep input output &#x27;dfs[a-z.]+&#x27;</span><br></pre></td></tr></table></figure><ul><li><strong>查看</strong>输出结果  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat output/*</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  dfsadmin</span><br></pre></td></tr></table></figure><h4 id="官方WordCount案例"><a href="#官方WordCount案例" class="headerlink" title="官方WordCount案例"></a>官方WordCount案例</h4><ul><li>在hadoop-2.7.2文件下面<strong>创建</strong>一个wcinput文件夹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir wcinput</span><br></pre></td></tr></table></figure><ul><li>在wcinput文件下<strong>创建</strong>一个wc.input文件  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch wcinput/wc.input</span><br></pre></td></tr></table></figure><ul><li><strong>编辑</strong>wc.input文件  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi wcinput/wc.input</span><br></pre></td></tr></table></figure><p>在文件中添加以下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hadoop yarn</span><br><span class="line">hadoop mapreduce</span><br><span class="line">atguigu</span><br><span class="line">atguigu</span><br></pre></td></tr></table></figure><ul><li><strong>执行</strong>share目录下的MapReduce程序</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar \</span><br><span class="line">share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar \</span><br><span class="line">wordcount \</span><br><span class="line">wcinput \</span><br><span class="line">wcoutput</span><br></pre></td></tr></table></figure><ul><li><strong>查看</strong>输出结果  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat wcoutput/*</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">atguigu 2</span><br><span class="line">hadoop  2</span><br><span class="line">mapreduce       1</span><br><span class="line">yarn    1</span><br></pre></td></tr></table></figure><h3 id="伪分布式运行模式"><a href="#伪分布式运行模式" class="headerlink" title="伪分布式运行模式"></a>伪分布式运行模式</h3><h4 id="启动HDFS并运行程序"><a href="#启动HDFS并运行程序" class="headerlink" title="启动HDFS并运行程序"></a>启动HDFS并运行程序</h4><h5 id="配置集群"><a href="#配置集群" class="headerlink" title="配置集群"></a>配置集群</h5><ul><li>配置 hadoop-env.sh</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/hadoop-env.sh</span><br></pre></td></tr></table></figure><p>hadoop-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><ul><li>配置 core-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure><p>core-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS中NameNode的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop91:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定Hadoop运行时产生文件的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-2.7.2/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置 hdfs-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/hdfs-site.xml</span><br></pre></td></tr></table></figure><p>hdfs-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS副本的数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h5><ul><li>格式化<strong>NameNode</strong>（第一次启动时格式化，以后就不要总格式化）  </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs namenode -format</span><br></pre></td></tr></table></figure><ul><li>启动<strong>NameNode</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/hadoop-daemon.sh start namenode</span><br></pre></td></tr></table></figure><ul><li>启动<strong>DataNode</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/hadoop-daemon.sh start datanode</span><br></pre></td></tr></table></figure><h5 id="查看集群"><a href="#查看集群" class="headerlink" title="查看集群"></a>查看集群</h5><p>查看是否启动成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ jps</span><br><span class="line">2807 NameNode</span><br><span class="line">3098 Jps</span><br><span class="line">2892 DataNode</span><br></pre></td></tr></table></figure><p><font style="color: red;">注意：jps是JDK中的命令，不是Linux命令。不安装JDK不能使用jps</font></p><p>web端查看HDFS文件系统</p><p><a class="link"   href="http://hadoop91:50070/dfshealth.html#tab-datanode" >http://hadoop91:50070/dfshealth.html#tab-datanode<i class="fas fa-external-link-alt"></i></a></p><p><font style="color: red;">如果能看，看<code>hosts</code>文件是否配置<code>hadoop91</code></font></p><p>查看产生的Log日志</p><p>说明：在企业中遇到Bug时，经常根据日志提示信息去分析问题、解决Bug。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls opt/module/hadoop-2.7.2/logs</span><br></pre></td></tr></table></figure><p><strong>思考</strong>：为什么不能一直格式化NameNode，格式化NameNode，要注意什么？</p><p><font style="color: red;">注意：格式化NameNode，会产生新的集群id,导致NameNode和DataNode的集群id不一致，集群找不到已往数据。所以，格式NameNode时，一定要先删除data数据和log日志，然后再格式化NameNode。</font></p><h5 id="操作集群"><a href="#操作集群" class="headerlink" title="操作集群"></a>操作集群</h5><ul><li>在HDFS文件系统上<strong>创建</strong>一个input文件夹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -mkdir -p /user/hisign/input</span><br></pre></td></tr></table></figure><ul><li>将测试文件内容<strong>上传</strong>到文件系统上</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -put wcinput/wc.input /user/hisign/input/</span><br></pre></td></tr></table></figure><ul><li><strong>查看</strong>上传的文件是否正确</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -ls  /user/hisign/input/</span><br><span class="line"></span><br><span class="line">bin/hdfs dfs -cat  /user/hisign/input/wc.input</span><br></pre></td></tr></table></figure><ul><li><strong>运行</strong>MapReduce程序  </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar \</span><br><span class="line">share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar \</span><br><span class="line">wordcount \</span><br><span class="line">/user/hisign/input/ \</span><br><span class="line">/user/hisign/output</span><br></pre></td></tr></table></figure><ul><li><strong>查看</strong>输出结果</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -cat /user/hisign/output/*</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">atguigu 2</span><br><span class="line">hadoop  2</span><br><span class="line">mapreduce       1</span><br><span class="line">yarn    1</span><br></pre></td></tr></table></figure><ul><li>将测试文件内容<strong>下载</strong>到本地</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -get /user/hisign/output/part-r-00000 ./wcoutput/</span><br></pre></td></tr></table></figure><ul><li><strong>删除</strong>输出结果</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -rm -r /user/hisign/output</span><br></pre></td></tr></table></figure><h4 id="启动YARN并运行程序"><a href="#启动YARN并运行程序" class="headerlink" title="启动YARN并运行程序"></a>启动YARN并运行程序</h4><h5 id="配置集群-1"><a href="#配置集群-1" class="headerlink" title="配置集群"></a>配置集群</h5><ul><li>配置 yarn-env.sh</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/yarn-env.sh</span><br></pre></td></tr></table></figure><p>yarn-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><ul><li>配置 yarn-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure><p>yarn-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Reducer获取数据的方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定YARN的ResourceManager的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop91<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置 mapred-env.sh</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/mapred-env.sh</span><br></pre></td></tr></table></figure><p>mapred-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><ul><li>配置 mapred-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp etc/hadoop/mapred-site.xml.template etc/hadoop/mapred-site.xml</span><br><span class="line"></span><br><span class="line">vim etc/hadoop/mapred-site.xml</span><br></pre></td></tr></table></figure><p>mapred-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定MR运行在YARN上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="启动集群-1"><a href="#启动集群-1" class="headerlink" title="启动集群"></a>启动集群</h5><ul><li>启动前必须保证<code>NameNode</code>和<code>DataNode</code>已经启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看是否启动</span></span><br><span class="line">jps</span><br><span class="line"></span><br><span class="line">2807 NameNode</span><br><span class="line">8217 Jps</span><br><span class="line">2892 DataNode</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 NameNode</span></span><br><span class="line">sbin/hadoop-daemon.sh start namenode</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 DataNode</span></span><br><span class="line">sbin/hadoop-daemon.sh start datanode</span><br></pre></td></tr></table></figure><ul><li>启动<code>ResourceManager</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/yarn-daemon.sh start resourcemanager</span><br></pre></td></tr></table></figure><ul><li>启动<code>NodeManager</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/yarn-daemon.sh start nodemanager</span><br></pre></td></tr></table></figure><h5 id="操作集群-1"><a href="#操作集群-1" class="headerlink" title="操作集群"></a>操作集群</h5><ul><li>YARN浏览器<strong>查看</strong>页面</li></ul><p><a class="link"   href="http://hadoop91:8088/cluster" >http://hadoop91:8088/cluster<i class="fas fa-external-link-alt"></i></a></p><ul><li><strong>删除</strong>HDFS文件系统上的output目录</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -rm -R /user/hisign/output</span><br></pre></td></tr></table></figure><ul><li><strong>执行</strong>MapReduce程序</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar \</span><br><span class="line">share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar \</span><br><span class="line">wordcount \</span><br><span class="line">/user/hisign/input  \</span><br><span class="line">/user/hisign/output</span><br></pre></td></tr></table></figure><ul><li><strong>查看</strong>运行结果</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -cat /user/hisign/output/*</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">atguigu 2</span><br><span class="line">hadoop  2</span><br><span class="line">mapreduce       1</span><br><span class="line">yarn    1</span><br></pre></td></tr></table></figure><h4 id="配置历史服务器"><a href="#配置历史服务器" class="headerlink" title="配置历史服务器"></a>配置历史服务器</h4><p>为了查看程序的历史运行情况，需要配置一下历史服务器。具体配置步骤如下</p><ul><li>配置 mapred-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/mapred-site.xml</span><br></pre></td></tr></table></figure><p>mapred-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 历史服务器端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop91:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 历史服务器web端地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop91:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>启动历史服务器</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbin/mr-jobhistory-daemon.sh start historyserver</span><br></pre></td></tr></table></figure><ul><li>查看历史服务器是否启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure><ul><li>查看JobHistory</li></ul><p><a class="link"   href="http://hadoop91:19888/jobhistory" >http://hadoop91:19888/jobhistory<i class="fas fa-external-link-alt"></i></a></p><h4 id="配置日志的聚集"><a href="#配置日志的聚集" class="headerlink" title="配置日志的聚集"></a>配置日志的聚集</h4><p>日志聚集概念：应用运行完成以后，将程序运行日志信息上传到<code>HDFS</code>系统上。</p><p>日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试。</p><p><font style="color: red">注意</font>：开启日志聚集功能，需要<strong>重新启动</strong><code>NodeManager </code>、<code>ResourceManager</code>和<code>HistoryServer</code>。</p><p>开启日志聚集功能具体步骤如下：</p><ul><li>配置 yarn-site.xml</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure><p>yarn-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志聚集功能开启 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志保留时间设置7天 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>604800<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>关闭<code>NodeManager </code>、<code>ResourceManager</code>和<code>HistoryServer</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sbin/yarn-daemon.sh stop resourcemanager</span><br><span class="line"></span><br><span class="line">sbin/yarn-daemon.sh stop nodemanager</span><br><span class="line"></span><br><span class="line">sbin/mr-jobhistory-daemon.sh stop historyserver</span><br></pre></td></tr></table></figure><ul><li>启动<code>NodeManager </code>、<code>ResourceManager</code>和<code>HistoryServer</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sbin/yarn-daemon.sh start resourcemanager</span><br><span class="line"></span><br><span class="line">sbin/yarn-daemon.sh start nodemanager</span><br><span class="line"></span><br><span class="line">sbin/mr-jobhistory-daemon.sh start historyserver</span><br></pre></td></tr></table></figure><ul><li>删除<code>HDFS</code>上已经存在的输出文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs dfs -rm -R /user/hisign/output</span><br></pre></td></tr></table></figure><ul><li>执行WordCount程序</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop jar \</span><br><span class="line">share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.2.jar \</span><br><span class="line">wordcount \</span><br><span class="line">/user/hisign/input \</span><br><span class="line">/user/hisign/output</span><br></pre></td></tr></table></figure><ul><li>查看日志</li></ul><p><a class="link"   href="http://hadoop91:19888/jobhistory" >http://hadoop91:19888/jobhistory<i class="fas fa-external-link-alt"></i></a></p><h3 id="完全分布式运行模式"><a href="#完全分布式运行模式" class="headerlink" title="完全分布式运行模式"></a>完全分布式运行模式</h3><h4 id="虚拟机准备"><a href="#虚拟机准备" class="headerlink" title="虚拟机准备"></a>虚拟机准备</h4><p>vmware中的完整克隆是基于指定的虚拟机克隆出相同的一份出来，不必再安装。但是我们要保证三个地方不能一样，一个是主机名称（hostname），还有一个是ip地址，所以我们在克隆后要对这三个地方进行修改。这里以centos为例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改主机名</span></span><br><span class="line">vim /etc/hostname</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hadoop91</span></span><br><span class="line">hadoop92</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改静态ip</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens32</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改静态ip</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IPADDR=192.168.40.91</span></span><br><span class="line">IPADDR=192.168.40.92</span><br></pre></td></tr></table></figure><p>重启生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h4 id="集群分布脚本"><a href="#集群分布脚本" class="headerlink" title="集群分布脚本"></a>集群分布脚本</h4><h5 id="scp-安全拷贝"><a href="#scp-安全拷贝" class="headerlink" title="scp 安全拷贝"></a>scp 安全拷贝</h5><ul><li>定义：</li></ul><blockquote><p>scp可以实现服务器与服务器之间的数据拷贝。（from server1 to server2）</p></blockquote><p>基本语法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">命令 递归  要拷贝的文件路径/名称  目的用户@主机:目的路径/名称</span></span><br><span class="line">scp   -r   $pdir/$fname          $user@hadoop$host:$pdir/$fname</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><p>1、在hadoop91上，将hadoop91中/opt/module目录下的软件拷贝到远程服务器hadoop92上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ scp -r /opt/module root@hadoop92:/opt/module</span><br></pre></td></tr></table></figure><p>2、在hadoop93上，将远程服务器hadoop91服务器上的/opt/module目录下的软件拷贝到本地。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop93 opt]$sudo scp -r hisign@hadoop91:/opt/module /opt/module</span><br></pre></td></tr></table></figure><p>3、在hadoop93上操作将hadoop91中/opt/module目录下的软件拷贝到hadoop94上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop93 opt]$ scp -r hisign@hadoop91:/opt/module root@hadoop94:/opt/module</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：拷贝过来的/opt/module目录，别忘了在hadoop92、hadoop93、hadoop94上修改所有文件的，所有者和所有者组。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown hisign:hisign -R /opt/module</span><br></pre></td></tr></table></figure><p>4、将hadoop91中/etc/profile文件拷贝到hadoop92的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop92:/etc/profile</span><br></pre></td></tr></table></figure><p>5、将hadoop91中/etc/profile文件拷贝到hadoop93的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop93:/etc/profile</span><br></pre></td></tr></table></figure><p>6、将hadoop91中/etc/profile文件拷贝到hadoop94的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop94:/etc/profile</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：拷贝过来的配置文件别忘了 <code>source /etc/profile </code>使生效。</p><h5 id="rsync-远程同步工具"><a href="#rsync-远程同步工具" class="headerlink" title="rsync 远程同步工具"></a>rsync 远程同步工具</h5><p>rsync主要用于备份和镜像。具有速度快、避免复制相同内容和支持符号链接的优点。</p><p>rsync和scp区别：用rsync做文件的复制要比scp的速度快，rsync只对差异文件做更新。scp是把所有文件都复制过去。</p><ul><li>基本语法</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 选项参数  要拷贝的文件路径/名称  目的用户@主机:目的路径/名称</span></span><br><span class="line">rsync   -av     $pdir/$fname         $user@hadoop$host:$pdir/$fname</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><p>把hadoop91机器上的/opt/software目录同步到hadoop92服务器的root用户下的/opt/目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av /opt/software/ hadoop92:/opt/software</span><br></pre></td></tr></table></figure><h5 id="xsync-集群分布脚本"><a href="#xsync-集群分布脚本" class="headerlink" title="xsync 集群分布脚本"></a>xsync 集群分布脚本</h5><p>1、需求：循环复制文件到所有节点的相同目录下</p><p>2、需求分析：</p><ul><li>rsync命令原始拷贝：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av   /opt/module        root@hadoop93:/opt/</span><br></pre></td></tr></table></figure><ul><li>期望脚本：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync 要同步的文件名称</span><br></pre></td></tr></table></figure><ul><li>说明：在<code>/home/hisign/bin</code>这个目录下存放的脚本，hisign用户可以在系统任何地方直接执行。</li></ul><p>3、脚本实现</p><p>在<code>/home/hisign</code>目录下创建<code>bin</code>目录，并在bin目录下<strong>xsync</strong>创建文件，文件内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  /home/hisign/bin</span><br><span class="line">cd /home/hisign/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建脚本</span></span><br><span class="line">vim xsync</span><br></pre></td></tr></table></figure><p>在该文件中编写如下代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#1 获取输入参数个数，如果没有参数，直接退出</span></span><br><span class="line">pcount=<span class="variable">$#</span></span><br><span class="line"><span class="keyword">if</span> ((pcount==0)); <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> no args;</span><br><span class="line"><span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 获取文件名称</span></span><br><span class="line">p1=<span class="variable">$1</span></span><br><span class="line">fname=`basename <span class="variable">$p1</span>`</span><br><span class="line"><span class="built_in">echo</span> fname=<span class="variable">$fname</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 获取上级目录到绝对路径</span></span><br><span class="line">pdir=`<span class="built_in">cd</span> -P $(dirname <span class="variable">$p1</span>); <span class="built_in">pwd</span>`</span><br><span class="line"><span class="built_in">echo</span> pdir=<span class="variable">$pdir</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 获取当前用户名称</span></span><br><span class="line">user=`whoami`</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 循环</span></span><br><span class="line"><span class="keyword">for</span>((host=91; host&lt;94; host++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> ------------------- hadoop<span class="variable">$host</span> --------------</span><br><span class="line">    rsync -av <span class="variable">$pdir</span>/<span class="variable">$fname</span> <span class="variable">$user</span>@hadoop<span class="variable">$host</span>:<span class="variable">$pdir</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>修改脚本 xsync 具有执行权限</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 xsync</span><br></pre></td></tr></table></figure><ul><li>调用脚本形式：xsync 文件名称</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /home/hisign/bin</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：如果将xsync放到<code>/home/hisign/bin</code>目录下仍然不能实现全局使用，可以将xsync移动到<code>/usr/local/bin</code>目录下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /home/hisign/bin/xsync /usr/local/bin</span><br></pre></td></tr></table></figure><h4 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h4><h5 id="集群部署规划"><a href="#集群部署规划" class="headerlink" title="集群部署规划"></a>集群部署规划</h5><table><thead><tr><th></th><th>hadoop91</th><th>hadoop92</th><th>hadoop93</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode  DataNode</td><td>DataNode</td><td>SecondaryNameNode  DataNode</td></tr><tr><td>YARN</td><td>NodeManager</td><td>ResourceManager  NodeManager</td><td>NodeManager</td></tr></tbody></table><h5 id="配置集群-2"><a href="#配置集群-2" class="headerlink" title="配置集群"></a>配置集群</h5><h6 id="核心配置文件"><a href="#核心配置文件" class="headerlink" title="核心配置文件"></a>核心配置文件</h6><p>配置core-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ cd /opt/module/hadoop-2.7.2/etc/hadoop</span><br><span class="line">[hisign@hadoop91 hadoop]$ vi core-site.xml</span><br></pre></td></tr></table></figure><p>在该文件中编写如下配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS中NameNode的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop91:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定Hadoop运行时产生文件的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/hadoop-2.7.2/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="HDFS配置文件"><a href="#HDFS配置文件" class="headerlink" title="HDFS配置文件"></a>HDFS配置文件</h6><p>配置hadoop-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ vi hadoop-env.sh</span><br></pre></td></tr></table></figure><p>hadoop-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><p>配置hdfs-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ vi hdfs-site.xml</span><br></pre></td></tr></table></figure><p>在该文件中编写如下配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS副本的数量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定Hadoop辅助名称节点主机配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop93:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h6 id="YARN配置文件"><a href="#YARN配置文件" class="headerlink" title="YARN配置文件"></a>YARN配置文件</h6><p>配置yarn-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ vi yarn-env.sh</span><br></pre></td></tr></table></figure><p>yarn-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><p>配置yarn-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ vi yarn-site.xml</span><br></pre></td></tr></table></figure><p>在该文件中增加如下配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Reducer获取数据的方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定YARN的ResourceManager的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop92<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="MapReduce配置文件"><a href="#MapReduce配置文件" class="headerlink" title="MapReduce配置文件"></a>MapReduce配置文件</h6><p>配置mapred-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ vi mapred-env.sh</span><br></pre></td></tr></table></figure><p>mapred-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8.0_144</span><br></pre></td></tr></table></figure><p>配置mapred-site.xml</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop]$ cp mapred-site.xml.template mapred-site.xml</span><br><span class="line">[hisign@hadoop91 hadoop]$ vi mapred-site.xml</span><br></pre></td></tr></table></figure><p>在该文件中增加如下配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定MR运行在YARN上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在集群上分发配置好的Hadoop配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /opt/module/hadoop-2.7.2/</span><br></pre></td></tr></table></figure><p>查看文件分发情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/module/hadoop-2.7.2/etc/hadoop/core-site.xml</span><br><span class="line">cat /opt/module/hadoop-2.7.2/etc/hadoop/hdfs-site.xml</span><br><span class="line">cat /opt/module/hadoop-2.7.2/etc/hadoop/yarn-site.xml</span><br><span class="line">cat /opt/module/hadoop-2.7.2/etc/hadoop/mapred-site.xml</span><br></pre></td></tr></table></figure><h4 id="集群单点启动"><a href="#集群单点启动" class="headerlink" title="集群单点启动"></a>集群单点启动</h4><p>如果集群是第一次启动，需要<font style="color:red">格式化NameNode</font></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ hdfs namenode -format</span><br></pre></td></tr></table></figure><p>在hadoop91上启动NameNode</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ hadoop-daemon.sh start namenode</span><br><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ jps</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">14849 Jps</span><br><span class="line">14782 NameNode</span><br></pre></td></tr></table></figure><p>在hadoop91、hadoop92以及hadoop93上分别启动DataNode</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ hadoop-daemon.sh start datanode</span><br><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ jps</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">14936 Jps</span><br><span class="line">14873 DataNode</span><br><span class="line">14782 NameNode</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop92 hadoop-2.7.2]$ hadoop-daemon.sh start datanode</span><br><span class="line">[hisign@hadoop92 hadoop-2.7.2]$ jps</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">14013 DataNode</span><br><span class="line">14045 Jps</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop93 hadoop-2.7.2]$ hadoop-daemon.sh start datanode</span><br><span class="line">[hisign@hadoop93 hadoop-2.7.2]$ jps</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">13739 DataNode</span><br><span class="line">13774 Jps</span><br></pre></td></tr></table></figure><p><font style="color:red">思考</font>：每次都一个一个节点启动，如果节点数增加到1000个怎么办？</p><p>早上来了开始一个一个节点启动，到晚上下班刚好完成，下班？</p><h4 id="SSH免密登录"><a href="#SSH免密登录" class="headerlink" title="SSH免密登录"></a>SSH免密登录</h4><p>原理：</p><p><a class="link"   href="https://www.cnblogs.com/haojun/p/11131432.html" >https://www.cnblogs.com/haojun/p/11131432.html<i class="fas fa-external-link-alt"></i></a></p><p> 工作原理如下图所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master//ssh_nopassword.png"                      alt="ssh免密登录"                ></p><p>生成公钥和私钥：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>然后敲（三个回车），就会生成两个文件<code>id_rsa</code>（私钥）、<code>id_rsa.pub</code>（公钥）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ cd ~/.ssh/</span><br><span class="line">[hisign@hadoop91 .ssh]$ ll</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">总用量 12</span><br><span class="line">-rw-------. 1 hisign hisign 1675 11月  9 09:58 id_rsa</span><br><span class="line">-rw-r--r--. 1 hisign hisign  397 11月  9 09:58 id_rsa.pub</span><br><span class="line">-rw-r--r--. 1 hisign hisign  372 11月  9 09:15 known_hosts</span><br></pre></td></tr></table></figure><p>将公钥拷贝到要免密登录的目标机器上</p><p><code>ssh-copy-id</code>可以把本地主机的公钥复制到远程主机的<code>authorized_keys</code>文件上，<code>ssh-copy-id</code>命令也会给远程主机的用户主目录（<code>home</code>）和<code>~/.ssh</code>, 和<code>~/.ssh/authorized_keys</code>设置合适的权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 给用户hisign配置免密登录</span></span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop91</span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop92</span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop93</span><br></pre></td></tr></table></figure><p><font style="color:red">注意</font>：在<strong>hadoop92</strong>和<strong>hadoop93</strong>上把上面的操作都再执行一遍，三台服务器就能互相之间进行免密登录了。如果想要其他用户也能进行免密登录，切换到其他用户执行上操作即可。</p><h4 id="群起集群"><a href="#群起集群" class="headerlink" title="群起集群"></a>群起集群</h4><h5 id="配置slaves"><a href="#配置slaves" class="headerlink" title="配置slaves"></a>配置slaves</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ cd /opt/module/hadoop-2.7.2/etc/hadoop</span><br><span class="line">[hisign@hadoop91 hadoop]$ vim slaves</span><br></pre></td></tr></table></figure><p>在该文件中增加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop91</span><br><span class="line">hadoop92</span><br><span class="line">hadoop93</span><br></pre></td></tr></table></figure><p><font style="color:red">注意</font>：该文件中添加的内容结尾不允许有空格，文件中不允许有空行。</p><p>同步所有节点配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync slaves</span><br></pre></td></tr></table></figure><h5 id="启动集群-2"><a href="#启动集群-2" class="headerlink" title="启动集群"></a>启动集群</h5><p>1、如果集群是第一次启动，需要格式化<code>NameNode</code>（注意格式化之前，一定要先停止上次启动的所有<code>namenode</code>和<code>datanode</code>进程，然后再删除<code>data</code>和<code>log</code>数据）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ bin/hdfs namenode -format</span><br></pre></td></tr></table></figure><p>2、启动HDFS</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ sbin/start-dfs.sh</span><br><span class="line"></span><br><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ jps</span><br><span class="line">18627 DataNode</span><br><span class="line">18836 Jps</span><br><span class="line">18495 NameNode</span><br><span class="line">[hisign@hadoop92 hadoop-2.7.2]$ jps</span><br><span class="line">15957 Jps</span><br><span class="line">15883 DataNode</span><br><span class="line">[hisign@hadoop93 hadoop-2.7.2]$ jps</span><br><span class="line">15891 SecondaryNameNode</span><br><span class="line">15787 DataNode</span><br><span class="line">15932 Jps</span><br></pre></td></tr></table></figure><p>3、启动YARN</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop92 hadoop-2.7.2]$ sbin/start-yarn.sh</span><br><span class="line">16004 ResourceManager</span><br><span class="line">16106 NodeManager</span><br><span class="line">15883 DataNode</span><br><span class="line">16205 Jps</span><br></pre></td></tr></table></figure><p><font style="color:red">注意</font>：<code>NameNode</code>和<code>ResourceManger</code>如果不是同一台机器，不能在<code>NameNode</code>上启动 <code>YARN</code>，应该在<code>ResouceManager</code>所在的机器上启动<code>YARN</code>。</p><p>4、Web端查看SecondaryNameNode</p><p><a class="link"   href="http://hadoop93:50090/status.html" >http://hadoop93:50090/status.html<i class="fas fa-external-link-alt"></i></a></p><h5 id="查看集群-1"><a href="#查看集群-1" class="headerlink" title="查看集群"></a>查看集群</h5><p><code>jps</code>能查看当前节点的java进程，但是节点多了，得切换到别的节点去查看，所以写个<code>shell</code>脚本查看所有节点的java进程</p><ul><li>说明：在<code>/home/hisign/bin</code>这个目录下存放的脚本，hisign用户可以在系统任何地方直接执行。</li></ul><p>在<code>/home/hisign</code>目录下创建<code>bin</code>目录，并在bin目录下<strong>jpsall</strong>创建文件，文件内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  /home/hisign/bin</span><br><span class="line">cd /home/hisign/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建脚本</span></span><br><span class="line">vim jpsall</span><br></pre></td></tr></table></figure><p>在该文件中编写如下代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 循环</span></span><br><span class="line"><span class="keyword">for</span>((host=91; host&lt;94; host++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> ------------------- hadoop<span class="variable">$host</span> --------------</span><br><span class="line">    ssh hadoop<span class="variable">$host</span> <span class="string">&quot;jps&quot;</span> | grep -v Jps</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>修改脚本 jpsall 具有执行权限</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x jpsall</span><br></pre></td></tr></table></figure><ul><li>调用脚本形式：jpsall 文件名称</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jpsall</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：如果将xsync放到<code>/home/hisign/bin</code>目录下仍然不能实现全局使用，可以将jpsall移动到<code>/usr/local/bin</code>目录下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /home/hisign/bin/jpsall /usr/local/bin</span><br></pre></td></tr></table></figure><h5 id="集群基本测试"><a href="#集群基本测试" class="headerlink" title="集群基本测试"></a>集群基本测试</h5><p>1、上传文件到集群</p><ul><li>上传小文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 hdoop-2.7.2]$ hdfs dfs -mkdir -p /user/hisign/input</span><br><span class="line">[hisign@hadoop91 hdoop-2.7.2]$ hdfs dfs -put wcinput/wc.input /user/hisign/input</span><br></pre></td></tr></table></figure><ul><li>上传大文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hadoop fs -put /opt/software/hadoop-2.7.2.tar.gz /user/hisign/input</span><br></pre></td></tr></table></figure><p>2、上传文件后查看文件存放在什么位置</p><blockquote><p>/opt/module/hadoop-2.7.2/data/tmp/dfs/data/current/BP-917863227-192.168.40.91-1604892333948/current/finalized/subdir0/subdir0/</p></blockquote><p>3、查看HDFS在磁盘存储文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 subdir0]$ ll</span><br><span class="line">总用量 194552</span><br><span class="line">-rw-rw-r--. 1 hisign hisign        45 11月  9 12:25 blk_1073741825</span><br><span class="line">-rw-rw-r--. 1 hisign hisign        11 11月  9 12:25 blk_1073741825_1001.meta</span><br><span class="line">-rw-rw-r--. 1 hisign hisign 134217728 11月  9 12:29 blk_1073741826</span><br><span class="line">-rw-rw-r--. 1 hisign hisign   948583 11月  9 12:29 blk_1073741826_1002.meta</span><br><span class="line">-rw-rw-r--. 1 hisign hisign  63439959 11月  9 12:29 blk_1073741827</span><br><span class="line">-rw-rw-r--. 1 hisign hisign    495635 11月  9 12:29 blk_1073741827_1003.meta</span><br><span class="line"></span><br><span class="line">[hisign@hadoop91 subdir0]$ cat blk_1073741825</span><br><span class="line">hadoop yarn</span><br><span class="line">hadoop mapreduce</span><br><span class="line">atguigu</span><br><span class="line">atguigu</span><br></pre></td></tr></table></figure><p>4、拼接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 subdir0]$ cat blk_1073741825 &gt;&gt; tmp.file</span><br><span class="line">[hisign@hadoop91 subdir0]$ cat blk_1073741827 &gt;&gt; tmp.file</span><br></pre></td></tr></table></figure><p>5、下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 subdir0]$ cd -</span><br><span class="line">[hisign@hadoop91 hadoop-2.7.2]$ pwd</span><br><span class="line">/opt/module/hadoop-2.7.2</span><br><span class="line"></span><br><span class="line">bin/hadoop fs -get /user/hisign/input/hadoop-2.7.2.tar.gz ./</span><br></pre></td></tr></table></figure><h4 id="集群启动-停止"><a href="#集群启动-停止" class="headerlink" title="集群启动/停止"></a>集群启动/停止</h4><ul><li>各个服务组件逐一启动/停止</li></ul><p>​    （1）分别启动/停止HDFS组件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop-daemon.sh start / stop namenode / datanode / secondarynamenode</span><br></pre></td></tr></table></figure><p>​    （2）启动/停止YARN</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn-daemon.sh start / stop resourcemanager / nodemanager</span><br></pre></td></tr></table></figure><ul><li> 各个模块分开启动/停止（配置ssh是前提）常用</li></ul><p>​    （1）整体启动/停止HDFS</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh  / stop-dfs.sh</span><br></pre></td></tr></table></figure><p>​    （2）整体启动/停止YARN</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-yarn.sh / stop-yarn.sh</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>sbin/start-all.sh 启动所有的Hadoop守护进程。包括NameNode、 Secondary NameNode、DataNode、ResourceManager、NodeManager</p></li><li><p>sbin/stop-all.sh 停止所有的Hadoop守护进程。包括NameNode、 Secondary NameNode、DataNode、ResourceManager、NodeManager</p></li><li><p>sbin/start-dfs.sh 启动Hadoop HDFS守护进程NameNode、SecondaryNameNode、DataNode</p></li><li><p>sbin/stop-dfs.sh 停止Hadoop HDFS守护进程NameNode、SecondaryNameNode和DataNode</p></li><li><p>sbin/hadoop-daemons.sh start namenode 单独启动NameNode守护进程</p></li><li><p>sbin/hadoop-daemons.sh stop namenode 单独停止NameNode守护进程</p></li><li><p>sbin/hadoop-daemons.sh start datanode 单独启动DataNode守护进程</p></li><li><p>sbin/hadoop-daemons.sh stop datanode 单独停止DataNode守护进程</p></li><li><p>sbin/hadoop-daemons.sh start secondarynamenode 单独启动SecondaryNameNode守护进程</p></li><li><p>sbin/hadoop-daemons.sh stop secondarynamenode 单独停止SecondaryNameNode守护进程</p></li><li><p>sbin/start-yarn.sh 启动ResourceManager、NodeManager</p></li><li><p>sbin/stop-yarn.sh 停止ResourceManager、NodeManager</p></li><li><p>sbin/yarn-daemon.sh start resourcemanager 单独启动ResourceManager</p></li><li><p>sbin/yarn-daemons.sh start nodemanager 单独启动NodeManager</p></li><li><p>sbin/yarn-daemon.sh stop resourcemanager 单独停止ResourceManager</p></li><li><p>sbin/yarn-daemons.sh stopnodemanager 单独停止NodeManager</p></li><li><p>sbin/mr-jobhistory-daemon.sh start historyserver 手动启动jobhistory</p></li><li><p>sbin/mr-jobhistory-daemon.sh stop historyserver 手动停止jobhistory</p></li></ul></blockquote><h4 id="集群时间同步"><a href="#集群时间同步" class="headerlink" title="集群时间同步"></a>集群时间同步</h4><p>时间同步的方式：找一个机器，作为时间服务器，所有的机器与这台集群时间进行定时的同步，比如，每隔十分钟，同步一次时间。</p><h5 id="时间服务器配置"><a href="#时间服务器配置" class="headerlink" title="时间服务器配置"></a>时间服务器配置</h5><p><font style="color:red">必须root用户</font></p><p>1、检查ntp是否安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]# rpm -qa|grep ntp</span><br><span class="line">ntp-4.2.6p5-29.el7.centos.2.x86_64</span><br><span class="line">ntpdate-4.2.6p5-29.el7.centos.2.x86_64</span><br></pre></td></tr></table></figure><p>如果没有安装，先安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ntp -y</span><br></pre></td></tr></table></figure><p>2、修改ntp配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]# vi /etc/ntp.conf</span><br></pre></td></tr></table></figure><ul><li>修改1，授权192.168.40.0-192.168.40.255网段上的所有机器可以从这台机器上查询和同步时间</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span></span><br><span class="line"></span><br><span class="line">restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span><br></pre></td></tr></table></figure><ul><li>修改2，集群在局域网中，不使用其他互联网上的时间</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst为</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server 3.centos.pool.ntp.org iburst</span></span><br></pre></td></tr></table></figure><ul><li>增加如下内容，当该节点丢失网络连接，依然可以采用本地时间作为时间服务器为集群中的其他节点提供时间同步</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server 127.127.1.0</span><br><span class="line">fudge 127.127.1.0 stratum 10</span><br></pre></td></tr></table></figure><p>3、修改/etc/sysconfig/ntpd 文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]# vim /etc/sysconfig/ntpd</span><br></pre></td></tr></table></figure><p>增加内容如下（让硬件时间与系统时间一起同步）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYNC_HWCLOCK=yes</span><br></pre></td></tr></table></figure><p>4、重新启动ntpd服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看服务状态</span></span><br><span class="line">[root@hadoop91 ~]# service ntpd status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动服务</span></span><br><span class="line">[root@hadoop91 ~]# service ntpd start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止服务</span></span><br><span class="line">[root@hadoop91 ~]# service ntpd stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">[root@hadoop91 ~]# service ntpd restart</span><br></pre></td></tr></table></figure><p>5、设置ntpd服务开机自启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]# chkconfig ntpd on</span><br></pre></td></tr></table></figure><h5 id="其他机器配置"><a href="#其他机器配置" class="headerlink" title="其他机器配置"></a>其他机器配置</h5><p><font style="color:red">必须root用户</font></p><p>1、在其他机器配置10分钟与时间服务器同步一次</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]#  crontab -e</span><br></pre></td></tr></table></figure><p>编写定时任务如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/10 * * * * /usr/sbin/ntpdate hadoop91</span><br></pre></td></tr></table></figure><p>2、修改任意机器时间</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]#  date -s &quot;2017-9-11 11:11:11&quot;</span><br></pre></td></tr></table></figure><p>3、十分钟后查看机器是否与时间服务器同步</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop91 ~]#  date</span><br></pre></td></tr></table></figure><p>说明：测试的时候可以将10分钟调整为1分钟，节省时间。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/1 * * * * /usr/sbin/ntpdate hadoop91</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h2&gt;&lt;h3 id=&quot;配置静态ip&quot;&gt;&lt;a href=&quot;#配置静态ip&quot; class=&quot;headerlink&quot; title=&quot;配置静态i</summary>
      
    
    
    
    <category term="大数据" scheme="https://valtenhyl.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
    <category term="hadoop" scheme="https://valtenhyl.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/"/>
    
    
    <category term="hadoop" scheme="https://valtenhyl.github.io/tags/hadoop/"/>
    
    <category term="大数据" scheme="https://valtenhyl.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
  </entry>
  
  <entry>
    <title>Linux 开发环境搭建</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/Linux%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/Linux%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</id>
    <published>2020-11-05T08:34:21.000Z</published>
    <updated>2021-10-29T06:58:14.282Z</updated>
    
    <content type="html"><![CDATA[<h3 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h3><h4 id="查询系统自带的jdk"><a href="#查询系统自带的jdk" class="headerlink" title="查询系统自带的jdk"></a>查询系统自带的jdk</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询系统自带的jdk</span> </span><br><span class="line">rpm -qa | grep jdk</span><br></pre></td></tr></table></figure><p>显示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java-1.7.0-openjdk-1.7.0.111-2.6.7.8.el7.x86_64             </span><br><span class="line">java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64               </span><br><span class="line">java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64      </span><br><span class="line">java-1.7.0-openjdk-headless-1.7.0.111-2.6.7.8.el7.x86_64    </span><br><span class="line">copy-jdk-configs-3.3-10.el7_5.noarch</span><br></pre></td></tr></table></figure><h4 id="卸载系统自带jdk"><a href="#卸载系统自带jdk" class="headerlink" title="卸载系统自带jdk"></a>卸载系统自带jdk</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载指定jdk</span></span><br><span class="line">rpm -e --nodeps java-1.7.0-openjdk-1.7.0.111-2.6.7.8.el7.x86_64</span><br><span class="line">rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.111-2.6.7.8.el7.x86_64</span><br><span class="line">rpm -e --nodeps java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64</span><br><span class="line">rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.102-4.b14.el7.x86_64</span><br></pre></td></tr></table></figure><p>或者使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载全部</span></span><br><span class="line">rpm -qa | grep jdk | xargs rpm -e --nodeps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">yum remove *openjdk*</span><br></pre></td></tr></table></figure><p>之后再次输入<code>rpm -qa | grep java</code> 查看卸载情况：</p><h4 id="安装新的jdk"><a href="#安装新的jdk" class="headerlink" title="安装新的jdk"></a>安装新的jdk</h4><p>首先到官网上下载你想要的jdk，下载完成之后将安装包放到Linux系统指定的文件夹<code>/opt/software</code>下</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入jdk存放目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt/software</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压到指定目录</span></span><br><span class="line">tar <span class="literal">-zxvf</span> jdk<span class="literal">-8u131</span><span class="literal">-linux</span><span class="literal">-x64</span>.tar.gz <span class="literal">-C</span> /usr/local</span><br></pre></td></tr></table></figure><h4 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>输入大写的  <code>G</code>  跳转到文件末尾，在最后面添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_131</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br></pre></td></tr></table></figure><p>执行profile文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>这样可以使配置不用重启即可立即生效。</p><p>检查新安装的jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p>显示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_131&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure><p><strong>到此为止，整个安装过程结束。</strong></p><hr><h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><p><a class="link"   href="https://github.com/alibaba/nacos/releases" >https://github.com/alibaba/nacos/releases <i class="fas fa-external-link-alt"></i></a></p><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到/usr/<span class="built_in">local</span>目录下</span></span><br><span class="line">tar -zxvf nacos-server-1.3.1.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><p>创建服务</p><p>在 <code>/lib/systemd/system</code> 目录下创建 <code>nacos.service</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /lib/systemd/system</span><br></pre></td></tr></table></figure><p>创建文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nacos.service</span><br></pre></td></tr></table></figure><p>输入a编辑，输入以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nacos</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/nacos/bin/startup.sh -m standalone</span><br><span class="line">ExecReload=/usr/<span class="built_in">local</span>/nacos/bin/shutdown.sh</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/nacos/bin/shutdown.sh</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>按 <code>esc</code> 退出编辑，输入<code>:wq</code>保存并且退出</p><p>进入<code>nacos</code>的<code>bin</code>目录下，修改启动文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nacos/bin</span><br></pre></td></tr></table></figure><p>修改文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi startup.sh</span><br></pre></td></tr></table></figure><p>按<code>a</code>进入编辑模式，修改<code>jdk</code>路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[ ! -e <span class="string">&quot;<span class="variable">$JAVA_HOME</span>/bin/java&quot;</span> ] &amp;&amp; JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_144</span><br><span class="line"><span class="comment">#[ ! -e &quot;$JAVA_HOME/bin/java&quot; ] &amp;&amp; JAVA_HOME=$HOME/jdk/java</span></span><br><span class="line"><span class="comment">#[ ! -e &quot;$JAVA_HOME/bin/java&quot; ] &amp;&amp; JAVA_HOME=/usr/java</span></span><br><span class="line"><span class="comment">#[ ! -e &quot;$JAVA_HOME/bin/java&quot; ] &amp;&amp; JAVA_HOME=/opt/taobao/java</span></span><br><span class="line"><span class="comment">#[ ! -e &quot;$JAVA_HOME/bin/java&quot; ] &amp;&amp; unset JAVA_HOME</span></span><br></pre></td></tr></table></figure><p>其他的配置的四条配置前加 <code>#</code> 注释，按<code>esc</code>退出编辑，<code>:wq</code> 保存并退出</p><p>设置开机启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> nacos.service</span><br><span class="line">systemctl start nacos.service</span><br></pre></td></tr></table></figure><h4 id="启动nacos"><a href="#启动nacos" class="headerlink" title="启动nacos"></a>启动nacos</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup sh /usr/local/nacos/bin/startup.sh -m standalone &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><hr><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="准备-1"><a href="#准备-1" class="headerlink" title="准备"></a>准备</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.8.tar.gz</span><br></pre></td></tr></table></figure><p><strong>历史版本下载</strong></p><p><a class="link"   href="http://download.redis.io/releases/" >http://download.redis.io/releases/<i class="fas fa-external-link-alt"></i></a></p><p>安装redis需要<code>gcc</code>编译环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装gcc</span></span><br><span class="line">yum install gcc -y</span><br></pre></td></tr></table></figure><h4 id="解压-1"><a href="#解压-1" class="headerlink" title="解压"></a>解压</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到/tmp目录下</span></span><br><span class="line">tar -zxvf redis-4.0.8.tar.gz -C /tmp</span><br></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入redis源码目录</span></span><br><span class="line">cd /tmp/redis-4.0.8</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译</span></span><br><span class="line">make</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果make报错，添加参数MALLOC=libc执行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory，</span></span><br><span class="line">make MALLOC=libc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">cd src</span><br><span class="line">make install PREFIX=/usr/local/redis</span><br></pre></td></tr></table></figure><p>移动配置文件到安装目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建配置文件目录</span></span><br><span class="line">mkdir -p /usr/local/redis/etc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将配置文件移到对应目录</span></span><br><span class="line">mv ../redis.conf /usr/local/redis/etc</span><br></pre></td></tr></table></figure><h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/redis/etc/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置redis后台启动：将daemonize no 改成 daemonize yes</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置远程访问：将protected-mode yes 改为 no</span></span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><h4 id="设置开机启动-1"><a href="#设置开机启动-1" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/rc.local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在里面添加内容(意思就是开机调用这段开启redis的命令)</span></span><br><span class="line">/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</span><br></pre></td></tr></table></figure><p>要想保证开机自启，得确认rc.local是可执行文件，如果不是，添加执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加执行权限</span></span><br><span class="line">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><h4 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</span><br></pre></td></tr></table></figure><p><strong>常用命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动redis</span></span><br><span class="line">redis-server /usr/local/redis/etc/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止redis</span></span><br><span class="line">pkill redis</span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载redis</span></span><br><span class="line">rm -rf /usr/local/redis  # 删除安装目录</span><br><span class="line">rm -rf /usr/bin/redis-*  # 删除所有redis相关命令脚本</span><br><span class="line">rm -rf /tmp/redis-4.0.8 # 删除redis解压文件夹</span><br></pre></td></tr></table></figure><hr><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><h4 id="准备-2"><a href="#准备-2" class="headerlink" title="准备"></a>准备</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.9.0.tar.gz</span><br></pre></td></tr></table></figure><p><strong>历史版本下载</strong></p><p><a class="link"   href="https://nginx.org/download/" >https://nginx.org/download/<i class="fas fa-external-link-alt"></i></a></p><h4 id="解压-2"><a href="#解压-2" class="headerlink" title="解压"></a>解压</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到/tmp目录下</span></span><br><span class="line">tar -zxvf nginx-1.9.0.tar.gz -C /tmp</span><br></pre></td></tr></table></figure><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>安装依赖插件，默认需要 <strong>zlib</strong>、<strong>openssl</strong> 和 <strong>pcre</strong> 依赖包，其他组件可以根据自己需要选择安装。输入如下命令： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ zlib zlib-devel openssl openssl-devel pcre pcre-devel</span><br></pre></td></tr></table></figure><blockquote><p>gcc：编译器组件，包括C、C++等<br>zlib：数据压缩库<br>openssl：https安全传输协议，默认没有打开<br>pcre：正则表达式库</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入nginx目录</span></span><br><span class="line">cd /tmp/nginx-1.9.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置，默认安装到/usr/<span class="built_in">local</span>/nginx目录，如果要自定义目录 ./configure --prefix=/usr/<span class="built_in">local</span>/nginx</span></span><br><span class="line">./configure  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="设置开机启动-2"><a href="#设置开机启动-2" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在里面添加内容(意思就是开机调用这段开启nginx的命令)</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>要想保证开机自启，得确认rc.local是可执行文件，如果不是，添加执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加执行权限</span></span><br><span class="line">chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure><h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p><strong>常用命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./nginx # 启动</span><br><span class="line">./nginx -s stop # 关闭</span><br><span class="line">./nginx -s reload # 重启</span><br></pre></td></tr></table></figure><hr><h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><h4 id="准备-3"><a href="#准备-3" class="headerlink" title="准备"></a>准备</h4><p><a class="link"   href="http://archive.apache.org/dist/zookeeper/" >http://archive.apache.org/dist/zookeeper/<i class="fas fa-external-link-alt"></i></a></p><h4 id="解压-3"><a href="#解压-3" class="headerlink" title="解压"></a>解压</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定目录</span></span><br><span class="line">tar -zxvf zookeeper-3.4.10.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>新建配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入zookeeper配置文件目录</span></span><br><span class="line">cd /usr/local/zookeeper-3.4.10/conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将zoo_sample.cfg这个文件复制为zoo.cfg (必须是这个文件名)</span></span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim zoo.cfg</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定数据和日志目录</span></span><br><span class="line">dataDir=/usr/local/zookeeper-3.4.10/data</span><br><span class="line">dataLogDir=//usr/local/zookeeper-3.4.10/logs</span><br><span class="line"></span><br><span class="line">cd ../</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建目录存放数据和日志</span></span><br><span class="line">mkdir /usr/local/zookeeper-3.4.10/data</span><br><span class="line">mkdir /usr/local/zookeeper-3.4.10/logs</span><br></pre></td></tr></table></figure><h4 id="设置环境变量-1"><a href="#设置环境变量-1" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>输入大写的  <code>G</code>  跳转到文件末尾，在最后面添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ZOOKEEPER_HOME=/usr/local/zookeeper-3.4.10</span><br><span class="line">export PATH=$ZOOKEEPER_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><p>执行profile文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>这样可以使配置不用重启即可立即生效。</p><h4 id="启动zookeeper"><a href="#启动zookeeper" class="headerlink" title="启动zookeeper"></a>启动zookeeper</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/zookeeper-3.4.10/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">./zkServer.sh start</span><br></pre></td></tr></table></figure><p><strong>常用命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh status # 查看状态</span><br><span class="line">./zkServer.sh stop # 停止</span><br><span class="line">./zkCli.sh # 启动客户端</span><br></pre></td></tr></table></figure><hr><h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><h4 id="准备-4"><a href="#准备-4" class="headerlink" title="准备"></a>准备</h4><p><a class="link"   href="http://archive.apache.org/dist/kafka/" >http://archive.apache.org/dist/kafka/<i class="fas fa-external-link-alt"></i></a></p><h4 id="解压-4"><a href="#解压-4" class="headerlink" title="解压"></a>解压</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定目录</span></span><br><span class="line">tar -zxvf kafka_2.12-2.0.0.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入配置文件目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 server.properties</span></span><br><span class="line">vim server.properties</span><br><span class="line">==============================================================================</span><br><span class="line">broker.id=0 </span><br><span class="line">port=9092 <span class="comment">#端口号 </span></span><br><span class="line">host.name=localhost <span class="comment">#单机可直接用localhost</span></span><br><span class="line">log.dirs=/data/kafka/<span class="built_in">log</span> <span class="comment">#日志存放路径可修改可不修改</span></span><br><span class="line">zookeeper.connect=localhost:2181 <span class="comment">#zookeeper地址和端口，单机配置部署，localhost:2181</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 zookeeper.properties</span></span><br><span class="line">vim zookeeper.properties</span><br><span class="line">==============================================================================</span><br><span class="line"><span class="comment">#zookeeper数据目录  (可以修改可以不修改)</span></span><br><span class="line">dataDir=/data/kafka/zookeeper/data</span><br><span class="line"><span class="comment">#zookeeper日志目录 （可以修改可以不修改）</span></span><br><span class="line">dataLogDir=/data/kafka/zookeeper/<span class="built_in">log</span></span><br><span class="line">clientPort=2181 </span><br><span class="line">maxClientCnxns=100 </span><br><span class="line">tickTime=2000</span><br></pre></td></tr></table></figure><p>创建目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/kafka/<span class="built_in">log</span></span><br><span class="line">mkdir -p /data/kafka/zookeeper/data</span><br><span class="line">mkdir -p /data/kafka/zookeeper/<span class="built_in">log</span></span><br></pre></td></tr></table></figure><h4 id="新建执行脚本"><a href="#新建执行脚本" class="headerlink" title="新建执行脚本"></a>新建执行脚本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动脚本</span></span><br><span class="line"><span class="comment"># 进入kafka目录下 输入命令：vi  kafkaStart.sh</span></span><br><span class="line">====================================================================</span><br><span class="line">添加内容为：</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#启动zookeeper</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/bin/zookeeper-server-start.sh /usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/config/zookeeper.properties &amp;</span><br><span class="line">sleep 3  <span class="comment">#默默等3秒后执行 </span></span><br><span class="line"><span class="comment">#启动kafka</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/bin/kafka-server-start.sh /usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/config/server.properties &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止脚本</span></span><br><span class="line"><span class="comment"># 进入kafka目录下 输入命令：vi  kafkaStop.sh</span></span><br><span class="line">====================================================================</span><br><span class="line">添加内容为：</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#停止kafka</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/bin/kafka-server-stop.sh /usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/config/server.properties &amp;</span><br><span class="line">sleep 3  <span class="comment">#默默等3秒后执行 </span></span><br><span class="line"><span class="comment">#停止zookeeper</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/bin/zookeeper-server-stop.sh /usr/<span class="built_in">local</span>/kafka_2.12-2.0.0/config/zookeeper.properties &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加脚本执行权限</span></span><br><span class="line">chmod +x kafkaStart.sh</span><br><span class="line">chmod +x kafkaStop.sh</span><br></pre></td></tr></table></figure><h4 id="设置开机启动-3"><a href="#设置开机启动-3" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在里面添加内容(意思就是开机调用这段开启kafka的命令)</span></span><br><span class="line">sh /usr/local/kafka/kafkaStart.sh &amp;</span><br></pre></td></tr></table></figure><p>要想保证开机自启，得确认rc.local是可执行文件，如果不是，添加执行权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加执行权限</span></span><br><span class="line">chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure><h4 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh /usr/local/kafka/kafkaStart.sh &amp;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;JDK&quot;&gt;&lt;a href=&quot;#JDK&quot; class=&quot;headerlink&quot; title=&quot;JDK&quot;&gt;&lt;/a&gt;JDK&lt;/h3&gt;&lt;h4 id=&quot;查询系统自带的jdk&quot;&gt;&lt;a href=&quot;#查询系统自带的jdk&quot; class=&quot;headerlink&quot; title=&quot;查</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Linux" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/"/>
    
    
    <category term="Linux" scheme="https://valtenhyl.github.io/tags/Linux/"/>
    
    <category term="JDK" scheme="https://valtenhyl.github.io/tags/JDK/"/>
    
    <category term="Nacos" scheme="https://valtenhyl.github.io/tags/Nacos/"/>
    
    <category term="Redis" scheme="https://valtenhyl.github.io/tags/Redis/"/>
    
    <category term="Nginx" scheme="https://valtenhyl.github.io/tags/Nginx/"/>
    
    <category term="Zookeeper" scheme="https://valtenhyl.github.io/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>Linux 基础环境搭建</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/Linux%20%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/Linux%20%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</id>
    <published>2020-11-05T03:18:06.000Z</published>
    <updated>2021-10-29T06:58:14.282Z</updated>
    
    <content type="html"><![CDATA[<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>以<font style="color: red;font-size: 18px">CentOS7</font>为例，下载地址</p><p><a class="link"   href="http://mirrors.aliyun.com/centos/7/isos/x86_64/" >http://mirrors.aliyun.com/centos/7/isos/x86_64/<i class="fas fa-external-link-alt"></i></a></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>不赘述，网络设置桥接模式</p><h4 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens32</span><br></pre></td></tr></table></figure><p>ifcfg-ens32</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 网络类型为以太网</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line"><span class="comment"># 设置固定ip，dhcp 改为 static</span></span><br><span class="line"><span class="comment"># BOOTPROTU=dhcp</span></span><br><span class="line">BOOTPROTU=static</span><br><span class="line"><span class="comment"># 网卡设备名，一定要跟文件名一致</span></span><br><span class="line">DEVICE=ens32</span><br><span class="line"><span class="comment"># 网卡设备名，一定要跟文件名一致</span></span><br><span class="line">NAME=ens32</span><br><span class="line"><span class="comment"># 设定网卡随网络服务启动</span></span><br><span class="line"><span class="comment"># ONBOOT=no</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># 固定ip</span></span><br><span class="line">IPADDR=192.168.40.26</span><br><span class="line"><span class="comment"># 网关</span></span><br><span class="line">GATEWAY=192.168.40.254</span><br><span class="line"><span class="comment"># 子网掩码</span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="comment"># DNS地址</span></span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line">DNS2=114.114.114.114</span><br></pre></td></tr></table></figure><p>重启网络服务，使生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重启网络服务</span></span><br><span class="line">service network restart</span><br></pre></td></tr></table></figure><h4 id="配置国内yum源"><a href="#配置国内yum源" class="headerlink" title="配置国内yum源"></a>配置国内yum源</h4><p>查看所有的yum源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all</span><br></pre></td></tr></table></figure><p>查看可用的yum源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist enabled</span><br></pre></td></tr></table></figure><p>阿里镜像仓库配置</p><p>根据官网的说明，我们详细说说每步骤的意思。</p><p>（1）备份，将 <code>CentOS-Base.repo</code> 为<code>CentOS-Base.repo.bak</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure><p>（2）下载新的 <code>http://mirrors.aliyun.com/repo/Centos-7.repo</code>，并命名为<code>CentOS-Base.repo</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>（3）清除缓存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all     # 清除系统所有的yum缓存</span><br><span class="line">yum makecache     # 生成yum缓存</span><br></pre></td></tr></table></figure><h4 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h4><p>firewalld跟iptables比起来至少有两大好处：</p><ol><li>firewalld可以动态修改单条规则，而不需要像iptables那样，在修改了规则后必须得全部刷新才可以生效；</li><li>firewalld在使用上要比iptables人性化很多，即使不明白“五张表五条链”而且对TCP/IP协议也不理解也可以实现大部分功能。</li></ol><p>firewalld跟iptables比起来，不好的地方是每个服务都需要去设置才能放行，因为默认是拒绝。而iptables里默认是每个服务是允许，需要拒绝的才去限制。</p><p><code>centos7</code>开始默认用的是<code>firewalld</code>，这个是基于<code>iptables</code>的，虽然有<code>iptables</code>的核心，但是<code>iptables</code>的服务是没安装的。</p><h5 id="firewalld"><a href="#firewalld" class="headerlink" title="firewalld"></a>firewalld</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装防火墙</span></span><br><span class="line">yum install firewalld firewall-config</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启防火墙</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将接口添加到区域 --zone=public，默认接口都在public</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --permanent 永久加入，没有这个参数重启后失效</span></span><br><span class="line">firewall-cmd --zone=public --add-interface=eth0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将端口添加到区域 --zone=public，默认接口都在public</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --permanent 永久加入，没有这个参数重启后失效</span></span><br><span class="line">firewall-cmd --add-port=8080/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 刷新防火墙设置</span> </span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙中已放开的端口</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看80端口是否开启</span></span><br><span class="line">firewall-cmd --query-port=80/tcp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙是否开机自启</span></span><br><span class="line">systemctl is-enabled firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用防火墙，开机自启关闭</span></span><br><span class="line">systemctl disable firewalld</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用防火墙，开机自启</span></span><br><span class="line">systemctl enable firewalld</span><br></pre></td></tr></table></figure><h5 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙</span></span><br><span class="line">service iptables stop</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用防火墙，开机自启关闭</span></span><br><span class="line">chkconfig iptables off</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙状态</span></span><br><span class="line">service iptables status</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看开机自启列表</span></span><br><span class="line">chkconfig --list iptables</span><br></pre></td></tr></table></figure><h4 id="免密运行sudo"><a href="#免密运行sudo" class="headerlink" title="免密运行sudo"></a>免密运行<code>sudo</code></h4><p>在 <code>/etc/sudoers</code>文件中，默认打开的 <code>authenticate </code>参数用于验证目的。如果设置了它，用户必须通过密码（或其他身份验证方法）进行身份验证，然后才能使用 <code>sudo </code>运行命令。但是，可以使用 <code>NOPASSWD </code>（当用户调用 <code>sudo </code>命令时不需要密码）标记来覆盖此默认值。</p><p><strong>root</strong>用户<code>/etc/sudoers</code> 文件只有读的权限，需要给<strong>root</strong>用户写的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加写权限</span></span><br><span class="line">chmod +w /etc/sudoers</span><br></pre></td></tr></table></figure><p>修改<code>/etc/sudoers</code> </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用户 haung 可以不用密码使用sudo</span></span><br><span class="line">huang    ALL=(ALL)    NOPASSWD: ALL</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于组而言，在组名前面使用 % 字符；这意味着 sys 组的所有成员都可以不用密码使用sudo</span></span><br><span class="line"><span class="meta">%</span><span class="bash">sys    ALL=(ALL)    NOPASSWD: ALL</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sys 组的所有成员都可以不用密码使用sudo运行命令 /bin/<span class="built_in">kill</span></span></span><br><span class="line"><span class="meta">%</span><span class="bash">sys    ALL=(ALL)    NOPASSWD: /bin/<span class="built_in">kill</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sys 组的所有成员都可以不用密码使用sudo运行命令 /bin/<span class="built_in">kill</span>、/bin/rm</span></span><br><span class="line"><span class="meta">%</span><span class="bash">sys    ALL=(ALL)    NOPASSWD: /bin/<span class="built_in">kill</span>,/bin/rm</span></span><br></pre></td></tr></table></figure><p> 操作完成之后记得收回<strong>root</strong>的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 收回写权限</span></span><br><span class="line">chmod -w /etc/sudoers</span><br></pre></td></tr></table></figure><p><font style="color: red">当然，也不用添加权限、收回权限这么麻烦，可以在<strong>root</strong>用户修改完后强制保存</font></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ESC后，:wq! 强制保存</span></span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure><h4 id="SSH免密登录"><a href="#SSH免密登录" class="headerlink" title="SSH免密登录"></a>SSH免密登录</h4><p>原理：</p><p><a class="link"   href="https://www.cnblogs.com/haojun/p/11131432.html" >https://www.cnblogs.com/haojun/p/11131432.html<i class="fas fa-external-link-alt"></i></a></p><p> 工作原理如下图所示：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master//ssh_nopassword.png"                      alt="ssh免密登录"                ></p><p>生成公钥和私钥：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>然后敲（三个回车），就会生成两个文件<code>id_rsa</code>（私钥）、<code>id_rsa.pub</code>（公钥）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ cd ~/.ssh/</span><br><span class="line">[hisign@hadoop91 .ssh]$ ll</span><br></pre></td></tr></table></figure><p>显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">总用量 12</span><br><span class="line">-rw-------. 1 hisign hisign 1675 11月  9 09:58 id_rsa</span><br><span class="line">-rw-r--r--. 1 hisign hisign  397 11月  9 09:58 id_rsa.pub</span><br><span class="line">-rw-r--r--. 1 hisign hisign  372 11月  9 09:15 known_hosts</span><br></pre></td></tr></table></figure><p>将公钥拷贝到要免密登录的目标机器上</p><p><code>ssh-copy-id</code>可以把本地主机的公钥复制到远程主机的<code>authorized_keys</code>文件上，<code>ssh-copy-id</code>命令也会给远程主机的用户主目录（<code>home</code>）和<code>~/.ssh</code>, 和<code>~/.ssh/authorized_keys</code>设置合适的权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 给用户hisign配置免密登录</span></span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop91</span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop92</span><br><span class="line">[hisign@hadoop91 .ssh]$ ssh-copy-id hadoop93</span><br></pre></td></tr></table></figure><p><font style="color:red">注意</font>：在<strong>hadoop92</strong>和<strong>hadoop93</strong>上把上面的操作都再执行一遍，三台服务器就能互相之间进行免密登录了。如果想要其他用户也能进行免密登录，切换到其他用户执行上操作即可。</p><h4 id="用户密码"><a href="#用户密码" class="headerlink" title="用户密码"></a>用户密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加用户huang</span></span><br><span class="line">useradd huang</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给用户huang设置密码</span></span><br><span class="line">passwd huang</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除用户huang的密码</span></span><br><span class="line">passwd -d huang</span><br></pre></td></tr></table></figure><h4 id="修改语言"><a href="#修改语言" class="headerlink" title="修改语言"></a>修改语言</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/locale.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span></span><br><span class="line">LANG=&quot;zh_CN.UTF-8&quot;</span><br></pre></td></tr></table></figure><p>重新加载配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/locale.conf</span><br></pre></td></tr></table></figure><h4 id="分发文件"><a href="#分发文件" class="headerlink" title="分发文件"></a>分发文件</h4><h5 id="scp-安全拷贝"><a href="#scp-安全拷贝" class="headerlink" title="scp 安全拷贝"></a>scp 安全拷贝</h5><ul><li>定义：</li></ul><blockquote><p>scp可以实现服务器与服务器之间的数据拷贝。（from server1 to server2）</p></blockquote><p>基本语法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">命令 递归  要拷贝的文件路径/名称  目的用户@主机:目的路径/名称</span></span><br><span class="line">scp   -r   $pdir/$fname          $user@hadoop$host:$pdir/$fname</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><p>1、在hadoop91上，将hadoop91中/opt/module目录下的软件拷贝到远程服务器hadoop92上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 /]$ scp -r /opt/module root@hadoop92:/opt/module</span><br></pre></td></tr></table></figure><p>2、在hadoop93上，将远程服务器hadoop91服务器上的/opt/module目录下的软件拷贝到本地。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop93 opt]$sudo scp -r hisign@hadoop91:/opt/module /opt/module</span><br></pre></td></tr></table></figure><p>3、在hadoop93上操作将hadoop91中/opt/module目录下的软件拷贝到hadoop104上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop93 opt]$ scp -r hisign@hadoop91:/opt/module root@hadoop104:/opt/module</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：拷贝过来的/opt/module目录，别忘了在hadoop92、hadoop93、hadoop104上修改所有文件的，所有者和所有者组。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown hisign:hisign -R /opt/module</span><br></pre></td></tr></table></figure><p>4、将hadoop91中/etc/profile文件拷贝到hadoop92的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop92:/etc/profile</span><br></pre></td></tr></table></figure><p>5、将hadoop91中/etc/profile文件拷贝到hadoop93的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop93:/etc/profile</span><br></pre></td></tr></table></figure><p>6、将hadoop91中/etc/profile文件拷贝到hadoop104的/etc/profile上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[hisign@hadoop91 ~]$ sudo scp /etc/profile root@hadoop104:/etc/profile</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：拷贝过来的配置文件别忘了 <code>source /etc/profile </code>使生效。</p><h5 id="rsync-远程同步工具"><a href="#rsync-远程同步工具" class="headerlink" title="rsync 远程同步工具"></a>rsync 远程同步工具</h5><p>rsync主要用于备份和镜像。具有速度快、避免复制相同内容和支持符号链接的优点。</p><p>rsync和scp区别：用rsync做文件的复制要比scp的速度快，rsync只对差异文件做更新。scp是把所有文件都复制过去。</p><ul><li>安装</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync -y</span><br></pre></td></tr></table></figure><ul><li>基本语法</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令 选项参数  要拷贝的文件路径/名称  目的用户@主机:目的路径/名称</span></span><br><span class="line">rsync   -av     $pdir/$fname         $user@hadoop$host:$pdir/$fname</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><p>把hadoop91机器上的/opt/software目录同步到hadoop92服务器的root用户下的/opt/目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av /opt/software/ hadoop92:/opt/software</span><br></pre></td></tr></table></figure><h5 id="xsync-集群分布脚本"><a href="#xsync-集群分布脚本" class="headerlink" title="xsync 集群分布脚本"></a>xsync 集群分布脚本</h5><p>1、需求：循环复制文件到所有节点的相同目录下</p><p>2、需求分析：</p><ul><li>rsync命令原始拷贝：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -av   /opt/module  root@hadoop93:/opt/</span><br></pre></td></tr></table></figure><ul><li>期望脚本：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync 要同步的文件名称</span><br></pre></td></tr></table></figure><ul><li>说明：在<code>/home/hisign/bin</code>这个目录下存放的脚本，hisign用户可以在系统任何地方直接执行。</li></ul><p>3、脚本实现</p><p>在<code>/home/hisign</code>目录下创建<code>bin</code>目录，并在bin目录下<strong>xsync</strong>创建文件，文件内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  /home/hisign/bin</span><br><span class="line">cd /home/hisign/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建脚本</span></span><br><span class="line">vim xsync</span><br></pre></td></tr></table></figure><p>在该文件中编写如下代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#1 获取输入参数个数，如果没有参数，直接退出</span></span><br><span class="line">pcount=<span class="variable">$#</span></span><br><span class="line"><span class="keyword">if</span> ((pcount==0)); <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> no args;</span><br><span class="line"><span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 获取文件名称</span></span><br><span class="line">p1=<span class="variable">$1</span></span><br><span class="line">fname=`basename <span class="variable">$p1</span>`</span><br><span class="line"><span class="built_in">echo</span> fname=<span class="variable">$fname</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 获取上级目录到绝对路径</span></span><br><span class="line">pdir=`<span class="built_in">cd</span> -P $(dirname <span class="variable">$p1</span>); <span class="built_in">pwd</span>`</span><br><span class="line"><span class="built_in">echo</span> pdir=<span class="variable">$pdir</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 获取当前用户名称</span></span><br><span class="line">user=`whoami`</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 循环</span></span><br><span class="line"><span class="keyword">for</span>((host=91; host&lt;94; host++)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> ------------------- hadoop<span class="variable">$host</span> --------------</span><br><span class="line">    rsync -av <span class="variable">$pdir</span>/<span class="variable">$fname</span> <span class="variable">$user</span>@hadoop<span class="variable">$host</span>:<span class="variable">$pdir</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><ul><li>修改脚本 xsync 具有执行权限</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 xsync</span><br></pre></td></tr></table></figure><ul><li>调用脚本形式：xsync 文件名称</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsync /home/hisign/bin</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：如果将xsync放到<code>/home/hisign/bin</code>目录下仍然不能实现全局使用，可以将xsync移动到<code>/usr/local/bin</code>目录下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /home/hisign/bin/xsync /usr/local/bin</span><br></pre></td></tr></table></figure><h4 id="插件推荐"><a href="#插件推荐" class="headerlink" title="插件推荐"></a>插件推荐</h4><h5 id="上传下载工具lrzsz"><a href="#上传下载工具lrzsz" class="headerlink" title="上传下载工具lrzsz"></a>上传下载工具<code>lrzsz</code></h5><p>XShell中支持，MobaXterm不支持</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 lrzsz</span></span><br><span class="line">yum install lrzsz -y</span><br></pre></td></tr></table></figure><p><font style="color: red"> 注意：该软件只是用于小文件，比较大的文件还是老老实实用ftp工具吧 </font></p><blockquote><p>lrzsz是Linux/Unix同Windows进行ZModem文件传输的命令行工具。优点就是不用再开一个sftp工具登录上去上传下载文件。<br>rz：运行该命令会弹出一个文件选择窗口，从本地选择文件上传到Linux服务器<br>sz：将选定的文件发送（send）到本地机器</p></blockquote><h5 id="网络工具包net-tools"><a href="#网络工具包net-tools" class="headerlink" title="网络工具包net-tools"></a>网络工具包<code>net-tools</code></h5><p>ifconfig不存在问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 net-tools</span></span><br><span class="line">yum install net-tools -y </span><br></pre></td></tr></table></figure><h5 id="文本编辑器vim"><a href="#文本编辑器vim" class="headerlink" title="文本编辑器vim"></a>文本编辑器<code>vim</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 net-tools</span></span><br><span class="line">yum install vim -y </span><br></pre></td></tr></table></figure><h5 id="下载工具wget"><a href="#下载工具wget" class="headerlink" title="下载工具wget"></a>下载工具<code>wget</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装 wget</span><br><span class="line">yum install wget -y </span><br></pre></td></tr></table></figure><h6 id="下载单个文件"><a href="#下载单个文件" class="headerlink" title="下载单个文件"></a>下载单个文件</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.linuxde.net/testfile.zip</span><br></pre></td></tr></table></figure><p>以下的例子是从网络下载一个文件并保存在当前目录，在下载的过程中会显示进度条，包含（下载完成百分比，已经下载的字节，当前下载速度，剩余下载时间）。</p><h6 id="下载另存为"><a href="#下载另存为" class="headerlink" title="下载另存为"></a>下载另存为</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O wordpress.zip http://www.linuxde.net/download.aspx?id=1080</span><br></pre></td></tr></table></figure><p>wget默认会以最后一个符合<code>/</code>的后面的字符来命名，对于动态链接的下载通常文件名会不正确。</p><p>错误：下面的例子会下载一个文件并以名称<code>download.aspx?id=1080</code>保存:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://www.linuxde.net/download?id=1</span><br></pre></td></tr></table></figure><p>即使下载的文件是zip格式，它仍然以<code>download.php?id=1080</code>命令。</p><p>正确：为了解决这个问题，我们可以使用参数<code>-O</code>来指定一个文件名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O wordpress.zip http://www.linuxde.net/download.aspx?id=1080</span><br></pre></td></tr></table></figure><h6 id="下载多个文件"><a href="#下载多个文件" class="headerlink" title="下载多个文件"></a>下载多个文件</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -i filelist.txt</span><br></pre></td></tr></table></figure><p>首先，保存一份下载链接文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; filelist.txt</span><br><span class="line">url1</span><br><span class="line">url2</span><br><span class="line">url3</span><br><span class="line">url4</span><br></pre></td></tr></table></figure><p>接着使用这个文件和参数<code>-i</code>下载。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h4&gt;&lt;p&gt;以&lt;font style=&quot;color: red;font-size: 18px&quot;&gt;CentOS7&lt;/font&gt;为例，下载地址&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Linux" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/"/>
    
    
    <category term="Linux" scheme="https://valtenhyl.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ELK同步Oralce数据至ES</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/ELK%E5%90%8C%E6%AD%A5Oralce%E6%95%B0%E6%8D%AE%E8%87%B3ES/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/ELK%E5%90%8C%E6%AD%A5Oralce%E6%95%B0%E6%8D%AE%E8%87%B3ES/</id>
    <published>2020-11-03T08:43:06.000Z</published>
    <updated>2021-10-29T06:58:14.280Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p> <a class="link"   href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.7.1.tar.gz" >https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.7.1.tar.gz<i class="fas fa-external-link-alt"></i></a> </p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定目录</span></span><br><span class="line">tar -zxvf elasticsearch-6.7.1.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入es安装目录</span></span><br><span class="line">cd /usr/local/elasticsearch-6.7.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑配置文件</span></span><br><span class="line">vim ./config/elasticsearch.yml</span><br></pre></td></tr></table></figure><h5 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a>elasticsearch.yml</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集群名称</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">my-application</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 节点名称</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据保存地址</span></span><br><span class="line"><span class="attr">path.data:</span> <span class="string">/usr/local/elasticsearch-6.7.1/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志保存地址</span></span><br><span class="line"><span class="attr">path.logs:</span> <span class="string">/usr/local/elasticsearch-6.7.1/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ip</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编辑配置文件</span></span><br><span class="line">vim ./config/jvm.options</span><br></pre></td></tr></table></figure><h5 id="jvm-options"><a href="#jvm-options" class="headerlink" title="jvm.options"></a>jvm.options</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms1g</span><br><span class="line">-Xmx1g</span><br></pre></td></tr></table></figure><blockquote><p>  注意：<code>elasticsearch</code>启动不能以<code>root</code>用户来进行，所以需要创建一个用户 </p></blockquote><h4 id="创建用户并授权"><a href="#创建用户并授权" class="headerlink" title="创建用户并授权"></a>创建用户并授权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建用户</span></span><br><span class="line">useradd elsearch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 授权</span></span><br><span class="line">chown -R elsearch:elsearch /usr/local/elasticsearch-6.7.1</span><br></pre></td></tr></table></figure><h4 id="切换到ES用户启动"><a href="#切换到ES用户启动" class="headerlink" title="切换到ES用户启动"></a>切换到ES用户启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换到es用户</span></span><br><span class="line">su elsearch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给用户elsearch设置密码（我没有设置密码）</span></span><br><span class="line">passwd elsearch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除用户elsearch的密码</span></span><br><span class="line">passwd -d elsearch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入es目录</span></span><br><span class="line">cd /usr/local/elasticsearch-6.7.1/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">./elasticsearch</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 后台启动</span></span><br><span class="line">./elasticsearch -d</span><br></pre></td></tr></table></figure><h4 id="停止ES进程"><a href="#停止ES进程" class="headerlink" title="停止ES进程"></a>停止ES进程</h4><p>前台运行： <code>Ctrl + C</code></p><p>后台运行：<code>kill -9 #es进程号</code>，也可以通过执行命令<code>curl -XPOST http://localhost:9200/_cluster/nodes/_shutdown</code>关闭整个集群，<code>curl -XPOST http://localhost:9200/_cluster/nodes/节点标识符/_shutdown</code>关闭单个节点</p><p>查看es进程号<code>ps -ef|grep elasticsearch</code></p><h4 id="启动报错"><a href="#启动报错" class="headerlink" title="启动报错"></a>启动报错</h4><ul><li><p><code>max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]</code></p><p>修改<code>/etc/security/limits.conf</code>文件 在文件末尾添加如下内容，然后重启服务器或重新登录即可生效。重启后用查看命令进行查看，如果显示数字等于204800即证明修改成功。如果不成功请继续往下看 </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们用的是elsearch用户，而不是root，权限不足。</span></span><br><span class="line"><span class="comment"># 首先用root用户登录，然后修改配置文件:</span></span><br><span class="line"><span class="attribute">su</span> - root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置命令：</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果文件是只读文件，修改为可读写</span></span><br><span class="line">chmod <span class="number">666</span> /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看命令:(-n是可以打开最大文件描述符的数量。 -u是用户最大可用的进程数。)</span></span><br><span class="line">ulimit -n</span><br><span class="line">ulimit -u</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加下面的内容：</span></span><br><span class="line">* soft nofile <span class="number">65536</span></span><br><span class="line">* hard nofile <span class="number">65536</span></span><br><span class="line">* soft nproc <span class="number">65536</span></span><br><span class="line">* hard nproc <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改为只读</span></span><br><span class="line">chmod <span class="number">222</span> /etc/security/limits.conf</span><br></pre></td></tr></table></figure><p>我在解决这个问题时候，发现网上都是说修改这一个文件就行，但是我修改后重新登录发现没更改过来。后来发现，还需要修改两个文件。如果你重启后也没生效，请继续跟着往下修改。 </p><blockquote><p>注：修改<code>90-nproc.conf</code>，如果<code>90-nproc.conf</code>不存在，修改类似的文件即可，即<code>xx-nproc.conf</code>，我本地就是<code>/etc/security/limits.d/20-nproc.conf</code>。 </p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加下面的内容：</span></span><br><span class="line">* <span class="attribute">soft</span> nproc <span class="number">65536</span></span><br><span class="line">* hard nproc <span class="number">65536</span></span><br><span class="line">* soft nofile <span class="number">65536</span></span><br><span class="line">* hard nofile <span class="number">65536</span></span><br></pre></td></tr></table></figure><p>官方 <code>manual </code>以及网上的教程有很多都用了<code>*</code>符号，然而不是所有系统都认的，比如我在解决这个问题时候，发现<code>ubuntu</code>系统就不支持。最前面一列代表用户名即<code>root</code>和<code>elsearh</code>。 </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不兼容方式</span></span><br><span class="line">* <span class="attribute">soft</span> nproc <span class="number">65536</span></span><br><span class="line">* hard nproc <span class="number">65536</span></span><br><span class="line">* soft nofile <span class="number">65536</span></span><br><span class="line">* hard nofile <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 兼容方式</span></span><br><span class="line">root soft nproc <span class="number">65536</span></span><br><span class="line">root hard nproc <span class="number">65536</span></span><br><span class="line">root soft nofile <span class="number">65536</span></span><br><span class="line">root hard nofile <span class="number">65536</span></span><br><span class="line">elsearch soft nproc <span class="number">65536</span></span><br><span class="line">elsearch hard nproc <span class="number">65536</span></span><br><span class="line">elsearch soft nofile <span class="number">65536</span></span><br><span class="line">elsearch hard nofile <span class="number">65536</span></span><br></pre></td></tr></table></figure><p><font style="color: red; font-size: 20px">limits.conf 建议不要使用星号</font></p></li><li><p><code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换到root用户</span></span><br><span class="line">su - root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置sysctl.conf</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加下面配置：</span></span><br><span class="line">vm.max_map_count=655360</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 并执行命令：</span></span><br><span class="line">sysctl -p</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">然后，重新启动elasticsearch，即可启动成功</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h4><p>在<code>elasticsearch-head</code>插件地址栏中输入服务器的地址，如：<a href="http://192.168.1.12:9200，很不幸，打不开。下面进行原因排查：">http://192.168.1.12:9200，很不幸，打不开。下面进行原因排查：</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-port=9200/tcp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果显示no，说明9200端口没有开</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放80端口，重启防火墙</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --permanent 永久生效，没有此参数重启后失效</span></span><br><span class="line">firewall-cmd --add-port=9200/tcp --permanent</span><br><span class="line">systemctl restart firewalld</span><br></pre></td></tr></table></figure><h3 id="LogStash"><a href="#LogStash" class="headerlink" title="LogStash"></a>LogStash</h3><h4 id="下载-1"><a href="#下载-1" class="headerlink" title="下载"></a>下载</h4><p> <a class="link"   href="https://artifacts.elastic.co/downloads/logstash/logstash-6.7.1.tar.gz" >https://artifacts.elastic.co/downloads/logstash/logstash-6.7.1.tar.gz<i class="fas fa-external-link-alt"></i></a> </p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p> 上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定目录</span></span><br><span class="line">tar -zxvf logstash-6.7.1.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><h5 id="新建配置文件"><a href="#新建配置文件" class="headerlink" title="新建配置文件"></a>新建配置文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cp logstash-sample.conf logstash-test.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入logstash数据目录</span></span><br><span class="line">cd /usr/local/logstash-6.7.1/data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建结果保存目录</span></span><br><span class="line">mkdir metadata</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建抽取脚本目录</span></span><br><span class="line">mkdir sql</span><br></pre></td></tr></table></figure><h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><blockquote><p>jdbc_driver_library： 数据库驱动存放位置</p><p>statement_filepath：抽取脚本存放位置</p><p>last_run_metadata_path：运行结果保存位置</p></blockquote><p>部分配置文件</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sample Logstash configuration for creating a simple</span></span><br><span class="line"><span class="comment"># Beats -&gt; Logstash -&gt; Elasticsearch pipeline.</span></span><br><span class="line"></span><br><span class="line"><span class="section">input</span> &#123;</span><br><span class="line">    <span class="section">jdbc</span> &#123;</span><br><span class="line">    <span class="comment">#驱动地址</span></span><br><span class="line">    <span class="attribute">jdbc_driver_library</span> =&gt; <span class="string">&quot;/home/xis/ojdbc8-12.2.0.1.jar&quot;</span></span><br><span class="line">    <span class="comment"># jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">&quot;Java::oracle.jdbc.driver.OracleDriver&quot;</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">&quot;jdbc:oracle:thin:@192.168.40.104:1521:hczz&quot;</span></span><br><span class="line">    jdbc_user =&gt; zdkz</span><br><span class="line">    jdbc_password =&gt; zdkz</span><br><span class="line">    <span class="comment">#仅提取自上次运行以来更改的数据一般使用自增id或者使用update_time 最后更新时间</span></span><br><span class="line">    <span class="comment">#sql 语句文件，也可以直接写SQL，如statement =&gt; &quot;select * from table1&quot;</span></span><br><span class="line">    <span class="comment">#statement =&gt; &quot;select * from tb_yw_shxx where del = &#x27;0&#x27; and modify_date &gt; :sql_last_value&quot;</span></span><br><span class="line">        statement_filepath =&gt; <span class="string">&quot;/usr/local/logstash-6.7.1/data/sql/shxx.sql&quot;</span></span><br><span class="line">        <span class="comment">#是否使用column 作为增量字段</span></span><br><span class="line">    use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    <span class="comment">#增量字段的类型，目前只有数字(numeric)和时间类型(timestamp)，默认是数字类型</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">    <span class="comment">#以id做为增量值，用于增量同步，需是数据库字段</span></span><br><span class="line">    tracking_column =&gt; <span class="string">&quot;modify_date&quot;</span></span><br><span class="line">    <span class="comment">#是否记录上次执行结果，true表示会将上次执行结果的tracking_column字段的值保存到last_run_metadata_path指定的文件中</span></span><br><span class="line">    record_last_run =&gt; <span class="literal">true</span></span><br><span class="line">    <span class="comment">#上面运行结果的保存位置</span></span><br><span class="line">    last_run_metadata_path =&gt; <span class="string">&quot;/usr/local/logstash-6.7.1/data/metadata/shxx&quot;</span>    </span><br><span class="line"><span class="comment"># 是否将字段名转换为小写，默认true（如果有数据序列化、反序列化需求，建议改为false）；</span></span><br><span class="line">lowercase_column_names =&gt; <span class="literal">true</span>           </span><br><span class="line">    <span class="comment">#是否清除last_run_metadata_path的记录，需要增量同步时此字段必须为false</span></span><br><span class="line">  clean_run =&gt; <span class="literal">false</span></span><br><span class="line">  <span class="comment">#定时设置，corn表达式</span></span><br><span class="line">      schedule =&gt; <span class="string">&quot;* * * * *&quot;</span></span><br><span class="line">      <span class="comment">#ES中type</span></span><br><span class="line">      type =&gt; <span class="string">&quot;shxx&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">    jdbc &#123;</span><br><span class="line">    <span class="comment">#驱动地址</span></span><br><span class="line">    <span class="attribute">jdbc_driver_library</span> =&gt; <span class="string">&quot;/home/xis/ojdbc8-12.2.0.1.jar&quot;</span></span><br><span class="line">    <span class="comment"># jdbc_driver_class =&gt; &quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class="line">    jdbc_driver_class =&gt; <span class="string">&quot;Java::oracle.jdbc.driver.OracleDriver&quot;</span></span><br><span class="line">    jdbc_connection_string =&gt; <span class="string">&quot;jdbc:oracle:thin:@192.168.40.104:1521:hczz&quot;</span></span><br><span class="line">    jdbc_user =&gt; zdkz</span><br><span class="line">    jdbc_password =&gt; zdkz</span><br><span class="line">    <span class="comment">#仅提取自上次运行以来更改的数据一般使用自增id或者使用update_time 最后更新时间</span></span><br><span class="line">    <span class="comment">#sql 语句文件，也可以直接写SQL，如statement =&gt; &quot;select * from table1&quot;</span></span><br><span class="line">    <span class="comment">#statement =&gt; &quot;select * from tb_yw_zdxx where del = &#x27;0&#x27; and modify_date &gt; :sql_last_value order&quot;</span></span><br><span class="line">        statement_filepath =&gt; <span class="string">&quot;/usr/local/logstash-6.7.1/data/sql/zdxx.sql&quot;</span></span><br><span class="line">        <span class="comment">#是否使用column 作为增量字段</span></span><br><span class="line">    use_column_value =&gt; <span class="literal">true</span></span><br><span class="line">    <span class="comment">#增量字段的类型，目前只有数字(numeric)和时间类型(timestamp)，默认是数字类型</span></span><br><span class="line">    tracking_column_type =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">    <span class="comment">#以id做为增量值，用于增量同步，需是数据库字段</span></span><br><span class="line">    tracking_column =&gt; <span class="string">&quot;modify_date&quot;</span></span><br><span class="line">    <span class="comment">#是否记录上次执行结果，true表示会将上次执行结果的tracking_column字段的值保存到last_run_metadata_path指定的文件中</span></span><br><span class="line">    record_last_run =&gt; <span class="literal">true</span></span><br><span class="line">    <span class="comment">#上面运行结果的保存位置</span></span><br><span class="line">    last_run_metadata_path =&gt; <span class="string">&quot;/usr/local/logstash-6.7.1/data/metadata/zdxx&quot;</span>    </span><br><span class="line"><span class="comment"># 是否将字段名转换为小写，默认true（如果有数据序列化、反序列化需求，建议改为false）；</span></span><br><span class="line">lowercase_column_names =&gt; <span class="literal">true</span>           </span><br><span class="line">    <span class="comment">#是否清除last_run_metadata_path的记录，需要增量同步时此字段必须为false</span></span><br><span class="line">  clean_run =&gt; <span class="literal">false</span></span><br><span class="line">  <span class="comment">#定时设置，corn表达式</span></span><br><span class="line">      schedule =&gt; <span class="string">&quot;* * * * *&quot;</span></span><br><span class="line"><span class="comment">#ES中type</span></span><br><span class="line">      type =&gt; <span class="string">&quot;zdxx&quot;</span>      </span><br><span class="line">&#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">    <span class="comment"># 解决默认时区与当前时区相差8小时问题</span></span><br><span class="line"><span class="section">ruby</span> &#123; </span><br><span class="line"><span class="attribute">code</span> =&gt; <span class="string">&quot;event.set(&#x27;timestamp&#x27;, event.get(&#x27;@timestamp&#x27;).time.localtime + 8*60*60)&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line">ruby &#123;</span><br><span class="line"><span class="attribute">code</span> =&gt; <span class="string">&quot;event.set(&#x27;@timestamp&#x27;,event.get(&#x27;timestamp&#x27;))&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">mutate &#123;</span><br><span class="line"><span class="attribute">remove_field</span> =&gt; [<span class="string">&quot;timestamp&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">if[type] == &quot;shxx&quot;&#123;</span><br><span class="line"><span class="section">elasticsearch</span> &#123;</span><br><span class="line"><span class="comment">#ES ip:port</span></span><br><span class="line"><span class="attribute">hosts</span> =&gt; [<span class="string">&quot;localhost:9200&quot;</span>]</span><br><span class="line"><span class="comment">#ES索引名</span></span><br><span class="line">index =&gt; <span class="string">&quot;tb_yw_shxx&quot;</span></span><br><span class="line">document_type =&gt; <span class="string">&quot;doc&quot;</span></span><br><span class="line">document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if[type] == <span class="string">&quot;zdxx&quot;</span>&#123;</span><br><span class="line"><span class="section">elasticsearch</span> &#123;</span><br><span class="line"><span class="comment">#ES ip:port</span></span><br><span class="line"><span class="attribute">hosts</span> =&gt; [<span class="string">&quot;localhost:9200&quot;</span>]</span><br><span class="line"><span class="comment">#ES索引名</span></span><br><span class="line">index =&gt; <span class="string">&quot;tb_yw_zdxx&quot;</span></span><br><span class="line">document_type =&gt; <span class="string">&quot;doc&quot;</span></span><br><span class="line">document_id =&gt; <span class="string">&quot;%&#123;id&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入logstash安装目录</span></span><br><span class="line">cd /usr/local/logstash-6.7.1/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">logstash -f ../config/logstash-test.conf</span><br></pre></td></tr></table></figure><p>后台启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup logstash -f ../config/logstash-test.conf</span><br></pre></td></tr></table></figure><h4 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h4><p>查看进程号 <code>ps -ef|grep logstash</code></p><p>杀掉进程 <code>kill -9 #logstash进程号</code></p><h3 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h3><h4 id="下载-2"><a href="#下载-2" class="headerlink" title="下载"></a>下载</h4><p> <a class="link"   href="https://artifacts.elastic.co/downloads/kibana/kibana-6.7.1.tar.gz" >https://artifacts.elastic.co/downloads/kibana/kibana-6.7.1.tar.gz<i class="fas fa-external-link-alt"></i></a> </p><h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><p> 上传下载过后的压缩包到自己的服务器目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd /opt/software</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定目录</span></span><br><span class="line">tar -zxvf kibana-6.7.1.tar.gz -C /usr/local</span><br></pre></td></tr></table></figure><h4 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h4><h5 id="kibana-yml"><a href="#kibana-yml" class="headerlink" title="kibana.yml"></a>kibana.yml</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 端口</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主机</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;localhost&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># es地址</span></span><br><span class="line"><span class="attr">elasticsearch.url:</span> <span class="string">&quot;http://localhost:9200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 索引</span></span><br><span class="line"><span class="attr">kibana.index:</span> <span class="string">&quot;.kibana&quot;</span></span><br></pre></td></tr></table></figure><h4 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入kibana安装目录</span></span><br><span class="line">cd /usr/local/kibana-6.7.1/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">./kibana</span><br></pre></td></tr></table></figure><p>后台启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 后台启动</span></span><br><span class="line">nohup ./kibana &amp;</span><br></pre></td></tr></table></figure><h4 id="停止-1"><a href="#停止-1" class="headerlink" title="停止"></a>停止</h4><p><font style="color: red; font-size: 20px">ps -ef|grep kibana找不到进程号</font></p><p>查看进程号 <code>fuser -n tcp 5601</code></p><p>杀掉进程 <code>kill -9 #kibana进程号</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ElasticSearch&quot;&gt;&lt;a href=&quot;#ElasticSearch&quot; class=&quot;headerlink&quot; title=&quot;ElasticSearch&quot;&gt;&lt;/a&gt;ElasticSearch&lt;/h3&gt;&lt;h4 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; cla</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Linux" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Linux/"/>
    
    
    <category term="Linux" scheme="https://valtenhyl.github.io/tags/Linux/"/>
    
    <category term="ELK" scheme="https://valtenhyl.github.io/tags/ELK/"/>
    
    <category term="ElasticSearch" scheme="https://valtenhyl.github.io/tags/ElasticSearch/"/>
    
    <category term="LogStash" scheme="https://valtenhyl.github.io/tags/LogStash/"/>
    
    <category term="Kibana" scheme="https://valtenhyl.github.io/tags/Kibana/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis 逆向工程</title>
    <link href="https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/Mybatis/Mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/"/>
    <id>https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/Mybatis/Mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/</id>
    <published>2020-09-28T05:28:56.000Z</published>
    <updated>2021-10-29T06:58:14.283Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mybatis-generator"><a href="#mybatis-generator" class="headerlink" title="mybatis-generator"></a>mybatis-generator</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ojdbc.version</span>&gt;</span>12.2.0.1<span class="tag">&lt;/<span class="name">ojdbc.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jdbc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ojdbc.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis逆向工程插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="generatorConfig-xml"><a href="#generatorConfig-xml" class="headerlink" title="generatorConfig.xml"></a>generatorConfig.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--classPathEntry:数据库的JDBC驱动,换成你自己的驱动位置 可选 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">&quot;D:\Program\Apache\apache-maven-3.6.3\repo\com\oracle\ojdbc8\12.2.0.1\ojdbc8-12.2.0.1.jar&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一个数据库一个context --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;OracleTables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 生成的Java文件的编码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javaFileEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 注释 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span><span class="comment">&lt;!-- 是否取消注释 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 是否生成注释代时间戳--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--数据库连接的信息：驱动类、连接地址、用户名、密码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:oracle:thin:@192.168.40.104:1521:hczz&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;zdkz&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;zdkz&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 针对oracle数据库 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;remarksReporting&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 类型转换 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否使用bigDecimal， false可自动转化以下类型（Long, Integer, Short, etc.） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 生成实体类地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.hisign.xzxt2.zdkz.model.zdxx&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从数据库返回的值去掉前后空格 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定map.xml生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定mapper接口生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.hisign.xzxt2.zdkz.db.dao.zdxx&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java/&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- table可以有多个,每个数据库中的表都可以写一个table，tableName表示要匹配的数据库表,也可以在tableName属性中通过使用%通配符</span></span><br><span class="line"><span class="comment">        来匹配所有数据库表,只有匹配的表才会自动生成文件 enableSelectByPrimaryKey相应的配置表示是否生成相应的接口 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;TB_YW_ZDCXRY&quot;</span> <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableSelectByPrimaryKey</span>=<span class="string">&quot;true&quot;</span> <span class="attr">enableUpdateByPrimaryKey</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByPrimaryKey</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useActualColumnNames&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置启动配置"><a href="#配置启动配置" class="headerlink" title="配置启动配置"></a>配置启动配置</h3><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://s1.ax1x.com/2020/09/28/0E1x9U.png"                      alt="0E1x9U.png"                ></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;mybatis-generator&quot;&gt;&lt;a href=&quot;#mybatis-generator&quot; class=&quot;headerlink&quot; title=&quot;mybatis-generator&quot;&gt;&lt;/a&gt;mybatis-generator&lt;/h2&gt;&lt;h3 id=&quot;pom-x</summary>
      
    
    
    
    <category term="后端" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="Mybatis" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/Mybatis/"/>
    
    
    <category term="Mybatis" scheme="https://valtenhyl.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>Oracle 四大排名函数</title>
    <link href="https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E5%9B%9B%E5%A4%A7%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0/"/>
    <id>https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E5%9B%9B%E5%A4%A7%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0/</id>
    <published>2020-09-25T09:58:43.000Z</published>
    <updated>2021-10-29T06:58:14.284Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ROW-NUMBER"><a href="#ROW-NUMBER" class="headerlink" title="ROW_NUMBER()"></a>ROW_NUMBER()</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><blockquote><p>ROW_NUMBER()函数作用就是将select查询到的数据进行排序，每一条数据加一个序号，他不能用做于学生成绩的排名，一般多用于分页查询， 比如查询前10个学生。</p></blockquote><h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><p>对学生成绩排序</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/rownumber1.jpg"                      alt="这里写图片描述"                ><br>这里number就是每个学生的序号 根据studentScore(分数)进行desc倒序</p><p>获取第二个同学成绩</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/rownumber2.jpg"                      alt="这里写图片描述"                ><br>这里用到的思想就是 分页查询的思想 在原sql外再套一层 <strong>select</strong><br><code>where t.number&gt;=1 and t.number&lt;=10</code> 是不是就是获取前十个学生的成绩信息纳。</p><h4 id="RANK"><a href="#RANK" class="headerlink" title="RANK()"></a>RANK()</h4><h5 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h5><blockquote><p>RANK()函数，顾名思义排名函数，可以对某一个字段进行排名，这里为什么和ROW_NUMBER()不一样那，ROW_NUMBER()是排序，当存在相同成绩的学生时，ROW_NUMBER()会依次进行排序，他们序号不相同，而Rank()则不一样出现相同的，他们的排名是一样的。下面看例子:</p></blockquote><h5 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h5><p>对学生成绩进行排名</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/rank1.jpg"                      alt="这里写图片描述"                ></p><p>这里发现 ROW_NUMBER()和RANK()怎么一样？因为学生成绩都不一样所以排名和排序一样，下面改一下就会发现区别。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/rank2.jpg"                      alt="这里写图片描述"                ></p><p>当出现两个学生成绩相同是里面出现变化。RANK()是 1 2 2，而ROW_NUMBER()则还是1 2 3，这就是RANK()和ROW_NUMBER()的区别了</p><h4 id="DENSE-RANK"><a href="#DENSE-RANK" class="headerlink" title="DENSE_RANK()"></a>DENSE_RANK()</h4><h5 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h5><blockquote><p>DENSE_RANK()函数也是排名函数，和RANK()功能相似，也是对字段进行排名，那它和RANK()到底有什么不同那？看例子：</p></blockquote><h5 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h5><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/denserank1.jpg"                      alt="这里写图片描述"                ></p><p>DENSE_RANK()密集的排名他和RANK()区别在于，排名的连续性，DENSE_RANK()排名是连续的，RANK()是跳跃的排名，所以一般情况下用的排名函数就是RANK()。</p><h4 id="NTILE"><a href="#NTILE" class="headerlink" title="NTILE()"></a>NTILE()</h4><h5 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h5><blockquote><p>NTILE()函数是将有序分区中的行分发到指定数目的组中，各个组有编号，编号从1开始，就像我们说的’分区’一样 ，分为几个区，一个区会有多少个。</p></blockquote><h5 id="实例：-1"><a href="#实例：-1" class="headerlink" title="实例："></a>实例：</h5><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://gitee.com/valten/filebed/raw/master/ntile1.jpg"                      alt="这里写图片描述"                ></p><p>这里查询了3次,第一次分为1个’区’ ,所以查询结果number全是1，第二次分为2个区，查询结果为 1 1 2，意思就是 第一个 ‘区’ 为 1 1 两个编号的数据 ，第二个’区’只有2这个数据。</p><p>到这里，SQL的排名问题就说完了，下次介绍一些深层的SQL排名语句</p><p><strong>参考</strong>：</p><p><a class="link"   href="https://blog.csdn.net/shaiguchun9503/article/details/82349050" >https://blog.csdn.net/shaiguchun9503/article/details/82349050<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;ROW-NUMBER&quot;&gt;&lt;a href=&quot;#ROW-NUMBER&quot; class=&quot;headerlink&quot; title=&quot;ROW_NUMBER()&quot;&gt;&lt;/a&gt;ROW_NUMBER()&lt;/h4&gt;&lt;h5 id=&quot;定义&quot;&gt;&lt;a href=&quot;#定义&quot; class=&quot;head</summary>
      
    
    
    
    <category term="数据库" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/"/>
    
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/tags/Oracle/"/>
    
    <category term="排名函数" scheme="https://valtenhyl.github.io/tags/%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>Oracle 高级分组函数</title>
    <link href="https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E9%AB%98%E7%BA%A7%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0/"/>
    <id>https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E9%AB%98%E7%BA%A7%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0/</id>
    <published>2020-09-25T09:58:43.000Z</published>
    <updated>2021-10-29T06:58:14.284Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本文主要讲解 <code>ROLLUP, CUBE, GROUPING SETS</code>的主要用法，这些函数可以理解为<code>GroupBy</code>分组函数封装后的精简用法，相当于多个<code>union all</code> 的组合显示效果，但是要比 多个union all的效率要高。</p></blockquote><blockquote><p>其实这些函数在时间的程序开发中应用的并不多，至少在我工作的多年时间中没用过几次，因为现在的各种开发工具/平台都自带了这些高级分组统计功能，使用的方便性及美观性都比这些要好。但如果临时查下数据，用这些函数还是不错的。</p></blockquote><h3 id="创建测试环境"><a href="#创建测试环境" class="headerlink" title="创建测试环境"></a>创建测试环境</h3><p>在线数据库 <a class="link"   href="http://sqlfiddle.com/" >http://sqlfiddle.com/<i class="fas fa-external-link-alt"></i></a> </p><p><strong>1.   创建表</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> EMP2</span><br><span class="line">(</span><br><span class="line">  ID       NUMBER,  <span class="comment">/**员工编号*/</span></span><br><span class="line">  NAME     VARCHAR2(<span class="number">20</span>), <span class="comment">/**姓名*/</span></span><br><span class="line">  SEX     VARCHAR2(<span class="number">3</span>),  <span class="comment">/**性别*/</span></span><br><span class="line">  HIREDATE <span class="type">DATE</span>,         <span class="comment">/**入职日期*/</span></span><br><span class="line">  BASE    VARCHAR2(<span class="number">20</span>), <span class="comment">/**工作母地*/</span></span><br><span class="line">  DEPT    VARCHAR2(<span class="number">20</span>), <span class="comment">/**所在部门*/</span></span><br><span class="line">  SAL     NUMBER        <span class="comment">/**月工资*/</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>2.   插入测试数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">107</span>, <span class="string">&#x27;小月&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, to_date(<span class="string">&#x27;01-09-2013&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;营运&#x27;</span>, <span class="number">9000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">108</span>, <span class="string">&#x27;小美&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, to_date(<span class="string">&#x27;01-06-2011&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;营运&#x27;</span>, <span class="number">11000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">101</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, to_date(<span class="string">&#x27;01-01-2011&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;财务&#x27;</span>, <span class="number">8000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">102</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, to_date(<span class="string">&#x27;01-01-2012&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;营运&#x27;</span>, <span class="number">15000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">103</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, to_date(<span class="string">&#x27;01-01-2013&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;营运&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">104</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, to_date(<span class="string">&#x27;01-01-2014&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;财务&#x27;</span>, <span class="number">10000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">105</span>, <span class="string">&#x27;小花&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, to_date(<span class="string">&#x27;01-08-2014&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;财务&#x27;</span>, <span class="number">4000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 (ID, NAME, SEX, HIREDATE,BASE, DEPT, SAL)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">106</span>, <span class="string">&#x27;小静&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, to_date(<span class="string">&#x27;01-01-2015&#x27;</span>, <span class="string">&#x27;dd-mm-yyyy&#x27;</span>), <span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;财务&#x27;</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><p><strong>3.   查看一下刚才插入的数据</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2;</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|  ID | NAME | SEX |             HIREDATE | BASE | DEPT |   SAL |</span><br><span class="line">|-----|------|-----|----------------------|------|------|-------|</span><br><span class="line">| 107 |   小月 |   女 | 2013-09-01T00:00:00Z |   北京 |   营运 |  9000 |</span><br><span class="line">| 108 |   小美 |   女 | 2011-06-01T00:00:00Z |   上海 |   营运 | 11000 |</span><br><span class="line">| 101 |   张三 |   男 | 2011-01-01T00:00:00Z |   北京 |   财务 |  8000 |</span><br><span class="line">| 102 |   李四 |   男 | 2012-01-01T00:00:00Z |   北京 |   营运 | 15000 |</span><br><span class="line">| 103 |   王五 |   男 | 2013-01-01T00:00:00Z |   上海 |   营运 |  6000 |</span><br><span class="line">| 104 |   赵六 |   男 | 2014-01-01T00:00:00Z |   上海 |   财务 | 10000 |</span><br><span class="line">| 105 |   小花 |   女 | 2014-08-01T00:00:00Z |   上海 |   财务 |  4000 |</span><br><span class="line">| 106 |   小静 |   女 | 2015-01-01T00:00:00Z |   北京 |   财务 |  6000 |</span><br></pre></td></tr></table></figure><p><strong>4.   先看下普通分组的效果</strong></p><p>按照地区统计每个部门的总工资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> base, dept;</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">| BASE | DEPT | SUM(SAL) |</span><br><span class="line">|------|------|----------|</span><br><span class="line">|   北京 |   营运 |    24000 |</span><br><span class="line">|   上海 |   营运 |    17000 |</span><br><span class="line">|   北京 |   财务 |    14000 |</span><br><span class="line">|   上海 |   财务 |    14000 |</span><br></pre></td></tr></table></figure><h3 id="ROLLUP-累计累加"><a href="#ROLLUP-累计累加" class="headerlink" title="ROLLUP(累计累加)"></a>ROLLUP(累计累加)</h3><blockquote><p><code>ROLLUP</code>是对<code>group by</code>的扩展，因此，它只能出现在<code>group by</code>子句中，依赖于分组的列，对每个分组会生成汇总数据, <code>rollup</code>和<code>group by</code>联合一起使用，达到了按<code>group by</code>列顺序分组，并且实现小计和合计的功能。<code>rollup</code>分组还是有序的，先全部分组，然后对每个分组小计，最后合计。</p></blockquote><blockquote><p><code>rollup</code>中列的顺序不同，则统计的结果不同。因为它是按列从右递减分组的。</p></blockquote><blockquote><p>比如 <code>Group by ROLLUP(A, B, C)</code>，首先会对**(A、B、C)<strong>进行<code>GROUP BY</code>，然后对group by进行<code>GROUP BY</code>，然后是</strong>(A)**进行<code>GROUP BY</code>，最后对全表进行<code>GROUP BY</code>操作</p></blockquote><p>按照地区统计每个部门的总工资，按工作母地汇总，再合计</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>(base, dept);</span><br></pre></td></tr></table></figure><p> 结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 |     营运 |    17000 |</span><br><span class="line">|     上海 |     财务 |    14000 |</span><br><span class="line">|     上海 | (null) |    31000 |</span><br><span class="line">|     北京 |     营运 |    24000 |</span><br><span class="line">|     北京 |     财务 |    14000 |</span><br><span class="line">|     北京 | (null) |    38000 |</span><br><span class="line">| (null) | (null) |    69000 |</span><br></pre></td></tr></table></figure><p>结果相当于</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> base, dept</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> base, <span class="keyword">null</span>, <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> base, <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">null</span>, <span class="keyword">null</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>如果颠倒下rollup顺序则结果如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>(dept,base);</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 |     营运 |    17000 |</span><br><span class="line">|     北京 |     营运 |    24000 |</span><br><span class="line">| (null) |     营运 |    41000 |</span><br><span class="line">|     上海 |     财务 |    14000 |</span><br><span class="line">|     北京 |     财务 |    14000 |</span><br><span class="line">| (null) |     财务 |    28000 |</span><br><span class="line">| (null) | (null) |    69000 |</span><br></pre></td></tr></table></figure><p>如果在实际查询中，有的小计或合计我们不需要，那么就要使用局部rollup,局部rollup就是将需要固定统计的列放在group by中，而不是放在rollup中。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> dept, <span class="keyword">rollup</span>(base);</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|   BASE | DEPT | SUM(SAL) |</span><br><span class="line">|--------|------|----------|</span><br><span class="line">|     上海 |   营运 |    17000 |</span><br><span class="line">|     北京 |   营运 |    24000 |</span><br><span class="line">| (null) |   营运 |    41000 |</span><br><span class="line">|     上海 |   财务 |    14000 |</span><br><span class="line">|     北京 |   财务 |    14000 |</span><br><span class="line">| (null) |   财务 |    28000 |</span><br></pre></td></tr></table></figure><p>与<code>group by rollup(dept, base)</code>相比：去掉了最后一行的汇总，因为每次汇总要么是<code>dept, base</code>，要么是<code>dept, null</code> ，<code>dept</code>是固定的。</p><p>如果只希望看到合计则可以这样写：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>((base, dept));</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 |     营运 |    17000 |</span><br><span class="line">|     上海 |     财务 |    14000 |</span><br><span class="line">|     北京 |     营运 |    24000 |</span><br><span class="line">|     北京 |     财务 |    14000 |</span><br><span class="line">| (null) | (null) |    69000 |</span><br></pre></td></tr></table></figure><h3 id="CUBE-交叉列表"><a href="#CUBE-交叉列表" class="headerlink" title="CUBE(交叉列表)"></a>CUBE(交叉列表)</h3><blockquote><p><code>CUBE</code>也是对<code>group by</code>运算的一种扩展，它比<code>rollup</code>扩展更加精细，组合类型更多，<code>rollup</code>是按组合的列从右到左递减分组计算，而<code>CUBE</code>则是对所有可能的组合情况进行分组，这样分组的情况更多，覆盖所有的可能分组，并计算所有可能的分组的小计。</p></blockquote><blockquote><p>对于<code>CUBE</code>来说，列的名字只要一样，那么顺序无所谓，结果都是一样的，因为<code>cube</code>是各种可能情况的组合,只不过统计的结果顺序不同而已。但是对于<code>rollup</code>来说，列的顺序不同，则结果不同。</p></blockquote><p>比如对工作母地和部门的交叉统计</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">cube</span>(base, dept) <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 |     营运 |    17000 |</span><br><span class="line">|     上海 |     财务 |    14000 |</span><br><span class="line">|     上海 | (null) |    31000 |</span><br><span class="line">|     北京 |     营运 |    24000 |</span><br><span class="line">|     北京 |     财务 |    14000 |</span><br><span class="line">|     北京 | (null) |    38000 |</span><br><span class="line">| (null) |     营运 |    41000 |</span><br><span class="line">| (null) |     财务 |    28000 |</span><br><span class="line">| (null) | (null) |    69000 |</span><br></pre></td></tr></table></figure><p>部分<code>CUBE</code>和部分<code>ROLLUP</code>类似，把需要固定统计的列放到<code>group by</code>中，不放到cube中就可以了。</p><p>如果<code>cube</code>中只有一个列，那么和<code>rollup</code>的结果一致</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> dept, <span class="keyword">cube</span>(base) <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|   BASE | DEPT | SUM(SAL) |</span><br><span class="line">|--------|------|----------|</span><br><span class="line">|     上海 |   营运 |    17000 |</span><br><span class="line">|     上海 |   财务 |    14000 |</span><br><span class="line">|     北京 |   营运 |    24000 |</span><br><span class="line">|     北京 |   财务 |    14000 |</span><br><span class="line">| (null) |   营运 |    41000 |</span><br><span class="line">| (null) |   财务 |    28000 |</span><br></pre></td></tr></table></figure><p><code>rollup</code>和<code>cube</code>区别：</p><p>如果是<code>ROLLUP(A,B, C)</code>的话，<code>GROUP BY</code>顺序</p><p>(A、B、C)</p><p>(A、B)</p><p>(A)</p><p>最后对全表进行<code>GROUPBY</code>操作。</p><p>如果是<code>GROUP BY CUBE(A, B, C)</code>，<code>GROUP BY</code>顺序<br>(A、B、C)</p><p>(A、B)</p><p>(A、C)</p><p>(A)，</p><p>(B、C)</p><p>(B)</p><p>(C)，</p><p>最后对全表进行GROUPBY操作。</p><h3 id="GROUPING-SETS-小计"><a href="#GROUPING-SETS-小计" class="headerlink" title="GROUPING SETS(小计)"></a>GROUPING SETS(小计)</h3><blockquote><p>对<code>group by</code>的另一个扩展，专门对分组列分别进行小计计算，不包括合计。使用方式和<code>rollup</code>和<code>cube</code>一样，都是放在<code>group by</code>中。</p></blockquote><p>比如需要分别统计工作母地与部门的合计：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">grouping</span> sets(base, dept);</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 | (null) |    31000 |</span><br><span class="line">|     北京 | (null) |    38000 |</span><br><span class="line">| (null) |     营运 |    41000 |</span><br><span class="line">| (null) |     财务 |    28000 |</span><br></pre></td></tr></table></figure><p>等价于</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, <span class="keyword">null</span>, <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> base, <span class="keyword">null</span> </span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line"><span class="keyword">select</span> <span class="keyword">null</span>, dept, <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">null</span>, dept;</span><br></pre></td></tr></table></figure><p>理解了<code>grouping sets</code>的原理我们用他实现<code>rollup</code>的功能也是可以的：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> base, dept, <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp2 <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">grouping</span> sets((base, dept), dept, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|   BASE |   DEPT | SUM(SAL) |</span><br><span class="line">|--------|--------|----------|</span><br><span class="line">|     上海 |     营运 |    17000 |</span><br><span class="line">|     北京 |     营运 |    24000 |</span><br><span class="line">| (null) |     营运 |    41000 |</span><br><span class="line">|     上海 |     财务 |    14000 |</span><br><span class="line">|     北京 |     财务 |    14000 |</span><br><span class="line">| (null) |     财务 |    28000 |</span><br><span class="line">| (null) | (null) |    69000 |</span><br></pre></td></tr></table></figure><h3 id="GROUPING"><a href="#GROUPING" class="headerlink" title="GROUPING"></a>GROUPING</h3><blockquote><p>在以上例子中，是用<code>rollup</code>和<code>cube</code>函数都会对结果集产生<code>null</code>，这时候可用<code>grouping</code>函数来确认该记录是由哪个字段得出来的<code>grouping</code>函数用法，带一个参数，参数为字段名，结果是根据该字段得出来的就返回<strong>1</strong>，反之返回<strong>0</strong></p></blockquote><p>例如：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(<span class="keyword">grouping</span>(base), <span class="number">1</span>, <span class="string">&#x27;所有地区&#x27;</span>, base) base,</span><br><span class="line">       decode(<span class="keyword">grouping</span>(dept), <span class="number">1</span>, <span class="string">&#x27;所有部门&#x27;</span>, dept) dept,</span><br><span class="line">       <span class="built_in">sum</span>(sal)</span><br><span class="line">  <span class="keyword">from</span> emp2</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span>(dept, base);</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">| BASE | DEPT | SUM(SAL) |</span><br><span class="line">|------|------|----------|</span><br><span class="line">|   上海 |   营运 |    17000 |</span><br><span class="line">|   北京 |   营运 |    24000 |</span><br><span class="line">| 所有地区 |   营运 |    41000 |</span><br><span class="line">|   上海 |   财务 |    14000 |</span><br><span class="line">|   北京 |   财务 |    14000 |</span><br><span class="line">| 所有地区 |   财务 |    28000 |</span><br><span class="line">| 所有地区 | 所有部门 |    69000 |</span><br></pre></td></tr></table></figure><p><strong>参考</strong>：</p><p><a class="link"   href="https://blog.csdn.net/u014558001/article/details/42387929#" >https://blog.csdn.net/u014558001/article/details/42387929#<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本文主要讲解 &lt;code&gt;ROLLUP, CUBE, GROUPING SETS&lt;/code&gt;的主要用法，这些函数可以理解为&lt;code&gt;GroupBy&lt;/code&gt;分组函数封装后的精简用法，相当于多个&lt;code&gt;union all&lt;/code&gt; 的</summary>
      
    
    
    
    <category term="数据库" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/"/>
    
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/tags/Oracle/"/>
    
    <category term="高级分组函数" scheme="https://valtenhyl.github.io/tags/%E9%AB%98%E7%BA%A7%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>Oracle去重取第一条数据</title>
    <link href="https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E5%8E%BB%E9%87%8D%E5%8F%96%E7%AC%AC%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE/"/>
    <id>https://valtenhyl.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/Oracle%E5%8E%BB%E9%87%8D%E5%8F%96%E7%AC%AC%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE/</id>
    <published>2020-09-25T08:56:43.000Z</published>
    <updated>2021-10-29T06:58:14.284Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>问题</strong>：在项目中有一张设备检测信息表<code>DEVICE_INFO</code>, 每个设备每天都会产生一条检测信息，现在需要从该表中检索出每个设备的最新检测信息。也就是<code>device_id</code>字段不能重复，消除<code>device_id</code>字段重复的记录，而且要求<code>device_id</code>对应的检测信息<code>test_result</code>是最新的。</p></blockquote><h4 id="解决思路："><a href="#解决思路：" class="headerlink" title="解决思路："></a>解决思路：</h4><p>用Oracle的<code>row_number() over()</code>函数来解决该问题。</p><h4 id="解决过程："><a href="#解决过程：" class="headerlink" title="解决过程："></a>解决过程：</h4><h5 id="查看表中的重复记录"><a href="#查看表中的重复记录" class="headerlink" title="查看表中的重复记录"></a>查看表中的重复记录</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.id, t.device_id, t.modify_date, t.test_result <span class="keyword">from</span> device_info t;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://s1.ax1x.com/2020/09/25/09X31f.png"                      alt="09X31f.png"                ></p><h5 id="标记重复的记录"><a href="#标记重复的记录" class="headerlink" title="标记重复的记录"></a>标记重复的记录</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.id,</span><br><span class="line">       t.device_id,</span><br><span class="line">       t.modify_date,</span><br><span class="line">       t.test_result,</span><br><span class="line">       <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> device_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> modify_date <span class="keyword">desc</span>) row_flag</span><br><span class="line">  <span class="keyword">from</span> device_info t;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://s1.ax1x.com/2020/09/25/09X536.png"                      alt="09X536.png"                ></p><h5 id="过滤重复数据，取最新记录"><a href="#过滤重复数据，取最新记录" class="headerlink" title="过滤重复数据，取最新记录"></a>过滤重复数据，取最新记录</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, device_id, modify_date, test_result</span><br><span class="line">  <span class="keyword">from</span> (<span class="keyword">select</span> t.id,</span><br><span class="line">               t.device_id,</span><br><span class="line">               t.modify_date,</span><br><span class="line">               t.test_result,</span><br><span class="line">               <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> device_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> modify_date <span class="keyword">desc</span>) row_flag</span><br><span class="line">          <span class="keyword">from</span> device_info t)</span><br><span class="line"> <span class="keyword">where</span> row_flag <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://s1.ax1x.com/2020/09/25/09jMb4.png"                      alt="09jMb4.png"                ></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><code>row_number() over(PARTITION BY col1 ORDER BY col2 desc)</code>表示根据 <code>col1</code> 分组，在分组内部根据 <code>col2</code>倒序排序，而此函数计算的值就表示每组内部排序后的顺序编号（组内连续的唯一的)。</p><p>与<code>rownum</code>的区别在于：使用 <code>rownum</code> 进行排序的时候是先对结果集加入伪列<code>rownum</code>然后再进行排序，而此函数在包含排序从句后是先排序再计算行号码。</p><ul><li><p><code>row_number()</code>和<code>rownum</code>差不多，功能更强一点（可以在各个分组内从1开时排序）。</p></li><li><p><code>rank()</code>是跳跃排序，有两个第二名时接下来就是第四名（同样是在各个分组内）。</p></li><li><p><code>dense_rank()</code>是连续排序，有两个第二名时仍然跟着第三名。相比之下<code>row_number</code>是没有重复值的 。</p></li></ul><p><strong>参考</strong>：</p><p><a class="link"   href="http://blog.csdn.net/nux_123/article/details/45037719" >http://blog.csdn.net/nux_123/article/details/45037719<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;问题&lt;/strong&gt;：在项目中有一张设备检测信息表&lt;code&gt;DEVICE_INFO&lt;/code&gt;, 每个设备每天都会产生一条检测信息，现在需要从该表中检索出每个设备的最新检测信息。也就是&lt;code&gt;device_id&lt;/code</summary>
      
    
    
    
    <category term="数据库" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/"/>
    
    
    <category term="Oracle" scheme="https://valtenhyl.github.io/tags/Oracle/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis 传参数</title>
    <link href="https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/Mybatis/Mybatis%E4%BC%A0%E5%8F%82%E6%95%B0/"/>
    <id>https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/Mybatis/Mybatis%E4%BC%A0%E5%8F%82%E6%95%B0/</id>
    <published>2020-09-25T05:30:56.000Z</published>
    <updated>2021-10-29T06:58:14.283Z</updated>
    
    <content type="html"><![CDATA[<h2 id="与"><a href="#与" class="headerlink" title="#{}与${}"></a>#{}与${}</h2><p>注意以下两个符号的使用：</p><ul><li><p>**#{}**：MyBatis创建预处理语句属性从而设置安全的值（比如?）。常用作查询条件的值，例如：where name=#{value}。<br>该参数可以指定一个确切的数据类型，</p><p>例如： #{property,javaType=int,jdbcType=NUMERIC}. </p></li><li><p>**${}**： MyBatis不会修改或转义字符串，将会直接在SQL语句中插入一个不改变的字符串，常用于拼凑sql的实体部分，<br>例如：select * from ${tableName}</p></li></ul><p>在执行SQL时MyBatis会自动通过对象中的属性给SQL中参数赋值，它会自动将Java类型转换成数据库的类型。而一旦传入的是null它就无法准确判断这个类型应该是什么，就有可能将类型转换错误，从而报错。</p><p>要解决这个问题，需要针对这些可能为空的字段，手动指定其转换时用到的类型。</p><p>一般情况下，我们没有必要按个字段去识别/判断它是否可以为空，而是将所有的字段都当做可以为空，全部手动设置转换类型。</p><p><strong>#{} 会自动补单引号   order by ‘num asc’</strong></p><p><strong>${} 不会自动补单引号 order by num asc</strong></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://pic.downk.cc/item/5e9ff164c2a9a83be56129dd.jpg"                                     ></p><h2 id="参数是list"><a href="#参数是list" class="headerlink" title="参数是list"></a>参数是list</h2><h3 id="Oracle批量新增"><a href="#Oracle批量新增" class="headerlink" title="Oracle批量新增"></a>Oracle批量新增</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    insert into tb_gl_ypbg_clxx_gxc (id, bg_id, gxlx, car_no, car_track, del )</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;union all&quot;</span>&gt;</span></span><br><span class="line">        select #&#123;item.id,jdbcType=VARCHAR&#125;, #&#123;item.bgId,jdbcType=VARCHAR&#125;, </span><br><span class="line">               #&#123;item.gxlx,jdbcType=VARCHAR&#125;, #&#123;item.carNo,jdbcType=VARCHAR&#125;, </span><br><span class="line">               #&#123;item.carTrack,jdbcType=VARCHAR&#125;, &#x27;0&#x27;</span><br><span class="line">        from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Oracle批量修改"><a href="#Oracle批量修改" class="headerlink" title="Oracle批量修改"></a>Oracle批量修改</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">open</span>=<span class="string">&quot;begin&quot;</span> <span class="attr">close</span>=<span class="string">&quot;;end;&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">        update tb_gl_ypbg_clxx_gxc</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;item.gxlx != null and item.gxlx != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                gxlx = #&#123;item.gxlx,jdbcType=VARCHAR&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            modify_username = #&#123;item.modifyPid,jdbcType=VARCHAR&#125;,</span><br><span class="line">            modify_truename = #&#123;item.modifyUser,jdbcType=VARCHAR&#125;,</span><br><span class="line">            modify_date = sysdate,</span><br><span class="line">            modify_unit = #&#123;item.modifyUnit,jdbcType=VARCHAR&#125;,</span><br><span class="line">            modify_unit_code = #&#123;item.modifyUnitCode,jdbcType=VARCHAR&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;item.id,jdbcType=CHAR&#125; and del = &#x27;0&#x27;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteAjypYpbgByIds&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    delete from ajyp_ypbg where ASJBH in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;asjbh&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;asjbh&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="四种传参方式"><a href="#四种传参方式" class="headerlink" title="四种传参方式"></a>四种传参方式</h2><h3 id="方式一、顺序传参"><a href="#方式一、顺序传参" class="headerlink" title="方式一、顺序传参"></a>方式一、顺序传参</h3><p><strong>mapper.java文件：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">selectUser</span><span class="params">(String name, <span class="keyword">int</span> deptId)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>mapper.xml文件：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wyj.entity.po.User&quot;</span>&gt;</span></span><br><span class="line">select * from user where userName = #&#123;0&#125; and deptId = #&#123;1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：里面的数字代表你传入参数的顺序，不是特别建议使用这种方法传递参数，特别是参数个数多的时候</p><h3 id="方式二、注解-Param传参"><a href="#方式二、注解-Param传参" class="headerlink" title="方式二、注解@Param传参"></a>方式二、注解@Param传参</h3><p><strong>mapper.java文件：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">selectUser</span><span class="params">(<span class="meta">@Param(&quot;userName&quot;)</span> String name, <span class="keyword">int</span> <span class="meta">@Param(&quot;deptId&quot;)</span> id)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>mapper.xml文件：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wyj.entity.po.User&quot;</span>&gt;</span></span><br><span class="line">select * from user where userName = #&#123;userName&#125; and deptId = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：在xml文件中就只能以在@Param注解中声明的参数名称获取参数</p><h3 id="方式三、Map集合传参"><a href="#方式三、Map集合传参" class="headerlink" title="方式三、Map集合传参"></a>方式三、Map集合传参</h3><p><strong>mapper.java文件：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">selectUser</span><span class="params">(Map&lt;String, Object&gt; params)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>mapper.xml文件：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wyj.entity.po.User&quot;</span>&gt;</span></span><br><span class="line">select * from user where userName = #&#123;userName&#125; and deptId = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="方式四、JavaBean实体类传参"><a href="#方式四、JavaBean实体类传参" class="headerlink" title="方式四、JavaBean实体类传参"></a>方式四、JavaBean实体类传参</h3><p><strong>mapper.java文件：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">selectUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>mapper.xml文件：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.wyj.entity.po.User&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wyj.entity.po.User&quot;</span>&gt;</span></span><br><span class="line">select * from user where userName = #&#123;userName&#125; and deptId = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;与&quot;&gt;&lt;a href=&quot;#与&quot; class=&quot;headerlink&quot; title=&quot;#{}与${}&quot;&gt;&lt;/a&gt;#{}与${}&lt;/h2&gt;&lt;p&gt;注意以下两个符号的使用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;**#{}**：MyBatis创建预处理语句属性从而设置安全的值（</summary>
      
    
    
    
    <category term="后端" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="Mybatis" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/Mybatis/"/>
    
    
    <category term="Mybatis" scheme="https://valtenhyl.github.io/tags/Mybatis/"/>
    
  </entry>
  
  <entry>
    <title>iView 行列合并案例</title>
    <link href="https://valtenhyl.github.io/%E5%89%8D%E7%AB%AF/Vue/iView%20%E8%A1%8C%E5%88%97%E5%90%88%E5%B9%B6%E6%A1%88%E4%BE%8B/"/>
    <id>https://valtenhyl.github.io/%E5%89%8D%E7%AB%AF/Vue/iView%20%E8%A1%8C%E5%88%97%E5%90%88%E5%B9%B6%E6%A1%88%E4%BE%8B/</id>
    <published>2020-09-23T07:51:29.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="行-列合并"><a href="#行-列合并" class="headerlink" title="行/列合并"></a>行/列合并</h4><p>4.0.0 设置属性 <code>span-method</code> 可以指定合并行或列的算法。</p><p>该方法参数为 4 个对象：</p><ul><li><strong>row</strong>: 当前行</li><li><strong>column</strong>: 当前列</li><li><strong>rowIndex</strong>: 当前行索引</li><li><strong>columnIndex</strong>: 当前列索引</li></ul><p>该函数可以返回一个包含两个元素的数组，第一个元素代表 rowspan，第二个元素代表 colspan。 也可以返回一个键名为 rowspan 和 colspan 的对象。</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://s1.ax1x.com/2020/09/23/wvuAW4.png"                      alt="wvuAW4.png"                ></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;Table :columns=&quot;columns14&quot; :data=&quot;data5&quot; border :span-method=&quot;handleSpan&quot;&gt;&lt;/Table&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data () &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                columns14: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        title: &#x27;Date&#x27;,</span><br><span class="line">                        key: &#x27;date&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        title: &#x27;Name&#x27;,</span><br><span class="line">                        key: &#x27;name&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        title: &#x27;Age&#x27;,</span><br><span class="line">                        key: &#x27;age&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        title: &#x27;Address&#x27;,</span><br><span class="line">                        key: &#x27;address&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                data5: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: &#x27;John Brown&#x27;,</span><br><span class="line">                        age: 18,</span><br><span class="line">                        address: &#x27;New York No. 1 Lake Park&#x27;,</span><br><span class="line">                        date: &#x27;2016-10-03&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: &#x27;Jim Green&#x27;,</span><br><span class="line">                        age: 24,</span><br><span class="line">                        address: &#x27;London No. 1 Lake Park&#x27;,</span><br><span class="line">                        date: &#x27;2016-10-01&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: &#x27;Joe Black&#x27;,</span><br><span class="line">                        age: 30,</span><br><span class="line">                        address: &#x27;Sydney No. 1 Lake Park&#x27;,</span><br><span class="line">                        date: &#x27;2016-10-02&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        name: &#x27;Jon Snow&#x27;,</span><br><span class="line">                        age: 26,</span><br><span class="line">                        address: &#x27;Ottawa No. 2 Lake Park&#x27;,</span><br><span class="line">                        date: &#x27;2016-10-04&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            handleSpan (&#123; row, column, rowIndex, columnIndex &#125;) &#123;</span><br><span class="line">                if (rowIndex === 0 &amp;&amp; columnIndex === 0) &#123;</span><br><span class="line">                    return [1, 2];</span><br><span class="line">                &#125; else if (rowIndex === 0 &amp;&amp; columnIndex === 1) &#123;</span><br><span class="line">                    return  [0, 0];</span><br><span class="line">                &#125;</span><br><span class="line">                if (rowIndex === 2 &amp;&amp; columnIndex === 0) &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        rowspan: 2,</span><br><span class="line">                        colspan: 1</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125; else if (rowIndex === 3 &amp;&amp; columnIndex === 0) &#123;</span><br><span class="line">                    return &#123;</span><br><span class="line">                        rowspan: 0,</span><br><span class="line">                        colspan: 0</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>官方文档直接合并。现有一个需求，第一列数据相同才合并，不相同则不合并。</p><p>完整代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--span-method 是 iView 4.0以后才有的属性，用于合并行/列--&gt;</span><br><span class="line">    &lt;Table :columns=&quot;columns&quot; :data=&quot;tableData&quot; :span-method=&quot;handleSpan&quot;&gt;&lt;/Table&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  const KEY_NAME = &quot;name&quot;;</span><br><span class="line">  const KEY_ROWSPAN = &quot;rowSpan&quot;;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        resultData: [],</span><br><span class="line">        tableData: [</span><br><span class="line">          // 见下文数据tableData</span><br><span class="line">        ],</span><br><span class="line">        columns: [</span><br><span class="line">          // 见下文columns</span><br><span class="line">        ]</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      // 挂载的时候处理数据</span><br><span class="line">      this.formatData();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      // 根据名字相同的数据算出rowspan  </span><br><span class="line">      formatData() &#123;</span><br><span class="line">        var k = 0;</span><br><span class="line">        while (k &lt; this.tableData.length) &#123;</span><br><span class="line">          this.tableData[k][KEY_ROWSPAN] = 1;</span><br><span class="line">          for (var i = k + 1; i &lt;= this.tableData.length - 1; i++) &#123;</span><br><span class="line">            if (</span><br><span class="line">              this.tableData[k][KEY_NAME] === this.tableData[i][KEY_NAME] &amp;&amp;</span><br><span class="line">              this.tableData[k][KEY_NAME] !== &quot;&quot;</span><br><span class="line">            ) &#123;</span><br><span class="line">              this.tableData[k][KEY_ROWSPAN]++;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              break;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          k = i;</span><br><span class="line">        &#125;</span><br><span class="line">        this.resultData = this.tableData;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 合并行/列</span><br><span class="line">      handleSpan (&#123; row, column, rowIndex, columnIndex &#125;) &#123;</span><br><span class="line">        if (columnIndex === 0) &#123;</span><br><span class="line">          if (row[KEY_ROWSPAN]) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">              rowspan: row[KEY_ROWSPAN],</span><br><span class="line">              colspan: 1</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">              rowspan: 0,</span><br><span class="line">              colspan: 0</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return  [1, 1];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>数据tableData</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;赵伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1963-7-9&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;183&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhao@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;156*****1987&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市黄浦区金陵东路569号17楼&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;赵伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1963-7-9&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;183&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhao@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;156*****1987&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市黄浦区金陵东路569号17楼&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">30</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;赵伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1963-7-9&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;183&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhao@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;156*****1987&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市黄浦区金陵东路569号17楼&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">40</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;李伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;2003-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;166&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;li@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;182*****1538&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市奉贤区南桥镇立新路12号2楼&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;孙伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;186&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;sun@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;161*****0097&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市崇明县城桥镇八一路739号&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;周伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;188&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhou@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;197*****1123&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市青浦区青浦镇章浜路24号&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;周伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;188&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhou@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;197*****1123&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市青浦区青浦镇章浜路24号&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">30</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;周伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;188&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;zhou@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;197*****1123&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市青浦区青浦镇章浜路24号&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;吴伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;160&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;wu@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;183*****6678&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市松江区乐都西路867-871号&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">40</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">&quot;冯伟&quot;</span>,</span><br><span class="line">        gender: <span class="string">&quot;女&quot;</span>,</span><br><span class="line">        birthday: <span class="string">&quot;1993-12-7&quot;</span>,</span><br><span class="line">        height: <span class="string">&quot;168&quot;</span>,</span><br><span class="line">        email: <span class="string">&quot;feng@gmail.com&quot;</span>,</span><br><span class="line">        tel: <span class="string">&quot;133*****3793&quot;</span>,</span><br><span class="line">        hobby: <span class="string">&quot;钢琴、书法、唱歌&quot;</span>,</span><br><span class="line">        address: <span class="string">&quot;上海市金山区龙胜路143号一层&quot;</span>,</span><br><span class="line">        win: <span class="number">100</span>,</span><br><span class="line">        loss: <span class="number">50</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>columns</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;姓名&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;name&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;性别&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;gender&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;手机号码&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;tel&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;出生日期&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;birthday&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;hobby&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: <span class="string">&quot;地址&quot;</span>,</span><br><span class="line">        key: <span class="string">&quot;address&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;h4 id=&quot;行-列合并&quot;&gt;&lt;a href=&quot;#行-列合并&quot; class=&quot;headerlink&quot; title=&quot;行/列合并&quot;&gt;&lt;/a&gt;行/列合并&lt;/h4&gt;&lt;p</summary>
      
    
    
    
    <category term="前端" scheme="https://valtenhyl.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Vue" scheme="https://valtenhyl.github.io/categories/%E5%89%8D%E7%AB%AF/Vue/"/>
    
    
    <category term="Vue" scheme="https://valtenhyl.github.io/tags/Vue/"/>
    
    <category term="iView" scheme="https://valtenhyl.github.io/tags/iView/"/>
    
  </entry>
  
  <entry>
    <title>自定义SpringBoot Starter</title>
    <link href="https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89SpringBoot%20Starter/"/>
    <id>https://valtenhyl.github.io/%E5%90%8E%E7%AB%AF/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89SpringBoot%20Starter/</id>
    <published>2020-09-23T03:27:25.000Z</published>
    <updated>2021-10-29T06:58:14.285Z</updated>
    
    <content type="html"><![CDATA[<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>这篇文章的话我们就自己来实现一个<code>SpringBoot</code>的 <code>starter</code>吧。废话不多说我们还是直入主题吧。什么是<code>Spring Boot Starter</code>呢?我们直接来看看官网是怎么介绍的吧。</p><blockquote><p><strong>❝</strong></p><p>Starters are a set of convenient dependency descriptors that you can include in your application. You get a one-stop shop for all the Spring and related technologies that you need without having to hunt through sample code and copy-paste loads of dependency descriptors. For example, if you want to get started using Spring and JPA for database access, include the spring-boot-starter-data-jpa dependency in your project.</p><p>❞</p></blockquote><p>纳尼，一大堆的英文，这还有兴趣接着往下看吗？是不是看到这直接退出了。都到门口了，不进来喝杯茶再走嘛？看都看到这了还是接着继续往下看吧。我们先不解释这一段话是什么意思，我们可以看看<code>starter</code>的出现给我们解决了什么问题。我们还是以上述官网的例子来进行说明比如说我们需要在<code>Spring</code> 中适应<code>JPA</code>来操作数据库。在没有<code>springBoot-starter</code>之前，我们需要引入<code>jpa</code>的步骤</p><ul><li>通过<code>maven</code> 引入jdbc的依赖、以及jpa相关的各种依赖</li><li>编写<code>jpa</code>相关的配置文件</li><li>网上各种查询找资料进行调试，调试的过程对于新手可能会有点奔溃会遇到各种奇奇怪怪的问题，<code>jar</code>包冲突啊，这个<code>jar</code>包下载不下来，缺少某个<code>jar</code>包。</li><li>终于在经历千辛万苦，哼次哼次的解决各种问题之后终于把项目跑起来了，然后把这次整合<code>jpa</code>遇到的问题，以及整合的步骤都一一的详细记录下来。方便下次在需要整合<code>jpa</code>的时候直接<code>copy</code>就好了。我们以前在没有<code>starter</code>之前是不是都是这么玩的。这样的缺点是不是也非常显著，比如过程复杂、需要不停的粘贴复制（不过这是程序员经常干的事情了，也不在乎多一两次了）、整合其它组件到自己的项目变的困难，效率低下。这也就造成了<code>996</code>的程序员比较多了(晚上就不能够回去<code>69</code>了)。</li><li><img                       lazyload                     src="/images/loading.svg"                     data-src="http://e0.ifengimg.com/07/2019/0601/F3220550E3EC592271E4C1D4544DFD26D571ED62_size50_w720_h645.jpeg"                                     ></li></ul><p>我们可以看下<code>SpringBoot</code> 现在都为我们提供有哪些<code>starter</code>，我这边这截图了部分<code>starter</code>，更多的请点击<a class="link"   href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters" >https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters<i class="fas fa-external-link-alt"></i></a></p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1600841059762&di=a1629c18e7c2818553514f98e2d194dd&imgtype=0&src=http://5b0988e595225.cdn.sohucs.com/images/20181123/954bf4fce96845af98017ef57d189cbd.jpeg"                                     ></p><p><code>starter</code>的实现：虽然我们每个组件的<code>starter</code>实现各有差异，但是它们基本上都会使用到两个相同的内容：<code>ConfigurationProperties</code>和<code>AutoConfiguration</code>。因为<code>Spring Boot</code>提倡“<strong>「约定大于配置」</strong>”这一理念，所以我们使用<code>ConfigurationProperties</code>来保存我们的配置，并且这些配置都可以有一个默认值，即在我们没有主动覆写原始配置的情况下，默认值就会生效。除此之外，<code>starter</code>的<code>ConfigurationProperties</code>还使得所有的配置属性被聚集到一个文件中（一般在<code>resources</code>目录下的<code>application.properties</code>），这样我们就告别了<code>Spring</code>项目中<code>XML</code>地狱。<code>starter</code>的出现帮把我们把各种复杂的配置都封装起来了，让我们真正的可以达到了开箱即用。不仅降低了我们使用它的门槛，并且还大大提高了我们的开发效率。正如前面所说<a class="link"   href="https://mp.weixin.qq.com/s?__biz=MzIyMjQwMTgyNA==&mid=2247484313&idx=1&sn=9f91b0e5a40c5a26d7f96719e18bb07a&scene=21#wechat_redirect" >《SpringBoot自动装配》<i class="fas fa-external-link-alt"></i></a>让我们有更多的时间去陪女朋友。</p><h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><p>如果你快有孩子了，出生前你比较急的一定是起个名字。孩子的姓名标识着你和你爱人的血统，一定不会起隔壁老王的姓氏，肯定会招来异样的眼光。在<code>maven</code>中，<code>groupId</code>代表着姓氏，<code>artifactId</code>代表着名字。<code>Spring Boot</code>也是有一个命名的建议的。所以名字是不能够随随便便取得，可以按照官方的建议来取。</p><blockquote><p><strong>❝</strong></p><p>What’s in a name All official starters follow a similar naming pattern; spring-boot-starter-*, where * is a particular type of application. This naming structure is intended to help when you need to find a starter. The Maven integration in many IDEs lets you search dependencies by name. For example, with the appropriate Eclipse or STS plugin installed, you can press ctrl-space in the POM editor and type “spring-boot-starter” for a complete list. As explained in the “Creating Your Own Starter” section, third party starters should not start with spring-boot, as it is reserved for official Spring Boot artifacts. Rather, a third-party starter typically starts with the name of the project. For example, a third-party starter project called thirdpartyproject would typically be named thirdpartyproject-spring-boot-starter.</p><p>❞</p></blockquote><p>大概意思是 官方的 <code>starter</code> 的命名格式为 <code>spring-boot-starter-&#123;xxxx&#125;</code> 比如<code>spring-boot-starter-activemq</code>第三方我们自己的命名格式为 <code>&#123;xxxx&#125;-spring-boot-starter</code>。比如<code>mybatis-spring-boot-starter</code>。如果我们忽略这种约定，是不是会显得我们写的东西不够“专业“。</p><h3 id="自定义Starter"><a href="#自定义Starter" class="headerlink" title="自定义Starter"></a>自定义Starter</h3><p>下面我们就来实现一个自定义的发送短信的starter，命名为<code>sms-spring-boot-starter</code>。</p><h4 id="「引入pom」"><a href="#「引入pom」" class="headerlink" title="「引入pom」"></a>「引入<code>pom</code>」</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="「编写配置文件」"><a href="#「编写配置文件」" class="headerlink" title="「编写配置文件」"></a>「编写配置文件」</h4><p>发短信我们需要配置一些账号信息，不同的短信供应商，账户信息是不一样的，所以我们需要定义一<code>个XXXXProperties</code> 来自动装配这些账户信息。下面我们就以腾讯云和阿里云两家供应商为例；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(value = SmsProperties.class)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsAutoConfiguration</span>  </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  阿里云发送短信的实现类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AliyunSmsSenderImpl <span class="title">aliYunSmsSender</span><span class="params">(SmsProperties smsProperties)</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> AliyunSmsSenderImpl(smsProperties.getAliyun());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 腾讯云发送短信的实现类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TencentSmsSenderImpl <span class="title">tencentSmsSender</span><span class="params">(SmsProperties smsProperties)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TencentSmsSenderImpl(smsProperties.getTencent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果需要在其他项目中使用发送短信功能的话，我们只需要在配置文件(<code>application.yml</code>）中配置<code>SmsProperties</code> 的属性信息就可以了。 比如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sms:</span></span><br><span class="line">  <span class="attr">aliyun:</span></span><br><span class="line">    <span class="attr">pass-word:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">user-name:</span> <span class="string">java金融</span></span><br><span class="line">    <span class="attr">sign:</span> <span class="string">阿里云</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://aliyun.com/send</span></span><br><span class="line">  <span class="attr">tencent:</span></span><br><span class="line">    <span class="attr">pass-word:</span> <span class="number">6666</span></span><br><span class="line">    <span class="attr">user-name:</span> <span class="string">java金融</span></span><br><span class="line">    <span class="attr">sign:</span> <span class="string">腾讯云</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://tencent.com/send</span></span><br></pre></td></tr></table></figure><p>还记的<code>@ConfigurationProperties</code>注解里面是不是有个<code>prefix</code> 属性，我们配置的这个属性是<code>sms</code>，配置这个的主要一个作用的话是主要用来区别各个组件的参数。这里有个小知识点需要注意下当我们在配置文件输入<code>sms</code>我们的<code>idea</code>会提示这个<code>sms</code>有哪些属性可以配置，以及每个属性的注释都有标记，建议的话注释还是写英文，这样会显得你比较专业。</p><p>这个提示的话，是需要引入下面这个<code>jar</code>的。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引入这个<code>jar</code>之后，我们编译之后就会在<code>META-INF</code>文件夹下面生成一个<code>spring-configuration-metadata.json</code>的文件。我们可以看到这个文件其实 是根据SmsProperties类的成员属性来生成的。</p><h4 id="「编写自动配置类」"><a href="#「编写自动配置类」" class="headerlink" title="「编写自动配置类」"></a>「编写自动配置类」</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(value = SmsProperties.class)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsAutoConfiguration</span>  </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  阿里云发送短信的实现类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AliyunSmsSenderImpl <span class="title">aliYunSmsSender</span><span class="params">(SmsProperties smsProperties)</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> AliyunSmsSenderImpl(smsProperties.getAliyun());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 腾讯云发送短信的实现类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> smsProperties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TencentSmsSenderImpl <span class="title">tencentSmsSender</span><span class="params">(SmsProperties smsProperties)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TencentSmsSenderImpl(smsProperties.getTencent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写我们的发送短信实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliyunSmsSenderImpl</span> <span class="keyword">implements</span> <span class="title">SmsSender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SmsMessage smsMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AliyunSmsSenderImpl</span><span class="params">(SmsMessage smsProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.smsMessage = smsProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">send</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(smsMessage.toString()+<span class="string">&quot;开始发送短信==》短信内容：&quot;</span>+message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="「让starter生效」"><a href="#「让starter生效」" class="headerlink" title="「让starter生效」"></a>「让starter生效」</h4><p><code>starter</code>集成应用有两种方式：</p><ul><li><p>被动生效 我们首先来看下我们熟悉的方式，通过<code>SpringBoot</code>的<code>SPI</code>的机制来去加载我们的starter。我们需要在<code>META-INF</code>下新建一个<code>spring.factories</code>文件<code>key</code>为<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration， value</code>是我们的<code>SmsAutoConfiguration</code> 全限定名（<strong>「记得去除前后的空格，否则会不生效」</strong>）。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.valten.sms.SmsAutoConfiguration</span></span><br></pre></td></tr></table></figure></li><li><p>主动生效 在<code>starter</code>组件集成到我们的<code>Spring Boot</code>应用时需要主动声明启用该<code>starter</code>才生效，通过自定义一个<code>@Enable</code>注解然后在把自动配置类通过<code>Import</code>注解引入进来。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;SmsAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableSms &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的时候需要在启动类上面开启这个注解。</p><h4 id="「打包，部署到仓库」"><a href="#「打包，部署到仓库」" class="headerlink" title="「打包，部署到仓库」"></a>「打包，部署到仓库」</h4><p>如果是本地的话，直接通过<code>mvn install</code>命令就可以了。如果需要部署到公司的仓库话，这个就不说了。</p><h4 id="「使用starter」"><a href="#「使用starter」" class="headerlink" title="「使用starter」"></a>「使用<code>starter</code>」</h4><p>新建一个新的<code>SpringBoot</code>项目引入我们刚写的<code>starter</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.valten.sms<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sms-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在项目配置文件配上短信账号信息</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sms:</span></span><br><span class="line">  <span class="attr">aliyun:</span></span><br><span class="line">    <span class="attr">pass-word:</span> <span class="number">12345</span></span><br><span class="line">    <span class="attr">user-name:</span> <span class="string">java金融</span></span><br><span class="line">    <span class="attr">sign:</span> <span class="string">阿里云</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://aliyun.com/send</span></span><br><span class="line">  <span class="attr">tencent:</span></span><br><span class="line">    <span class="attr">pass-word:</span> <span class="number">6666</span></span><br><span class="line">    <span class="attr">user-name:</span> <span class="string">java金融</span></span><br><span class="line">    <span class="attr">sign:</span> <span class="string">腾讯云</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://tencent.com/send</span></span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableSms</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext context = SpringApplication.run(Application.class, args);</span><br><span class="line">        AliyunSmsSenderImpl aliyunSmsSender = context.getBean(AliyunSmsSenderImpl.class);</span><br><span class="line">        aliyunSmsSender.send(<span class="string">&quot;用阿里云发送短信&quot;</span>);</span><br><span class="line">        TencentSmsSenderImpl tencentSmsSender = context.getBean(TencentSmsSenderImpl.class);</span><br><span class="line">        tencentSmsSender.send(<span class="string">&quot;用腾讯云发送短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SmsMessage&#123;userName=&#x27;java金融&#x27;, passWord=&#x27;12345&#x27;, sign=&#x27;阿里云&#x27;, url=&#x27;http:<span class="comment">//aliyun.com/send&#x27;&#125;开始发送短信==》短信内容：用阿里云发送短信</span></span><br><span class="line">SmsMessage&#123;userName=&#x27;java金融&#x27;, passWord=&#x27;6666&#x27;, sign=&#x27;腾讯云&#x27;, url=&#x27;http:<span class="comment">//tencent.com/send&#x27;&#125;开始发送短信==》短信内容：用腾讯云发送短信</span></span><br></pre></td></tr></table></figure><p>至此的话我们自定义的一个<code>starter</code>就已经完成了，这个<code>starter</code>只是一个演示的<code>demo</code>，代码有点粗糙,项目结构也有点问题。重点看下这个实现原理就好。赶紧动动小手去实现一个自己的<code>starter</code>吧。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li><code>SpringBoot starter</code>的出现，让我们项目中集成其他组件变得简单。它把简单给了别人，把复杂留给了自己。“牺牲小我，成就大我”的思想还是值得学习的。平时我们工作中，比如要开发一个组件、或者一个工具类，也应该尽可能的让使用方可以做到无脑使用，不要搞的太复杂，又能让使用者可以灵活扩展。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h3&gt;&lt;p&gt;这篇文章的话我们就自己来实现一个&lt;code&gt;SpringBoot&lt;/code&gt;的 &lt;code&gt;starter&lt;/code&gt;吧。废话不多说我们</summary>
      
    
    
    
    <category term="后端" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    <category term="SpringBoot" scheme="https://valtenhyl.github.io/categories/%E5%90%8E%E7%AB%AF/SpringBoot/"/>
    
    
    <category term="SpringBoot" scheme="https://valtenhyl.github.io/tags/SpringBoot/"/>
    
    <category term="Starter" scheme="https://valtenhyl.github.io/tags/Starter/"/>
    
  </entry>
  
  <entry>
    <title>Nginx 反向代理配置</title>
    <link href="https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Nginx/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/"/>
    <id>https://valtenhyl.github.io/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Nginx/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/</id>
    <published>2020-09-16T06:54:56.000Z</published>
    <updated>2021-11-03T01:12:10.785Z</updated>
    
    <content type="html"><![CDATA[<p> Nginx是一款轻量级的Web服务器、反向代理服务器，由于它的内存占用少，启动极快，高并发能力强，在互联网项目中广泛应用。 </p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://picb.zhimg.com/80/v2-e1826bab1d07df8e97d61aa809b94a10_720w.jpg"                                     ></p><p>上图基本上说明了当下流行的技术架构，其中Nginx有点入口网关的味道。</p><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>经常听人说到一些术语，如反向代理，那么什么是反向代理，什么又是正向代理呢？</p><ul><li><p>正向代理：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://pic4.zhimg.com/80/v2-c8ac111c267ae0745f984e326ef0c47f_720w.jpg"                                     ></p></li><li><p>反向代理：</p><p><img                       lazyload                     src="/images/loading.svg"                     data-src="https://pic2.zhimg.com/80/v2-4787a512240b238ebf928cd0651e1d99_720w.jpg"                                     ></p><p>由于防火墙的原因，我们并不能直接访问谷歌，那么我们可以借助XXX来实现，这就是一个简单的正向代理的例子。这里你能够发现，正向代理“代理”的是客户端，而且客户端是知道目标的，而目标是不知道客户端是通过XXX访问的。</p><p>当我们在外网访问百度的时候，其实会进行一个转发，代理到内网去，这就是所谓的反向代理，即反向代理“代理”的是服务器端，而且这一个过程对于客户端而言是透明的。</p></li></ul><h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><p>该指令用于匹配 URL。</p><p>语法规则： <code>location [=|~|~*|^~] /uri/ &#123; … &#125;</code></p><ul><li><code>=</code> 开头表示精确匹配</li><li><code>^~</code> 开头表示uri以某个常规字符串开头，理解为匹配 url路径即可。nginx不对url做编码，因此请求为/static/20%/aa，可以被规则^~ /static/ /aa匹配到（注意是空格）。以xx开头</li><li><code>~</code> 开头表示区分大小写的正则匹配           以xx结尾</li><li><code>~*</code> 开头表示不区分大小写的正则匹配        以xx结尾</li><li><code>!~</code>和<code>!~*</code>分别为区分大小写不匹配及不区分大小写不匹配 的正则</li><li><code>/</code> 通用匹配，任何请求都会匹配到。</li></ul><p>多个location配置的情况下匹配顺序为（参考资料而来，还未实际验证，试试就知道了，不必拘泥，仅供参考）：</p><blockquote><p>注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~* 标识。</p></blockquote><p>首先精确匹配 <code>=</code> ，其次以xx开头匹配 <code>^~</code> ， 然后是按文件中顺序的正则匹配，最后是交给 <code>/</code> 通用匹配。</p><p>当有匹配成功时候，停止匹配，按当前匹配规则处理请求。</p><h3 id="localtion实例"><a href="#localtion实例" class="headerlink" title="localtion实例"></a>localtion实例</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> = / &#123;</span><br><span class="line">   <span class="comment">#规则A</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> = /login &#123;</span><br><span class="line">   <span class="comment">#规则B</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /static/ &#123;</span><br><span class="line">   <span class="comment">#规则C</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.(gif|jpg|png|js|css)$</span> &#123;</span><br><span class="line">   <span class="comment">#规则D，注意：是根据括号内的大小写进行匹配。括号内全是小写，只匹配小写</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.png$</span> &#123;</span><br><span class="line">   <span class="comment">#规则E</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> !<span class="regexp">~ \.xhtml$</span> &#123;</span><br><span class="line">   <span class="comment">#规则F</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> !<span class="regexp">~* \.xhtml$</span> &#123;</span><br><span class="line">   <span class="comment">#规则G</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">   <span class="comment">#规则H</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么产生的效果如下：</p><p>访问根目录/， 比如 <a class="link"   href="http://localhost/" >http://localhost/<i class="fas fa-external-link-alt"></i></a>  将匹配规则A</p><p>访问 <a class="link"   href="http://localhost/login" >http://localhost/login<i class="fas fa-external-link-alt"></i></a> 将匹配规则B，<a class="link"   href="http://localhost/register" >http://localhost/register<i class="fas fa-external-link-alt"></i></a> 则匹配规则H</p><p>访问 <a class="link"   href="http://localhost/static/a.html" >http://localhost/static/a.html<i class="fas fa-external-link-alt"></i></a> 将匹配规则C</p><p>访问 <a class="link"   href="http://localhost/a.gif" >http://localhost/a.gif<i class="fas fa-external-link-alt"></i></a>, <a class="link"   href="http://localhost/b.jpg" >http://localhost/b.jpg<i class="fas fa-external-link-alt"></i></a> 将匹配规则D和规则E，但是规则D顺序优先，规则E不起作用， 而 <a class="link"   href="http://localhost/static/c.png" >http://localhost/static/c.png<i class="fas fa-external-link-alt"></i></a> 则优先匹配到 规则C</p><p>访问 <a class="link"   href="http://localhost/a.PNG" >http://localhost/a.PNG<i class="fas fa-external-link-alt"></i></a> 则匹配规则E， 而不会匹配规则D，因为规则E不区分大小写。</p><p>访问 <a class="link"   href="http://localhost/a.xhtml" >http://localhost/a.xhtml<i class="fas fa-external-link-alt"></i></a> 不会匹配规则F和规则G，</p><p><a class="link"   href="http://localhost/a.XHTML%E4%B8%8D%E4%BC%9A%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99G%EF%BC%8C%EF%BC%88%E5%9B%A0%E4%B8%BA!%EF%BC%89%E3%80%82%E8%A7%84%E5%88%99F%EF%BC%8C%E8%A7%84%E5%88%99G%E5%B1%9E%E4%BA%8E%E6%8E%92%E9%99%A4%E6%B3%95%EF%BC%8C%E7%AC%A6%E5%90%88%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99%E4%B9%9F%E4%B8%8D%E4%BC%9A%E5%8C%B9%E9%85%8D%E5%88%B0%EF%BC%8C%E6%89%80%E4%BB%A5%E6%83%B3%E6%83%B3%E7%9C%8B%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E4%B8%AD%E5%93%AA%E9%87%8C%E4%BC%9A%E7%94%A8%E5%88%B0%E3%80%82" >http://localhost/a.XHTML不会匹配规则G，（因为!）。规则F，规则G属于排除法，符合匹配规则也不会匹配到，所以想想看实际应用中哪里会用到。<i class="fas fa-external-link-alt"></i></a></p><p>访问 <a class="link"   href="http://localhost/category/id/1111" >http://localhost/category/id/1111<i class="fas fa-external-link-alt"></i></a> 则最终匹配到规则H，因为以上规则都不匹配，这个时候nginx转发请求给后端应用服务器，比如FastCGI（php），tomcat（jsp），nginx作为方向代理服务器存在。</p><p>所以实际使用中，个人觉得至少有三个匹配规则定义，如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，官网如是说。</span></span><br><span class="line"><span class="comment">#这里是直接转发给后端应用服务器了，也可以是一个静态首页</span></span><br><span class="line"><span class="comment"># 第一个必选规则</span></span><br><span class="line"><span class="attribute">location</span> = / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://tomcat:8080/index</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 第二个必选规则是处理静态文件请求，这是nginx作为http服务器的强项</span></span><br><span class="line"><span class="comment"># 有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用</span></span><br><span class="line">location<span class="regexp"> ^~</span> /static/ &#123;                              //以xx开头</span><br><span class="line">    <span class="attribute">root</span> /webroot/static/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(gif|jpg|jpeg|png|css|js|ico)$</span> &#123;     //以xx结尾</span><br><span class="line">    <span class="attribute">root</span> /webroot/res/;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#第三个规则就是通用规则，用来转发动态请求到后端应用服务器</span></span><br><span class="line"><span class="comment">#非静态文件请求就默认是动态请求，自己根据实际把握</span></span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://tomcat:8080/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="proxy-pass"><a href="#proxy-pass" class="headerlink" title="proxy_pass"></a>proxy_pass</h2><p>该指令用于设置被代理服务器的地址。可以是主机名称、IP地址加端口号的形式。</p><p>语法如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> URL;</span><br></pre></td></tr></table></figure><p>URL 为被代理服务器的地址，可以包含传输协议、主机名称或IP地址加端口号，URI等。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span>  http://www.123.com/url;</span><br></pre></td></tr></table></figure><h3 id="proxy-pass实例"><a href="#proxy-pass实例" class="headerlink" title="proxy_pass实例"></a>proxy_pass实例</h3><p>在nginx中配置proxy_pass时，当在后面的url加上了/，相当于是绝对根路径，则nginx不会把location中匹配的路径部分代理走；如果没有/，则会把匹配的路径部分也给代理走。 </p><p>下面四种情况分别用<a class="link"   href="http://192.168.1.4/proxy/test.html" >http://192.168.1.4/proxy/test.html<i class="fas fa-external-link-alt"></i></a> 进行访问。 </p><p>第一种：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /proxy/ &#123;</span><br><span class="line">     <span class="attribute">proxy_pass</span> http://127.0.0.1:81/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 会被代理到  <a class="link"   href="http://127.0.0.1:81/test.html" >http://127.0.0.1:81/test.html<i class="fas fa-external-link-alt"></i></a></p><p>第二种：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /proxy/ &#123;</span><br><span class="line">     <span class="attribute">proxy_pass</span> http://127.0.0.1:81;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 会被代理到  <a class="link"   href="http://127.0.0.1:81/proxy/test.html" >http://127.0.0.1:81/proxy/test.html<i class="fas fa-external-link-alt"></i></a>  </p><p>第三种：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /proxy/ &#123;</span><br><span class="line">     <span class="attribute">proxy_pass</span> http://127.0.0.1:81/ftlynx/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 会被代理到  <a class="link"   href="http://127.0.0.1:81/ftlynx/test.html" >http://127.0.0.1:81/ftlynx/test.html<i class="fas fa-external-link-alt"></i></a></p><p>第四种 (相对于第三种，最后少一个 / ) ：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /proxy/ &#123;</span><br><span class="line">     <span class="attribute">proxy_pass</span> http://127.0.0.1:81/ftlynx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 会被代理到  <a class="link"   href="http://127.0.0.1:81/ftlynxtest.html" >http://127.0.0.1:81/ftlynxtest.html<i class="fas fa-external-link-alt"></i></a> </p><h2 id="rewrite"><a href="#rewrite" class="headerlink" title="rewrite"></a>rewrite</h2><p>rewrite功能就是，使用nginx提供的全局变量或自己设置的变量，结合正则表达式和标志位实现url重写以及重定向。rewrite只能放在server{},location{},if{}中，并且只能对域名后边的除去传递的参数外的字符串起作用，例如 <code>http://seanlook.com/a/we/index.php?id=1&amp;u=str</code> 只对/a/we/index.php重写。语法<code>rewrite regex replacement [flag];</code></p><p>如果相对域名或参数字符串起作用，可以使用全局变量匹配，也可以使用proxy_pass反向代理。</p><p>表明看rewrite和location功能有点像，都能实现跳转，主要区别在于rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。很多情况下rewrite也会写在location里，它们的执行顺序是：</p><ol><li>执行server块的rewrite指令</li><li>执行location匹配</li><li>执行选定的location中的rewrite指令</li></ol><p>如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。</p><h3 id="flag标志位"><a href="#flag标志位" class="headerlink" title="flag标志位"></a>flag标志位</h3><ul><li><code>last</code> : 相当于Apache的[L]标记，表示完成rewrite</li><li><code>break</code> : 停止执行当前虚拟主机的后续rewrite指令集</li><li><code>redirect</code> : 返回302临时重定向，地址栏会显示跳转后的地址</li><li><code>permanent</code> : 返回301永久重定向，地址栏会显示跳转后的地址</li></ul><p>因为301和302不能简单的只返回状态码，还必须有重定向的URL，这就是return指令无法返回301,302的原因了。这里 last 和 break 区别有点难以理解：</p><ol><li>last一般写在server和if中，而break一般使用在location中</li><li>last不终止<em>重写后</em>的url匹配，即新的url会再从server走一遍匹配流程，而break终止重写后的匹配</li><li>break和last都能组织继续执行后面的rewrite指令</li></ol><h3 id="if判断指令"><a href="#if判断指令" class="headerlink" title="if判断指令"></a>if判断指令</h3><p>语法为<code>if(condition)&#123;...&#125;</code>，对给定的条件condition进行判断。如果为真，大括号内的rewrite指令将被执行，if条件(conditon)可以是如下任何内容：</p><ul><li>当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false</li><li>直接比较变量和内容时，使用<code>=</code>或<code>!=</code></li><li><code>~</code>正则表达式匹配，<code>~*</code>不区分大小写的匹配，<code>!~</code>区分大小写的不匹配</li></ul><p><code>-f</code>和<code>!-f</code>用来判断是否存在文件<br><code>-d</code>和<code>!-d</code>用来判断是否存在目录<br><code>-e</code>和<code>!-e</code>用来判断是否存在文件或目录<br><code>-x</code>和<code>!-x</code>用来判断文件是否可执行</p><p>例如：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> ($http_user_agent <span class="regexp">~ MSIE)</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> /msie/<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">&#125; //如果UA包含&quot;MSIE&quot;，rewrite请求到/msid/目录下</span><br><span class="line"></span><br><span class="line"><span class="attribute">if</span> ($http_cookie <span class="regexp">~* &quot;id=([^</span>;]+)(?:;|$)&quot;) &#123;</span><br><span class="line">    <span class="attribute">set</span> $id <span class="variable">$1</span>;</span><br><span class="line"> &#125; //如果cookie匹配正则，设置变量$id等于正则引用部分</span><br><span class="line"></span><br><span class="line"><span class="attribute">if</span> ($request_method = POST) &#123;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">405</span>;</span><br><span class="line">&#125; //如果提交方法为POST，则返回状态405（<span class="attribute">Method</span> not allowed）。return不能返回<span class="number">301</span>,<span class="number">302</span></span><br><span class="line"></span><br><span class="line">if ($slow) &#123;</span><br><span class="line">    <span class="attribute">limit_rate</span> <span class="number">10k</span>;</span><br><span class="line">&#125; //限速，$slow可以通过 <span class="attribute">set</span> 指令设置</span><br><span class="line"></span><br><span class="line">if (!-f $request_filename)&#123;</span><br><span class="line">    break;</span><br><span class="line">    <span class="attribute">proxy_pass</span>  http://127.0.0.1; </span><br><span class="line">&#125; //如果请求的文件名不存在，则反向代理到<span class="attribute">localhost</span> 。这里的<span class="literal">break</span>也是停止rewrite检查</span><br><span class="line"></span><br><span class="line">if ($args <span class="regexp">~ post=140)</span>&#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^</span> http://example.com/ <span class="literal">permanent</span>;</span><br><span class="line">&#125; //如果<span class="attribute">query</span> string中包含<span class="string">&quot;post=140&quot;</span>，永久重定向到example.com</span><br><span class="line"></span><br><span class="line">location <span class="regexp">~* \.(gif|jpg|png|swf|flv)$</span> &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> www.jefflei.com www.leizhenfang.com;</span><br><span class="line">    <span class="attribute">if</span> ($invalid_referer) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">    &#125; //防盗链</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>下面是可以用作if判断的全局变量</p><ul><li><code>$args</code> ： #这个变量等于请求行中的参数，同<code>$query_string</code></li><li><code>$content_length</code> ： 请求头中的Content-length字段。</li><li><code>$content_type</code> ： 请求头中的Content-Type字段。</li><li><code>$document_root</code> ： 当前请求在root指令中指定的值。</li><li><code>$host</code> ： 请求主机头字段，否则为服务器名称。</li><li><code>$http_user_agent</code> ： 客户端agent信息</li><li><code>$http_cookie</code> ： 客户端cookie信息</li><li><code>$limit_rate</code> ： 这个变量可以限制连接速率。</li><li><code>$request_method</code> ： 客户端请求的动作，通常为GET或POST。</li><li><code>$remote_addr</code> ： 客户端的IP地址。</li><li><code>$remote_port</code> ： 客户端的端口。</li><li><code>$remote_user</code> ： 已经经过Auth Basic Module验证的用户名。</li><li><code>$request_filename</code> ： 当前请求的文件路径，由root或alias指令与URI请求生成。</li><li><code>$scheme</code> ： HTTP方法（如http，https）。</li><li><code>$server_protocol</code> ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。</li><li><code>$server_addr</code> ： 服务器地址，在完成一次系统调用后可以确定这个值。</li><li><code>$server_name</code> ： 服务器名称。</li><li><code>$server_port</code> ： 请求到达服务器的端口号。</li><li><code>$request_uri</code> ： 包含请求参数的原始URI，不包含主机名，如：”/foo/bar.php?arg=baz”。</li><li><code>$uri</code> ： 不带请求参数的当前URI，$uri不包含主机名，如”/foo/bar.html”。</li><li><code>$document_uri</code> ： 与$uri相同。</li></ul><p>例：<code>http://localhost:88/test1/test2/test.php</code><br>$host：localhost<br>$server_port：88<br>$request_uri：<a class="link"   href="http://localhost:88/test1/test2/test.php" >http://localhost:88/test1/test2/test.php<i class="fas fa-external-link-alt"></i></a><br>$document_uri：/test1/test2/test.php<br>$document_root：/var/www/html<br>$request_filename：/var/www/html/test1/test2/test.php</p><h3 id="常用正则"><a href="#常用正则" class="headerlink" title="常用正则"></a>常用正则</h3><ul><li><code>.</code> ： 匹配除换行符以外的任意字符</li><li><code>?</code> ： 重复0次或1次</li><li><code>+</code> ： 重复1次或更多次</li><li><code>*</code> ： 重复0次或更多次</li><li><code>\d</code> ：匹配数字</li><li><code>^</code> ： 匹配字符串的开始</li><li><code>$</code> ： 匹配字符串的介绍</li><li><code>&#123;n&#125;</code> ： 重复n次</li><li><code>&#123;n,&#125;</code> ： 重复n次或更多次</li><li><code>[c]</code> ： 匹配单个字符c</li><li><code>[a-z]</code> ： 匹配a-z小写字母的任意一个</li></ul><p>小括号<code>()</code>之间匹配的内容，可以在后面通过<code>$1</code>来引用，<code>$2</code>表示的是前面第二个<code>()</code>里的内容。正则里面容易让人困惑的是<code>\</code>转义特殊字符。</p><h3 id="rewrite实例"><a href="#rewrite实例" class="headerlink" title="rewrite实例"></a>rewrite实例</h3><p><em>例1</em>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 定义image日志格式</span></span><br><span class="line">    <span class="attribute">log_format</span> imagelog <span class="string">&#x27;[$time_local] &#x27;</span> $image_file <span class="string">&#x27; &#x27;</span> $image_type <span class="string">&#x27; &#x27;</span> $body_bytes_sent <span class="string">&#x27; &#x27;</span> $status;</span><br><span class="line">    <span class="comment"># 开启重写日志</span></span><br><span class="line">    <span class="attribute">rewrite_log</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">root</span> /home/www;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">                <span class="comment"># 重写规则信息</span></span><br><span class="line">                <span class="attribute">error_log</span> logs/rewrite.log <span class="literal">notice</span>; </span><br><span class="line">                <span class="comment"># 注意这里要用‘’单引号引起来，避免&#123;&#125;</span></span><br><span class="line">                <span class="attribute">rewrite</span> <span class="string">&#x27;^/images/([a-z]&#123;2&#125;)/([a-z0-9]&#123;5&#125;)/(.*)\.(png|jpg|gif)$&#x27;</span> /data?file=<span class="variable">$3</span>.<span class="variable">$4</span>;</span><br><span class="line">                <span class="comment"># 注意不能在上面这条规则后面加上“last”参数，否则下面的set指令不会执行</span></span><br><span class="line">                <span class="attribute">set</span> $image_file <span class="variable">$3</span>;</span><br><span class="line">                <span class="attribute">set</span> $image_type <span class="variable">$4</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> /data &#123;</span><br><span class="line">                <span class="comment"># 指定针对图片的日志格式，来分析图片类型和大小</span></span><br><span class="line">                <span class="attribute">access_log</span> logs/images.log mian;</span><br><span class="line">                <span class="attribute">root</span> /data/images;</span><br><span class="line">                <span class="comment"># 应用前面定义的变量。判断首先文件在不在，不在再判断目录在不在，如果还不在就跳转到最后一个url里</span></span><br><span class="line">                <span class="attribute">try_files</span> /$arg_file /image404.html;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> = /image404.html &#123;</span><br><span class="line">                <span class="comment"># 图片不存在返回特定的信息</span></span><br><span class="line">                <span class="attribute">return</span> <span class="number">404</span> <span class="string">&quot;image not found\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对形如<code>/images/ef/uh7b3/test.png</code>的请求，重写到<code>/data?file=test.png</code>，于是匹配到<code>location /data</code>，先看<code>/data/images/test.png</code>文件存不存在，如果存在则正常响应，如果不存在则重写tryfiles到新的image404 location，直接返回404状态码。</p><p><em>例2</em>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^/images/(.*)_(\d+)x(\d+)\.(png|jpg|gif)$ /resizer/$<span class="number">1</span>.$<span class="number">4</span>?width=$<span class="number">2</span>&amp;height=$<span class="number">3</span>? last;</span><br></pre></td></tr></table></figure><p>对形如<code>/images/bla_500x400.jpg</code>的文件请求，重写到<code>/resizer/bla.jpg?width=500&amp;height=400</code>地址，并会继续尝试匹配location。</p><p><em>例3</em>：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多目录转成参数</span></span><br><span class="line"><span class="comment"># abc.domian.com/sort/2 =&gt; abc.domian.com/index.php?act=sort&amp;name=abc&amp;id=2</span></span><br><span class="line"><span class="attribute">if</span> ($host <span class="regexp">~* (.*)\.domain\.com)</span> &#123;</span><br><span class="line">    <span class="attribute">set</span> $sub_name <span class="variable">$1</span>;   </span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/sort\/(\d+)\/?$</span> /index.php?act=sort&amp;cid=$sub_name&amp;id=<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目录对换</span></span><br><span class="line"><span class="comment"># /123456/xxxx -&gt; /xxxx?id=123456</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/(\d+)/(.+)/</span> /<span class="variable">$2</span>?id=<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ie的使用重定向到/nginx-ie目录下：</span></span><br><span class="line"><span class="attribute">if</span> ($http_user_agent <span class="regexp">~ MSIE)</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> /nginx-ie/<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目录自动加 &quot;/&quot;</span></span><br><span class="line"><span class="attribute">if</span> (-d $request_filename)&#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)([^/])$</span> http://$host/<span class="variable">$1</span><span class="variable">$2</span>/ <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止ht</span></span><br><span class="line"><span class="attribute">location</span> ~/\.ht &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止多个目录</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/(cron|templates)/</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止以/data开头的文件</span></span><br><span class="line"><span class="comment"># 可以禁止/data/下多级目录下.log.txt等请求;</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^/data</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止单个目录</span></span><br><span class="line"><span class="comment"># 不能禁止.log.txt能请求</span></span><br><span class="line"><span class="attribute">location</span> /searchword/cron/ &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止单个文件</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ /data/sql/data.sql</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给favicon.ico和robots.txt设置过期时间;</span></span><br><span class="line"><span class="comment"># 这里为favicon.ico为99 天,robots.txt为7天并不记录404错误日志</span></span><br><span class="line"><span class="attribute">location</span> ~(favicon.ico) &#123;</span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">99d</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> ~(robots.txt) &#123;</span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">7d</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定某个文件的过期时间;这里为600秒，并不记录访问日志</span></span><br><span class="line"><span class="attribute">location</span><span class="regexp"> ^~</span> /html/scripts/loadhead_1.js &#123;</span><br><span class="line">    <span class="attribute">access_log</span>   <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">root</span> /opt/lampp/htdocs/web;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">600</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件反盗链并设置过期时间</span></span><br><span class="line"><span class="comment"># 这里的return 412 为自定义的http状态码，默认为403，方便找出正确的盗链的请求</span></span><br><span class="line"><span class="comment"># “rewrite ^/ http://leech.c1gstudio.com/leech.gif;”显示一张防盗链图片</span></span><br><span class="line"><span class="comment"># “access_log off;”不记录访问日志，减轻压力</span></span><br><span class="line"><span class="comment"># “expires 3d”所有文件3天的浏览器缓存</span></span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* ^.+\.(jpg|jpeg|gif|png|swf|rar|zip|css|js)$</span> &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> <span class="regexp">*.c</span>1gstudio.com <span class="regexp">*.c</span>1gstudio.net localhost <span class="number">208.97.167.194</span>;</span><br><span class="line">    <span class="attribute">if</span> ($invalid_referer) &#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://leech.c1gstudio.com/leech.gif;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">412</span>;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">access_log</span>   <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">root</span> /opt/lampp/htdocs/web;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">3d</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只充许固定ip访问网站，并加上密码</span></span><br><span class="line"><span class="attribute">root</span>  /opt/htdocs/www;</span><br><span class="line"><span class="attribute">allow</span>   <span class="number">208.97.167.194</span>;</span><br><span class="line"><span class="attribute">allow</span>   <span class="number">222.33.1.2</span>;</span><br><span class="line"><span class="attribute">allow</span>   <span class="number">231.152.49.4</span>;</span><br><span class="line"><span class="attribute">deny</span>    all;</span><br><span class="line"><span class="attribute">auth_basic</span> <span class="string">&quot;C1G_ADMIN&quot;</span>;</span><br><span class="line"><span class="attribute">auth_basic_user_file</span> htpasswd;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将多级目录下的文件转成一个文件，增强seo效果</span></span><br><span class="line"><span class="comment"># /job-123-456-789.html 指向/job/123/456/789.html</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/job-([0-9]+)-([0-9]+)-([0-9]+)\.html$</span> /job/<span class="variable">$1</span>/<span class="variable">$2</span>/<span class="variable">$3</span>.html <span class="literal">last</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将根目录下某个文件夹指向2级目录</span></span><br><span class="line"><span class="comment"># 如/shanghaijob/ 指向 /area/shanghai/</span></span><br><span class="line"><span class="comment"># 如果你将last改成permanent，那么浏览器地址栏显是 /location/shanghai/</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([0-9a-z]+)job/(.*)$</span> /area/<span class="variable">$1</span>/<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面例子有个问题是访问/shanghai 时将不会匹配</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([0-9a-z]+)job$</span> /area/<span class="variable">$1</span>/ <span class="literal">last</span>;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([0-9a-z]+)job/(.*)$</span> /area/<span class="variable">$1</span>/<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line"><span class="comment"># 这样/shanghai 也可以访问了，但页面中的相对链接无法使用，</span></span><br><span class="line"><span class="comment"># 如./list_1.html真实地址是/area/shanghia/list_1.html会变成/list_1.html,导至无法访问。</span></span><br><span class="line"><span class="comment"># 那我加上自动跳转也是不行咯</span></span><br><span class="line"><span class="comment"># (-d $request_filename)它有个条件是必需为真实目录，而我的rewrite不是的，所以没有效果</span></span><br><span class="line"><span class="attribute">if</span> (-d $request_filename)&#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)([^/])$</span> http://$host/<span class="variable">$1</span><span class="variable">$2</span>/ <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 知道原因后就好办了，让我手动跳转吧</span></span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([0-9a-z]+)job$</span> /<span class="variable">$1</span>job/ <span class="literal">permanent</span>;</span><br><span class="line"><span class="attribute">rewrite</span><span class="regexp"> ^/([0-9a-z]+)job/(.*)$</span> /area/<span class="variable">$1</span>/<span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line"><span class="comment"># 文件和目录不存在的时候重定向：</span></span><br><span class="line"><span class="attribute">if</span> (!-e $request_filename) &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 域名跳转</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  jump.c1gstudio.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    <span class="attribute">root</span>  /opt/lampp/htdocs/www;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/</span> http://www.c1gstudio.com/;</span><br><span class="line">    <span class="attribute">access_log</span>  <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 多域名转向</span></span><br><span class="line"><span class="attribute">server_name</span>  www.c1gstudio.com www.c1gstudio.net;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line"><span class="attribute">root</span>  /opt/lampp/htdocs;</span><br><span class="line"><span class="attribute">if</span> ($host <span class="regexp">~ &quot;c1gstudio\.net&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://www.c1gstudio.com<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 三级域名跳转</span></span><br><span class="line"><span class="attribute">if</span> ($http_host <span class="regexp">~* &quot;^(.*)\.i\.c1gstudio\.com$&quot;)</span> &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)</span> http://top.yingjiesheng.com<span class="variable">$1</span>;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 域名镜向</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  mirror.c1gstudio.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    <span class="attribute">root</span>  /opt/lampp/htdocs/www;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)</span> http://www.c1gstudio.com/<span class="variable">$1</span> <span class="literal">last</span>;</span><br><span class="line">    <span class="attribute">access_log</span>  <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="try-files"><a href="#try-files" class="headerlink" title="try_files"></a>try_files</h2><blockquote><p>其作用是按顺序检查文件是否存在，返回第一个找到的文件或文件夹(结尾加斜线表示为文件夹)，如果所有的文件或文件夹都找不到，会进行一个内部重定向到最后一个参数。</p><p>需要注意的是，只有最后一个参数可以引起一个内部重定向，之前的参数只设置内部URI的指向。最后一个参数是回退URI且必须存在，否则会出现内部500错误。命名的location也可以使用在最后一个参数中。与rewrite指令不同，如果回退URI不是命名的location那么$args不会自动保留，如果你想保留$args，则必须明确声明。</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> api.xxx.com;</span><br><span class="line">    <span class="attribute">root</span> /mnt/try;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">add_header</span> Content-Type <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>;</span><br><span class="line">        <span class="comment">#echo $uri;</span></span><br><span class="line">        <span class="attribute">try_files</span> $uri @default;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">location</span> @default &#123;</span><br><span class="line">        <span class="attribute">root</span> /mnt/default;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@default</code>：定义一个location段，不能被外部请求所访问，只能用于nginx内部配置指令使用，比如 try_files、error_page。</p><p>浏览器访问 <a class="link"   href="http://api.xxx.com/abc/index.html" >http://api.xxx.com/abc/index.html<i class="fas fa-external-link-alt"></i></a> 时，当前的<code>$uri</code>值为<code>/abc/index.html</code></p><p># try_files作用：<br>先尝试去/mnt/try目录下找abc目录下的index.html，如果有，直接返回，没有的话则跳转到@default部分（内部重定向）。<br>在default部分会去/mnt/default目录下找abc目录下的index.html，有，直接返回，没有就返回404错误。try_files可以理解为实现rewrite的作用。</p><p>多个前端项目放在同一个目录下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">listen</span>  [::]:<span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#charset koi8-r;</span></span><br><span class="line">    <span class="comment">#access_log  /var/log/nginx/host.access.log  main;   </span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /xzxt2-syt-web/ &#123;</span><br><span class="line">        <span class="attribute">alias</span>   /usr/share/nginx/html/xzxt2-syt-web/;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /xzxt2-syt-web/index.html;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /xzxt2-zdkz-web/ &#123;</span><br><span class="line">        <span class="attribute">alias</span>   /usr/share/nginx/html/xzxt2-zdkz-web/;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /xzxt2-zdkz-web/index.html;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>示例一：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /whsir/ &#123;</span><br><span class="line">    <span class="attribute">try_files</span> $uri /images/default.gif;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><p>1、访问<a class="link"   href="http://www.example.com/whsir/123/321%EF%BC%88%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AFdefault.gif%E5%9B%BE%E7%89%87%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/whsir/123/321（文件不存在）时，此时看到的是default.gif图片，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>2、访问<a class="link"   href="http://www.example.com/whsir/123.png%EF%BC%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF123.png%E5%9B%BE%E7%89%87%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/whsir/123.png（文件存在）时，此时看到的是123.png图片，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>总结：当images目录下文件不存在时，默认返回default.gif</p><ul><li>示例二：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /whsir/ &#123;</span><br><span class="line">    <span class="attribute">try_files</span> $uri =<span class="number">403</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><p>1、访问<a class="link"   href="http://www.example.com/whsir/123.html%EF%BC%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF123.html%E5%86%85%E5%AE%B9%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/whsir/123.html（文件存在）时，此时看到的是123.html内容，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>2、访问<a class="link"   href="http://www.example.com/whsir/21.html%EF%BC%88%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF403%E7%8A%B6%E6%80%81%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/whsir/21.html（文件不存在）时，此时看到的是403状态，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>总结：和示例一一样，只是将默认图片换成了403状态</p><ul><li>示例三：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> /whsir/ &#123;</span><br><span class="line">    <span class="attribute">try_files</span> $uri @ab;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> @ab &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://blog.whsir.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><p>1、访问<a class="link"   href="http://www.example.com/whsir/123.html%EF%BC%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF123.html%E5%86%85%E5%AE%B9%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/whsir/123.html（文件存在）时，此时看到的是123.html内容，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>2、访问<a class="link"   href="http://www.example.com/whsir/21.html%EF%BC%88%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%90%B4%E6%98%8A%E5%8D%9A%E5%AE%A2%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E6%94%B9%E5%8F%98" >www.example.com/whsir/21.html（文件不存在）时，此时跳转到吴昊博客，URL地址改变<i class="fas fa-external-link-alt"></i></a></p><p>总结：当文件不存在时，会去查找@ab值，此时在location中定义@ab值跳转到吴昊博客</p><ul><li>示例四：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">try_files</span> $uri @pro;</span><br><span class="line"><span class="attribute">location</span> @pro &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host $host;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP $remote_addr;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    <span class="attribute">proxy_pass</span> https://blog.whsir.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><p>1、访问<a class="link"   href="http://www.example.com/123.html%EF%BC%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF123.html%E5%86%85%E5%AE%B9%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/123.html（文件存在）时，此时看到的是123.html内容，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>2、访问<a class="link"   href="http://www.example.com/post-3647.html%EF%BC%88%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%89%E6%97%B6%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9C%8B%E5%88%B0%E7%9A%84%E6%98%AF%E5%90%B4%E6%98%8A%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8CURL%E5%9C%B0%E5%9D%80%E4%B8%8D%E5%8F%98" >www.example.com/post-3647.html（文件不存在）时，此时看到的是吴昊博客的内容，URL地址不变<i class="fas fa-external-link-alt"></i></a></p><p>总结：当前服务器上文件不存在时，会进行反向代理</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; Nginx是一款轻量级的Web服务器、反向代理服务器，由于它的内存占用少，启动极快，高并发能力强，在互联网项目中广泛应用。 &lt;/p&gt;
&lt;p&gt;&lt;img  
                     lazyload
                     src=&quot;/im</summary>
      
    
    
    
    <category term="技术教程" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/"/>
    
    <category term="Nginx" scheme="https://valtenhyl.github.io/categories/%E6%8A%80%E6%9C%AF%E6%95%99%E7%A8%8B/Nginx/"/>
    
    
    <category term="Nginx" scheme="https://valtenhyl.github.io/tags/Nginx/"/>
    
    <category term="反向代理" scheme="https://valtenhyl.github.io/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
</feed>
